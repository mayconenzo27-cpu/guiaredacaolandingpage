try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="73a09a9f-62bd-4efa-8aed-62127919e62c",e._sentryDebugIdIdentifier="sentry-dbid-73a09a9f-62bd-4efa-8aed-62127919e62c")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4459],{332:(e,t,r)=>{r.d(t,{Rg:()=>h,k_:()=>j,vd:()=>T,Lo:()=>P,s3:()=>A,WW:()=>R,hG:()=>N,sA:()=>O,AA:()=>D,f2:()=>L});var a=r(99289),s=r(59169),n=r(22291),i=r(11405),o=r(23594),l=r(79312),c=r(54225),d=r(22803),u=r(26787);function g(e){let{array:t,batchSize:r}=e;return Array.from({length:Math.ceil(t.length/r)},(e,a)=>t.slice(a*r,(a+1)*r))}var m=r(69147);let p=e=>{let t={};return e.forEach((e,r)=>{var a,s,n,i,o,l,c,d,u;let g=e.data(),m={id:g.id,commit_sha:null!=(a=g.commit_sha)?a:"unknown",commit_message:null!=(s=g.commit_message)?s:"unknown",created_at:g.created_at,reverted:null!=(n=g.reverted)&&n,type:g.type,diff:null!=(i=g.diff)?i:null,status:null!=(o=g.status)?o:null,previewBuildStatus:null!=(l=g.preview_build_status)?l:null,bookmarked:null!=(c=g.bookmarked)&&c,revert_target_edit_id:null!=(d=g.revert_target_edit_id)?d:void 0,pages:null!=(u=g.pages)?u:[]};t[m.id]=m}),t};var f=r(90820);let h={FIRESTORE_BATCH_SIZE:30,COOLDOWN_TIME_MS:300,MESSAGES_PAGE_SIZE:30,EDIT_PAGE_SIZE:30,SCROLL_TO_MESSAGE_DELAY_MS:3e3};var v=r(76918),_=r(15402);(0,s.IP)();let y=()=>(0,v.vt)()((0,_.D)(e=>({sortedMessageIds:[],messages:{},edits:{},selectedImageUrl:void 0,imageUrlCache:{},loadingMessagesStatus:"idle",loadingEditsStatus:"idle",isInitialized:!1,hasOlderMessages:!0,hasOlderEdits:!0,canLoadMoreMessages:!0,canLoadMoreEdits:!0,stoppedMessageIds:new Set,latestStreamedMessage:void 0,abortControllers:[]})));function b(e,t){var r;return null!=(r=Object.values(e.messages).find(e=>"aiMessage"===e.type&&e.editId===t))?r:null}function S(e,t){var r;return null!=(r=Object.values(e.messages).find(e=>"userCommit"===e.type&&e.shortCommitHash===t))?r:null}function w(e,t){return Object.values(e.edits).find(e=>e.commit_sha.startsWith(t))||null}function E(e){var t,r;return null!=(r=null==(t=Object.values(e.edits).sort((e,t)=>{let r=e.created_at.toDate().getTime();return t.created_at.toDate().getTime()-r}).find(e=>!!e.pages&&!!e.pages.length))?void 0:t.pages)?r:null}function M(e){let{messages:t,sortedMessageIds:r}=e;for(let e=r.length-1;e>=0;e--){var a;let s=r[e];if((null==(a=t[s])?void 0:a.type)==="userMessage")return t[s]}return null}function k(e){let{messages:t,sortedMessageIds:r}=e;for(let e=r.length-1;e>=0;e--){var a;let s=r[e];if((null==(a=t[s])?void 0:a.type)==="aiMessage")return{messageId:s,message:t[s]}}return null}var I=r(28144),x=r(80617);let C=(0,i.createContext)(null),j=e=>{var t;let{projectId:r,children:v}=e,_=(0,n.useSearchParams)(),E=null!=(t=null==_?void 0:_.get("messageId"))?t:void 0,k=(0,i.useRef)(y()),j=(e=>{let[t,r]=(0,i.useState)(new Date),a=(0,i.useCallback)(()=>e.current.getState(),[e]);return{getStoreSnapshot:a,getPerformanceMetrics:(0,i.useCallback)(()=>{let r=e.current.getState();return{messageCount:Object.keys(r.messages).length,editCount:Object.keys(r.edits).length,memoryUsage:new Blob([JSON.stringify(r)]).size,lastUpdate:t}},[e,t]),resetStore:(0,i.useCallback)(()=>{e.current.setState(()=>y().getState()),r(new Date)},[e]),updateLastUpdate:()=>r(new Date)}})(k),T=function(e){let{projectId:t}=e;return(0,i.useMemo)(()=>(0,d.P)((0,d.rJ)(u.db,"projects",t,"trajectory"),(0,d.My)("created_at","desc")),[t])}({projectId:r}),P=function(e){let{projectId:t}=e;return(0,i.useMemo)(()=>(0,d.P)((0,d.rJ)(u.db,"projects",t,"edits"),(0,d._M)("type","in",[I.f.type.MANUAL_UPDATE,I.f.type.AI_UPDATE,I.f.type.DEVELOPER_UPDATE,I.f.type.REVERT]),(0,d.My)("created_at","desc")),[t])}({projectId:r}),A=function(e){let{projectId:t,messageId:r}=e;return(0,i.useMemo)(()=>r?(0,d.H9)(u.db,"projects",t,"trajectory",r):null,[t,r])}({projectId:r,messageId:E}),{updateMessage:R,removeMessage:D,isMostRecentMessage:O,getMessageByEditId:N,getUserCommitMessageByShortCommitHash:L,getUserMessageCount:U,getLastUserMessage:q}=function(e){let{storeRef:t}=e,r=(0,i.useCallback)((e,r,a)=>{if(!t.current.getState().isInitialized)return;let n=t.current.getState().messages[e];n&&a&&n.content===r.content&&("ai"!==r.role||"ai"!==n.role||n.thinkingTimeMs===r.thinkingTimeMs&&n.timeToFirstTokenMs===r.timeToFirstTokenMs)||t.current.setState((0,s.jM)(t=>{let s=n&&a?{...n,content:r.content}:r;"ai"===r.role&&"ai"===s.role&&a&&(s.thinkingTimeMs=r.thinkingTimeMs,s.timeToFirstTokenMs=r.timeToFirstTokenMs),t.messages[e]=s,a&&(t.sortedMessageIds=t.sortedMessageIds.filter(t=>t!==e),t.sortedMessageIds.push(e))}))},[t]),a=(0,i.useCallback)(e=>{t.current.setState(t=>{let{[e]:r,...a}=t.messages;return{messages:a,sortedMessageIds:t.sortedMessageIds.filter(t=>t!==e)}})},[t]),n=(0,i.useCallback)(e=>{let r=t.current.getState().sortedMessageIds;return r[r.length-1]===e},[t]),o=(0,i.useCallback)(e=>b(t.current.getState(),e),[t]),l=(0,i.useCallback)(e=>S(t.current.getState(),e),[t]);return{updateMessage:r,removeMessage:a,isMostRecentMessage:n,getMessageByEditId:o,getUserCommitMessageByShortCommitHash:l,getUserMessageCount:(0,i.useCallback)(()=>Object.values(t.current.getState().messages).filter(e=>"userMessage"===e.type).length,[t]),getLastUserMessage:(0,i.useCallback)(()=>M(t.current.getState()),[t])}}({storeRef:k}),{loadEarlierMessages:F,loadMessagesFromId:G,earliestMessageDocRef:V,processMessagesWithEdits:B}=function(e){let{storeRef:t,projectId:r,messagesQuery:a}=e,s=(0,i.useRef)(null),n=(0,i.useCallback)(async e=>{if(0===e.length)return{};let t=g({array:e,batchSize:h.FIRESTORE_BATCH_SIZE});return(await Promise.all(t.map(async e=>p((await (0,d.GG)((0,d.P)((0,d.rJ)(u.db,"projects",r,"edits"),(0,d._M)("id","in",e)))).docs)))).reduce((e,t)=>({...e,...t}),{})},[r]),o=(0,i.useCallback)(async(e,t)=>{let r=(0,f.m6)(e,t),a=e.map(e=>e.data().edit_id).filter(e=>!!e);return{messages:r,edits:await n(a)}},[n]),l=(0,i.useCallback)((e,r)=>{let{messages:a,edits:n}=r,i=e.map(e=>e.id);t.current.setState(e=>({messages:{...e.messages,...a},edits:{...e.edits,...n},sortedMessageIds:[...i,...e.sortedMessageIds]})),e.length>0&&(s.current=e[0])},[t]),c=(0,i.useCallback)(async()=>{let e=t.current.getState();if(s.current&&e.canLoadMoreMessages){t.current.setState({loadingMessagesStatus:"loading",canLoadMoreMessages:!1});try{let e=(await (0,d.GG)((0,d.P)(a,(0,d.HM)(s.current),(0,d.AB)(h.MESSAGES_PAGE_SIZE)))).docs.reverse();if(e.length>0){s.current=e[0];let r=await o(e,{persisted:!0});t.current.setState(t=>({messages:{...t.messages,...r.messages},edits:{...t.edits,...r.edits},hasOlderMessages:e.length>=h.MESSAGES_PAGE_SIZE,sortedMessageIds:[...e.map(e=>e.id),...t.sortedMessageIds]}))}else t.current.setState({hasOlderMessages:!1});t.current.setState({loadingMessagesStatus:"success"})}catch(e){t.current.setState({loadingMessagesStatus:"error"}),m.logging.warn("Firestore error - useMessageDataFetching - loadEarlierMessages",{error:e})}finally{setTimeout(()=>{t.current.setState({canLoadMoreMessages:!0})},h.COOLDOWN_TIME_MS)}}},[a,t,o]),v=(0,i.useCallback)((e,r)=>{let a=t.current.getState();return"message_id"===r?a.messages[e]:"shortCommitHash"===r?S(a,e):b(a,e)},[t]),_=(0,i.useCallback)(async e=>{let t=(0,d.P)(a,(0,d.rf)(s.current||void 0),(0,d.AB)(1e3)),r=(await (0,d.GG)(t)).docs.reverse(),n=await o(r,{persisted:!0});l(r,n)},[a,o,l]),y=(0,i.useCallback)(async(e,t)=>{let r=(0,d.P)(a,(0,d._M)("message_id"===t?"id":"edit_id","==",e),..."message_id"===t?[(0,d.AB)(1)]:[]),n=await (0,d.GG)(r);if(!n.docs[0])return;let i="message_id"===t?n.docs[0]:n.docs.find(e=>e.data().tag===x.g.tag.INSTANT_MODE_MESSAGE);if(!i)return;let c=(0,d.P)(a,(0,d.rf)(i),(0,d.HM)(s.current||void 0)),u=[i,...(await (0,d.GG)(c)).docs.reverse()],g=await o(u,{persisted:!0});l(u,g)},[a,o,l]);return{fetchEditsForMessages:n,processMessagesWithEdits:o,loadEarlierMessages:c,loadMessagesFromId:(0,i.useCallback)(async e=>{let{messageId:r,id_type:a="edit_id"}=e,s=v(r,a),n=t.current.getState();if(!(s&&n.sortedMessageIds.includes(s.id))){t.current.setState({loadingMessagesStatus:"loading"});try{"shortCommitHash"===a?await _(r):await y(r,a),t.current.setState({loadingMessagesStatus:"success"})}catch(e){t.current.setState({loadingMessagesStatus:"error"})}}},[v,_,y,t]),earliestMessageDocRef:s}}({storeRef:k,projectId:r,messagesQuery:T}),{loadEarlierEdits:W,earliestEditDocRef:z,fetchMessagesForEdits:H}=function(e){let{storeRef:t,projectId:r,editsQuery:a}=e,s=(0,i.useRef)(null),n=(0,i.useCallback)(async e=>{if(0===e.length)return{};let t=g({array:e,batchSize:h.FIRESTORE_BATCH_SIZE});return(await Promise.all(t.map(async e=>{let t=await (0,d.GG)((0,d.P)((0,d.rJ)(u.db,"projects",r,"trajectory"),(0,d._M)("edit_id","in",e)));return(0,f.m6)(t.docs,{persisted:!0})}))).reduce((e,t)=>({...e,...t}),{})},[r]);return{loadEarlierEdits:(0,i.useCallback)(async()=>{if(s.current&&t.current.getState().canLoadMoreEdits){t.current.setState({loadingEditsStatus:"loading",canLoadMoreEdits:!1});try{let e=(await (0,d.GG)((0,d.P)(a,(0,d.HM)(s.current),(0,d.AB)(h.EDIT_PAGE_SIZE)))).docs;if(e.length>0){s.current=e[e.length-1];let r=p(e),a=Object.keys(r),i=await n(a);t.current.setState(t=>({edits:{...t.edits,...r},messages:{...t.messages,...i},hasOlderEdits:e.length>=h.EDIT_PAGE_SIZE}))}else t.current.setState({hasOlderEdits:!1});t.current.setState({loadingEditsStatus:"success"})}catch(e){t.current.setState({loadingEditsStatus:"error"}),m.logging.warn("Firestore error - useEditOperations - loadEarlierEdits",{error:e})}finally{setTimeout(()=>{t.current.setState({canLoadMoreEdits:!0})},h.COOLDOWN_TIME_MS)}}},[a,t,n]),earliestEditDocRef:s,fetchMessagesForEdits:n}}({storeRef:k,projectId:r,editsQuery:P}),{getEditByShortCommitHash:Y,updateEdit:K}=function(e){let{storeRef:t}=e;return{getEditByShortCommitHash:(0,i.useCallback)(e=>w(t.current.getState(),e),[t]),updateEdit:(0,i.useCallback)((e,r)=>{let a=t.current.getState().edits[e];a&&Object.entries(r).some(e=>{let[t,r]=e;return a[t]!==r})&&t.current.setState((0,s.jM)(t=>{t.edits[e]&&Object.assign(t.edits[e],r)}))},[t])}}({storeRef:k}),{cacheImageUrl:Z,setSelectedImageUrl:J}=function(e){let{storeRef:t}=e;return{cacheImageUrl:(0,i.useCallback)((e,r)=>{t.current.getState().imageUrlCache[e]!==r&&t.current.setState((0,s.jM)(t=>{t.imageUrlCache[e]=r}))},[t]),setSelectedImageUrl:(0,i.useCallback)(e=>{t.current.getState().selectedImageUrl!==e&&t.current.setState((0,s.jM)(t=>{t.selectedImageUrl=e}))},[t])}}({storeRef:k}),{subscriptionBoundaryTime:$}=function(e){let{storeRef:t,messagesQuery:r,editsQuery:a,processMessagesWithEdits:s}=e,n=(0,i.useRef)(d.Dc.now());return(0,i.useEffect)(()=>{let e=t.current,s=(0,d.aQ)((0,d.P)(r,(0,d._M)("created_at",">=",n.current)),async t=>{let r=[...t.docs].reverse(),a=(0,f.m6)(r,{persisted:!0});e.setState(e=>{let t=new Set(e.sortedMessageIds),s=r.map(e=>e.id).filter(e=>!t.has(e));return{messages:{...e.messages,...a},sortedMessageIds:[...e.sortedMessageIds,...s]}})}),i=(0,d.aQ)((0,d.P)(a,(0,d._M)("created_at",">=",n.current)),t=>{let r=p([...t.docs]);e.setState(e=>({...e,edits:{...e.edits,...r}}))});return()=>{s(),i()}},[r,a,t,s]),{subscriptionBoundaryTime:n}}({storeRef:k,messagesQuery:T,editsQuery:P,processMessagesWithEdits:B}),Q=(0,i.useCallback)(e=>{try{if(k.current.getState().isInitialized===e)return;k.current.setState((0,s.jM)(t=>{t.isInitialized=e})),j.updateLastUpdate()}catch(e){}},[k,j]),{loadInitialData:X}=function(e){let{storeRef:t,messagesQuery:r,editsQuery:a,subscriptionBoundaryTime:s,earliestMessageDocRef:n,earliestEditDocRef:o,processMessagesWithEdits:l,fetchMessagesForEdits:c,messageId:u,specificMessageQuery:g}=e,m=(0,i.useRef)(null);return(0,i.useEffect)(()=>()=>{m.current&&(clearTimeout(m.current),m.current=null)},[]),{loadInitialData:(0,i.useCallback)(async()=>{let e;if(u&&g){let t=await (0,d.x7)(g);t.exists()?(e=await (0,d.GG)((0,d.P)(r,(0,d._M)("created_at","<",s.current),(0,d.FD)(t))),m.current=setTimeout(()=>{let e=document.getElementById(u);e&&(e.scrollIntoView({block:"start"}),e.classList.add("animate-message-highlight"),e.addEventListener("animationend",()=>{e.classList.remove("animate-message-highlight")},{once:!0}))},h.SCROLL_TO_MESSAGE_DELAY_MS)):e=await (0,d.GG)((0,d.P)(r,(0,d._M)("created_at","<",s.current),(0,d.AB)(h.MESSAGES_PAGE_SIZE)))}else e=await (0,d.GG)((0,d.P)(r,(0,d._M)("created_at","<",s.current),(0,d.AB)(h.MESSAGES_PAGE_SIZE)));let i=e.docs.reverse();i.length>0&&(n.current=i[0]);let{messages:f,edits:v}=await l(i,{persisted:!0}),_=await (0,d.GG)((0,d.P)(a,(0,d._M)("created_at","<",s.current),(0,d.AB)(h.EDIT_PAGE_SIZE)));_.docs.length>0&&(o.current=_.docs[_.docs.length-1]);let y=p(_.docs),b=p((await (0,d.GG)((0,d.P)(a,(0,d._M)("bookmarked","==",!0)))).docs),S=Object.keys(b),w={};S.length>0&&(w=await c(S)),t.current.setState(t=>{let r={...t.messages,...f,...w},a=[...new Set([...t.sortedMessageIds,...i.map(e=>e.id)])];return a=a.sort((e,t)=>{let a=r[e],s=r[t];return a.createdAt.getTime()-s.createdAt.getTime()}),{messages:r,hasOlderMessages:!!u||e.docs.length>=h.MESSAGES_PAGE_SIZE,edits:{...t.edits,...v,...y,...b},hasOlderEdits:_.docs.length>=h.EDIT_PAGE_SIZE,sortedMessageIds:a,isInitialized:!0}})},[r,a,s,n,o,l,c,t,u,g])}}({storeRef:k,messagesQuery:T,editsQuery:P,subscriptionBoundaryTime:$,earliestMessageDocRef:V,earliestEditDocRef:z,processMessagesWithEdits:B,fetchMessagesForEdits:H,messageId:E,specificMessageQuery:A}),{setLatestStreamedMessage:ee,addStoppedMessageId:et,isMessageStopped:er,addAbortController:ea,removeAbortController:es}=function(e){let{storeRef:t}=e,r=(0,i.useCallback)((e,r)=>{r&&e?t.current.setState(t=>({...t,sortedMessageIds:[...t.sortedMessageIds,e.id],latestStreamedMessage:e,messages:{...t.messages,[e.id]:e}})):t.current.setState(t=>({...t,latestStreamedMessage:e}))},[t]),a=(0,i.useCallback)(e=>{e&&t.current.setState(t=>({...t,stoppedMessageIds:new Set([...t.stoppedMessageIds,e])}))},[t]),s=(0,i.useCallback)(e=>{let r=t.current.getState();return!!r.latestStreamedMessage&&"stopped"in r.latestStreamedMessage&&!!r.latestStreamedMessage.stopped||r.stoppedMessageIds.has(e)},[t]);return{setLatestStreamedMessage:r,addStoppedMessageId:a,isMessageStopped:s,addAbortController:(0,i.useCallback)(e=>{t.current.setState(t=>({...t,abortControllers:[...t.abortControllers,e]}))},[t]),removeAbortController:(0,i.useCallback)(e=>{t.current.setState(t=>({...t,abortControllers:t.abortControllers.filter(t=>t!==e)}))},[t])}}({storeRef:k}),{setIsSendChatMessageMutationPending:en}=(0,c.sK)(),ei=(0,i.useCallback)(()=>{try{en(!1),k.current.getState().abortControllers.forEach(e=>{e.abort()}),k.current.setState(e=>({...e,abortControllers:[]})),j.updateLastUpdate()}catch(e){}},[en,k,j]),{permitted:eo}=(0,o.J)(l.eZ.EditProject);(0,i.useEffect)(()=>{eo&&X()},[X,eo]),(0,i.useEffect)(()=>{},[j]);let el=(0,i.useMemo)(()=>({getEditByShortCommitHash:Y,getMessageByEditId:N,getUserCommitMessageByShortCommitHash:L,getUserMessageCount:U,getLastUserMessage:q}),[Y,N,L,U,q]),ec=(0,i.useMemo)(()=>({getStoreSnapshot:j.getStoreSnapshot,getPerformanceMetrics:j.getPerformanceMetrics,resetStore:j.resetStore}),[j]),ed={store:k.current,updateMessage:R,removeMessage:D,setIsInitialized:Q,loadEarlierMessages:F,loadMessagesFromId:G,loadEarlierEdits:W,cacheImageUrl:Z,setSelectedImageUrl:J,isMostRecentMessage:O,updateEdit:K,setLatestStreamedMessage:ee,addStoppedMessageId:et,isMessageStopped:er,addAbortController:ea,removeAbortController:es,abortRequests:ei,debug:ec,snapshot:el};return(0,a.jsx)(C.Provider,{value:ed,children:v})};function T(){let e=(0,i.useContext)(C);if(!e)throw Error("useChatContext must be used within a ChatProvider");return e}function P(e){let t=T();if(!t)throw Error("useChatStore must be used within a ChatProvider");return t.store(e)}function A(e){return P(t=>e?t.edits[e]:null)}function R(e){return P(t=>e?w(t,e):null)}function D(){return P(E)}function O(){return P(M)}function N(){return P(k)}function L(e){return P(t=>e?b(t,e):null)}},2904:(e,t,r)=>{r.d(t,{G:()=>g,f:()=>p});var a=r(34363),s=r(51252),n=r(11405),i=r(98213),o=r(99490),l=r(33256),c=r(273),d=r(73728),u=r(9563);let g=e=>{let{workspaceId:t}=e,r=(0,d.tY)()?(0,u.Iw)(e=>{var t;return null==(t=e.project)?void 0:t.id}):void 0,{data:s,isLoading:n}=(0,a.I)({queryKey:c.workspaceKeys.supabaseOrganizations(t,r),queryFn:async()=>{let e=(0,l.P)();return await e.get(r?"/projects/".concat(r,"/workspace/supabase-organizations"):"/workspaces/".concat(t,"/supabase-organizations"))},enabled:!!t}),i=!s||0===s.length;return{supabaseOrganizations:s,isLoading:n,noOrganizations:i}},m=o.Ik({type:o.eu("supabaseAuth"),success:o.zM(),error:o.Yj().optional()}),p=e=>{let{workspaceId:t,onConnectSuccess:r}=e,a=(0,s.jE)(),o=(0,d.tY)()?(0,u.Iw)(e=>{var t;return null==(t=e.project)?void 0:t.id}):void 0;(0,n.useEffect)(()=>{let e=async e=>{if(e.origin!==window.location.origin)return;let s=m.safeParse(e.data);s.success&&(s.data.success?(i.toast.success("Connection Successful",{description:"Your Supabase organization has been linked to your workspace. Select a project to finish the setup."}),await a.invalidateQueries({queryKey:c.workspaceKeys.supabaseOrganizations(t,o)}),null==r||r()):i.toast.error("Connection Failed",{description:s.data.error||"Failed to connect to Supabase. Please try again."}))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[a,t,r])}},3158:(e,t,r)=>{r.d(t,{pA:()=>H,Yi:()=>j,jn:()=>z,E7:()=>B,$E:()=>T,Nc:()=>P,sF:()=>A});var a=r(99289),s=r(34363),n=r(90895),i=r(11405),o=r(83640),l=r(76918),c=r(15402),d=r(42581),u=r(69147);let g=e=>{var t,r,a,s,n,i,o,l;let c=Object.entries(e.headers||{}).reduce((e,t)=>{let[r,a]=t;return e+r.length+String(a).length},0);return((null==(t=e.responseBody)?void 0:t.length)||0)+((null==(r=e.requestBody)?void 0:r.length)||0)+((null==(s=e.error)||null==(a=s.message)?void 0:a.length)||0)+((null==(i=e.error)||null==(n=i.stack)?void 0:n.length)||0)+((null==(o=e.url)?void 0:o.length)||0)+((null==(l=e.statusText)?void 0:l.length)||0)+c};var m=r(80587),p=r(82594),f=r(33256),h=r(51255),v=r(24594),_=r(14026),y=r(92936),b=r(87350),S=r(44767);let w=e=>{let{isLoading:t}=e,[r,s]=(0,i.useState)(0),[n,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{t&&(s(0),o(!0))},[t]),(0,i.useEffect)(()=>{if(!t)return void s(100);let e=[];return[{duration:150,increment:15},{duration:250,increment:10},{duration:400,increment:5},{duration:500,increment:3},{duration:650,increment:3},{duration:750,increment:3},{duration:1500,increment:2},{duration:2e3,increment:1},{duration:3e3,increment:1},{duration:4e3,increment:1},{duration:5e3,increment:1},{duration:6e3,increment:1},{duration:7e3,increment:1},{duration:1e4,increment:1},{duration:14e3,increment:1}].forEach(t=>{let{duration:r,increment:a}=t,n=setTimeout(()=>{s(e=>e<75?e+a+2*Math.random():e)},r);e.push(n)}),()=>{e.forEach(e=>clearTimeout(e))}},[t]),(0,a.jsx)("div",{className:"pointer-events-none absolute left-0 right-0 top-0 h-[3px] w-full overflow-hidden bg-transparent",children:(0,a.jsx)(b.N,{children:n&&(0,a.jsx)(S.P.div,{className:"h-full bg-accent",initial:{width:0,opacity:1},animate:{width:"".concat(Math.min(r,100),"%"),opacity:1},exit:{opacity:0,transition:{delay:.2,duration:.3}},transition:{width:{duration:.15,bounce:0}},onAnimationComplete:()=>{t||o(!1)}})})})};function E(e){if(!e)return null;try{return e.replace("http://","ws://").replace("https://","wss://")}catch(e){return null}}var M=r(54225),k=r(90277),I=r(9563),x=r(64285);let C=(0,i.createContext)(null);function j(e){let{children:t}=e,r=(0,p.B)(),[s]=(0,i.useState)(()=>(0,l.vt)()((0,c.D)(()=>({device:"desktop",customScript:!1,_sandboxState:null,_isSandboxStateStale:!1,isStartingSandboxInTheBackground:!1,targetMode:k.a.STATIC,activeMode:k.a.STATIC,visibleMode:k.a.STATIC,currentPath:"/",baseUrls:{static:(0,h.O)({projectId:r}),live:null},error:null,consoleLogs:[],networkRequests:[],rrwebEvents:[],accessToken:void 0})))),d=(0,i.useRef)(null),g=(0,i.useRef)(null),_=(0,i.useMemo)(()=>({live:d,static:g}),[]),b=s(e=>e.targetMode===k.a.LIVE&&"running"===e._sandboxState?k.a.LIVE:k.a.STATIC);(0,i.useEffect)(()=>{s.setState(e=>{e.activeMode=b})},[b,s]),(0,i.useEffect)(()=>{if("live"!==b)return void s.setState(e=>{e.visibleMode=k.a.STATIC});if("live"===b){let e=setTimeout(()=>{s.setState(e=>{e.visibleMode=k.a.LIVE})},3e3);return()=>clearTimeout(e)}},[b,s]);let S=s(e=>e.targetMode),w=s(e=>e._sandboxState);!function(e){let t=(0,f.P)(),r=(0,p.B)(),{setIsBuildErrorOccurredDuringStream:a}=(0,M.sK)(),s=(0,v.V)(),n=(0,i.useMemo)(()=>{let t=e.enabled&&e.url?new URL(e.url):null;return t?E("".concat(t.protocol,"//").concat(t.host)):null},[e.enabled,e.url]);(0,o.useWebSocket)(n,{protocols:"vite-hmr",share:!0,onMessage:e=>{try{let i=JSON.parse(e.data);if((null==i?void 0:i.type)==="update"){let e=Date.now()-500;s.updateLatestBuildTimestamp(e)}if((null==i?void 0:i.type)==="error"){var n;a(!0),u.logging.info("build_error_from_devserver",{message:null==i||null==(n=i.err)?void 0:n.message});let e=y.J.safeParse(null==i?void 0:i.err);e.success?(0,m.N)(e.data,r,t):(u.logging.error("error_parsing_devserver_error",{error:e}),(0,m.N)(null==i?void 0:i.err,r,t))}}catch(e){u.logging.error("error_parsing_devserver_error",{error:e})}},onOpen:t=>{var r;null==(r=e.onStatusChange)||r.call(e,"running"),u.logging.debug("devserver_websocket_open")},onClose:t=>{var r;null==(r=e.onStatusChange)||r.call(e,"stopped"),u.logging.debug("devserver_websocket_close")},onError:t=>{var r;null==(r=e.onStatusChange)||r.call(e,"error"),u.logging.error("devserver_websocket_error",{event:t})},shouldReconnect:()=>!0,reconnectInterval:1e3})}({enabled:"live"===S&&"running"===w,url:s(e=>e.baseUrls.live)});let x=e=>{s.setState(t=>{t.device=e})},j=e=>{s.setState(t=>{t.customScript=e})},T=(0,i.useCallback)(()=>{s.setState(e=>{e.targetMode="static",e._sandboxState=null,e._isSandboxStateStale=!0,e.error=null})},[s]),P=(0,i.useCallback)(()=>{s.setState(e=>{("live"!==e.targetMode||"running"!==e._sandboxState||e.error)&&(e.targetMode="live",e._sandboxState="starting",e.error=null,e.isStartingSandboxInTheBackground=!0)})},[s]),A=(0,i.useCallback)(()=>{s.setState(e=>{("live"!==e.targetMode||"running"!==e._sandboxState||e.error)&&(e.targetMode="live",e._sandboxState="starting",e.error=null,e.isStartingSandboxInTheBackground=!1)})},[s]),R=(0,i.useCallback)(e=>{s.setState(e=>{e._sandboxState="starting",e.targetMode="live",e.error=null})},[s]),V=(0,i.useCallback)(()=>{s.setState(e=>{e._sandboxState="error",e.error={type:"dev_server",message:"Sorry, we ran into an issue starting the live preview!"}})},[s]),B=(0,i.useCallback)(async()=>{s.setState(e=>{e._sandboxState="starting",e.error=null});try{let e=(0,f.P)(),t=await e.post("/projects/".concat(r,"/sandbox/start"),{project_id:r});s.setState(e=>{t.url&&!t.url.endsWith("/")&&(t.url=t.url+"/"),e.baseUrls.live=t.url,e._isSandboxStateStale=!0})}catch(e){V()}},[r,V,s]),W=(0,i.useCallback)(async e=>{let t=s.getState();if("live"===t.targetMode&&(t.error||"error"===t._sandboxState)){R(),s.setState(t=>{t.currentPath=null!=e?e:"/"});return}if(e)s.setState(t=>{t.currentPath=e});else{var r;null==(r=_[t.targetMode].current)||r.reload()}},[_,R,s]),z=(0,i.useCallback)(()=>{s.setState(e=>{e._sandboxState="running",e.error=null})},[s]),H=(0,i.useMemo)(()=>({store:s,setDevice:x,setCustomScript:j,startLiveMode:A,startLiveModeInBackground:P,restartLiveMode:R,revertToStaticMode:T,refreshPreview:W,refs:_,buildFullPreviewUrl:G}),[]),Y=(0,I.Iw)(e=>{var t;return null==(t=e.project)?void 0:t.latest_commit_sha}),K=s(e=>"live"===e.targetMode&&"starting"===e._sandboxState)&&!!Y;(0,i.useEffect)(()=>{K&&B()},[B,K]);let Z=(0,n.UQ)(18e5);return(0,a.jsxs)(C.Provider,{value:H,children:[(0,a.jsx)(D,{}),(0,a.jsx)(N,{}),"live"===b&&(0,a.jsx)(O,{}),"live"===S&&"error"!==w&&!Z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(U,{}),(0,a.jsx)(L,{}),(0,a.jsx)(q,{}),(0,a.jsx)(F,{onStarted:z,onFatalError:V,onTransientError:R,onInactivityTimeout:T})]}),t]})}function T(){let e=(0,i.useContext)(C);if(!e)throw Error("usePreviewContext must be used within a PreviewProvider");return e}function P(e){let{store:t}=T();return t(e)}function A(){let e=P(e=>e.baseUrls.live);return(0,i.useMemo)(()=>{if(!e)return null;let t=new URL(e);return E("".concat(t.protocol,"//").concat(t.host))},[e])}let R=async e=>{let t;try{if(!(t=await fetch("".concat(e,"_sandbox/dev-server"),{signal:AbortSignal.timeout(9e3)})).ok)return"offline"}catch(e){return"unknown"}try{let e=await t.json();switch(e.state){case"error":case"stopped":case"stopping":case"disabled":case"starting":case"started":case"disabled":return e.state;default:return u.logging.error("unexpected_dev_server_state",{state:e.state}),"unknown"}}catch(e){return u.logging.debug("malformed_dev_server_state_response",{error:e}),"error"}};function D(){let e=T().refs[k.a.STATIC],t=(0,I.Iw)(e=>{var t;return null==(t=e.project)?void 0:t.preview_build_commit_sha}),r=(0,i.useRef)(t);return(0,i.useEffect)(()=>{if(t&&r.current&&t!==r.current){var a;null==(a=e.current)||a.reload()}r.current=t},[t,e]),null}function O(){let e=T().refs[k.a.LIVE];return(0,i.useEffect)(()=>{var t;null==(t=e.current)||t.reload()},[e]),null}function N(){let e=P(e=>e.targetMode),t=T().startLiveMode,r=(0,M.wV)(e=>e.isSendChatMessageMutationPending);return(0,i.useEffect)(()=>{r&&"static"===e&&t()},[r,e,t]),null}function L(){let e=P(e=>e._isSandboxStateStale),t=T().store;return(0,i.useEffect)(()=>{if(e)return;let r=setTimeout(()=>{t.setState(e=>{e._isSandboxStateStale=!0})},"starting"===t.getState()._sandboxState?250:1e4);return()=>clearTimeout(r)},[e,t]),null}function U(){let e=T().store;return(0,i.useEffect)(()=>{e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})},[e]),null}function q(){let e=T().store;return(0,i.useEffect)(()=>{let t=()=>{"visible"===document.visibilityState&&e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[e]),null}function F(e){let{onStarted:t,onTransientError:r,onFatalError:a,onInactivityTimeout:s}=e,n=P(e=>e._isSandboxStateStale),o=T().store;return(0,i.useEffect)(()=>{if(!n)return;let e=!0;return async function(){try{let n=o.getState().baseUrls.live;if(!n)return;let i=await R(n);if(!e)return;switch(i){case"offline":s();case"error":a();break;case"unknown":case"stopped":r();break;case"started":t()}}finally{if(!e)return;o.setState(e=>{e._isSandboxStateStale=!1})}}(),()=>{e=!1}},[n,a,r,t,s,o]),null}function G(e){let{baseUrl:t,path:r}=e;if(!t)return null;let a=t.endsWith("/")?t.slice(0,-1):t,s=r.startsWith("/")?r:"/".concat(r);return"".concat(a).concat(s)}let V=(0,i.forwardRef)((e,t)=>{let{url:r,useCustomScript:n,onNavigate:o,onMessage:l,id:c}=e,u=(0,i.useRef)(null),[g,m]=(0,i.useState)(null),[p,h]=(0,i.useState)(!0),v=(0,I.Iw)(e=>e.project),_=(e=>(0,s.I)({queryKey:["projects",e,"accessToken"],queryFn:async()=>{let t=(0,f.P)(),{token:r}=await t.get("/projects/".concat(e,"/auth-token"));return r},enabled:!!e}))(null==v?void 0:v.id);return(0,i.useImperativeHandle)(t,()=>({reload(){u.current&&(u.current.src=u.current.src)}})),(0,i.useEffect)(()=>{if(!u.current)return;let e=!1;try{let t=(0,x.Z)(r||"");e="livePreview"===t.mode}catch(e){}let t=v&&!v.is_protected&&!e||"pending"!=_.status;if(r&&r!==g&&t){let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";try{let r=new URL(e);return t.useCustomScript&&r.searchParams.set("lov-override-script","true"),t.accessToken&&r.searchParams.set("__lovable_token",t.accessToken),r.toString()}catch(t){return e}}(r,{useCustomScript:n,accessToken:_.data});m(r),h(!0),u.current.src=e}},[_,g,o,r,n]),(0,i.useEffect)(()=>{let e=e=>{var t;if((null==(t=u.current)?void 0:t.contentWindow)===e.source)if("URL_CHANGED"===e.data.type){if(e.data.url!==g&&(m(e.data.url),e.data.url)){let{pathname:t,search:r,hash:a}=new URL(e.data.url),s=t;r&&(s+=r),a&&(s+=a),o(s)}}else"404"===e.data?h(!1):l(e)};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[g,l,o]),(0,a.jsxs)(a.Fragment,{children:[p&&(0,a.jsx)(w,{isLoading:!0}),(0,a.jsx)("iframe",{sandbox:d.Z,ref:u,id:c,className:"min-h-full w-full flex-grow",allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;",onLoad:()=>h(!1),onError:()=>{h(!1)}})]})});V.displayName="PreviewIframe";let B=e=>"".concat(e,"-preview-panel");function W(e){let t=B(e);return(0,i.memo)(function(){let r=P(t=>t.activeMode===e),s=P(e=>e.currentPath),[n,o]=(0,i.useState)(s);(0,i.useEffect)(()=>{r&&o(s)},[r,s]);let{fullUrl:l,customScript:c}=P(t=>({fullUrl:G({baseUrl:t.baseUrls[e],path:n}),customScript:t.customScript})),d=(0,i.useMemo)(()=>l,[l]),{store:h}=T(),b=T().refs[e],S=(0,p.B)(),w=(0,v.V)(),E=(0,f.P)(),M=(0,i.useCallback)(e=>{o(e),r&&h.setState(t=>{t.currentPath!==e&&(t.currentPath=e)})},[h,r,o]),k=(0,i.useCallback)(e=>{if(r){var t,a;if(!function(e,t){if("CONSOLE_OUTPUT"!==e.data.type)return;let r=[];if(Array.isArray(e.data.messages))e.data.messages.forEach(t=>{"object"==typeof t&&null!==t&&"string"==typeof t.message&&"string"==typeof t.level?r.push({level:t.level,message:t.message.length>1e4?t.message.slice(0,1e4):t.message,logged_at:t.logged_at||e.data.logged_at||new Date().toISOString()}):u.logging.warn("Received invalid message format within messages array",{msgData:t})});else{if("string"!=typeof e.data.message||"string"!=typeof e.data.level)return u.logging.warn("Received invalid CONSOLE_OUTPUT data format",{data:e.data});r.push({level:e.data.level,message:e.data.message.length>1e4?e.data.message.slice(0,1e4):e.data.message,logged_at:e.data.logged_at||new Date().toISOString()})}t(e=>{r.length>50?e.consoleLogs=r.slice(0,50):e.consoleLogs.push(...r);let t=e.consoleLogs.reduce((e,t)=>e+t.message.length,0);for(;t>1e4||e.consoleLogs.length>50;){let r=e.consoleLogs.shift();if(!r)break;t-=r.message.length}})}(e,h.setState),t=h.setState,"NETWORK_REQUEST"===e.data.type&&t(t=>{let r={...e.data.request};r.responseBody&&r.responseBody.length>1e4&&(r.responseBody=r.responseBody.slice(0,1e4)),r.requestBody&&r.requestBody.length>1e4&&(r.requestBody=r.requestBody.slice(0,1e4)),r.error&&(r.error.message&&r.error.message.length>1e4&&(r.error.message=r.error.message.slice(0,1e4)),r.error.stack&&r.error.stack.length>1e4&&(r.error.stack=r.error.stack.slice(0,1e4))),r.url&&r.url.length>1e4&&(r.url=r.url.slice(0,1e4)),r.statusText&&r.statusText.length>1e4&&(r.statusText=r.statusText.slice(0,1e4)),t.networkRequests.push(r);let a=t.networkRequests.reduce((e,t)=>e+g(t),0);for(;a>1e5||t.networkRequests.length>50;){let e=t.networkRequests.shift();if(!e)break;a-=g(e)}}),a=h.setState,"RRWEB_EVENT"===e.data.type&&a(t=>{for(t.rrwebEvents.push(e.data.event);t.rrwebEvents.length>60;)t.rrwebEvents.shift()}),"RUNTIME_ERROR"===e.data.type||"UNHANDLED_PROMISE_REJECTION"===e.data.type)w.addRuntimeError(e.data.error,e.data.type);else if("FETCH_ERROR"===e.data.type){let t=y.p.safeParse(e.data.error),r=t.success?t.data:e.data.error;t.error&&u.logging.error("error_parsing_fetch_error",{error:t.error,event_data:e.data}),"status"in r&&(null==r?void 0:r.status)>=400&&(null==r?void 0:r.status)<500?(0,m.N)({...r,error_type:_.B.HTTP_CLIENT_ERROR},S,E):(0,m.N)({...r,error_type:_.B.HTTP_SERVER_ERROR},S,E)}}},[r,h,w,S,E]);return(0,a.jsx)(V,{ref:b,id:t,url:d,useCustomScript:c,onNavigate:M,onMessage:k})})}let z=W("static"),H=W("live")},4440:(e,t,r)=>{r.d(t,{HA:()=>d,IM:()=>i,Sr:()=>l,lG:()=>c});var a=r(99289),s=r(11405),n=r(76918),i=function(e){return e.VIEW="view",e.CHAT="chat",e}({});let o=(0,s.createContext)(null),l=e=>{let{children:t}=e,r=(0,s.useRef)((0,n.vt)(()=>({mobileView:"chat",isPreviewDocked:!0,showHistoryPanel:!1}))),i={store:r.current,setMobileView:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({mobileView:e(t.mobileView)})):t.setState({mobileView:e})},setIsPreviewDocked:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({isPreviewDocked:e(t.isPreviewDocked)})):t.setState({isPreviewDocked:e})}};return(0,a.jsx)(o.Provider,{value:i,children:t})};function c(){let e=(0,s.useContext)(o);if(!e)throw Error("useMobileContext must be used within a MobileProvider");return e}function d(e){let{store:t}=c();return t(e)}},14026:(e,t,r)=>{r.d(t,{B:()=>a});var a=function(e){return e.IMMEDIATE_RUNTIME="immediate_runtime",e.RUNTIME="runtime",e.BUILD="build",e.DEPLOY_SUPABASE_FUNCTIONS="deploy_supabase_functions",e.HTTP_CLIENT_ERROR="http_client_error",e.CORS_ERROR="cors_error",e.HTTP_SERVER_ERROR="http_server_error",e.NO_CODE_CHANGE="no_code_change",e.CODE_DIFF="code_diff",e.FILE_EDITED_WITHOUT_PERMISSION="file_edited_without_permission",e.EXCLUDED_FILE_EDITED="excluded_file_edited",e.SUPABASE_EDGE_FUNCTION_ERROR="supabase_edge_function_error",e.DEPENDENCY_INSTALL="dependency_install",e.SUPABASE_SQL_ERROR="supabase_sql_error",e.SEARCH_REPLACE_FAILED="search_replace_failed",e.SEARCH_REPLACE_MISSING_FILE="search_replace_missing_file",e.CHANGED_MISSING_FILE="changed_missing_file",e.RENAME_FAILED="rename_failed",e.DELETION_FAILED="deletion_failed",e}({})},23719:(e,t,r)=>{r.d(t,{wL:()=>x,mg:()=>C,Qd:()=>k});var a=r(6919),s=r(81797),n=r(98213),i=r(45494),o=r(77233),l=r(74846),c=r(1965),d=r(69147),u=r(53822),g=r(54225),m=r(40408),p=r(87887),f=r(30315),h=r(46981),v=r(11405),_=r(24594),y=r(3158),b=r(33256),S=r(332),w=r(31167),E=r(39365),M=r(61255);function k(e){let t=(0,m.U)();return C({...e,repoAccessibilityState:t})}let I={};function x(e){return I[e.id]||(I[e.id]=(0,i.Oy)("aimsg").toString()),e.ai_message_id=I[e.id],e}function C(e){let{projectId:t,onRepoInaccessible:r,onSubmit:i,onSuccess:m,repoAccessibilityState:k}=e,I=(0,u.s)(e=>e.currentPage),{setIsSendChatMessageMutationPending:C}=(0,g.sK)(),{createChatRequestPerformanceMeasurer:j}=(0,E.H)(),{isRepoAccessible:T,removeLatestMessageIfRepoInaccessible:P}=function(){let{restoreEditorState:e}=(0,w.Xl)(),{removeMessage:t}=(0,S.vd)(),r=(0,v.useCallback)(e=>!e||(null==e?void 0:e.accessibility)==="repo_accessible"||(null==e?void 0:e.accessibility)==="repo_not_found",[]);return{isRepoAccessible:r,removeLatestMessageIfRepoInaccessible:(a,s,i)=>{r(a)||(r=>{let{onRepoInaccessible:a,latestMessageId:s}=r;null==a||a(),e(),n.toast.error("We couldn't access this project repository."),s&&t(s)})({onRepoInaccessible:i,latestMessageId:s})}}}(),{sendChatRequest:A}=function(){let{prepareMessageDiagnostics:e}=function(){let e=(0,_.V)(),{store:t}=(0,y.$E)();return{prepareMessageDiagnostics:(0,v.useCallback)(r=>{let{runtimeErrors:a,latestBuildTimestamp:s}=e.store.getState();r.session_replay=(e=>{let t=e.map(e=>{let t=JSON.stringify(e);return t.length>1e4?{type:e.type,timestamp:e.timestamp,data:{truncated:!0,originalSize:t.length}}:e}),r=0,a=[];for(let e=t.length-1;e>=0;e--){let s=JSON.stringify(t[e]);if(r+s.length<=1e6)a.unshift(t[e]),r+=s.length;else break}return JSON.stringify(a)})(t.getState().rrwebEvents);let n=t.getState().consoleLogs.length,i=t.getState().networkRequests.length;r.client_logs=[...t.getState().consoleLogs.slice(Math.max(n-50,0),n)],r.network_requests=[...t.getState().networkRequests.slice(Math.max(i-50,0),i)],r.runtime_errors=[...a].filter(e=>e.timestamp>=s),e.clearDiagnostics(),t.setState(e=>{e.consoleLogs=[],e.networkRequests=[],e.rrwebEvents=[]})},[e,t])}}();return{sendChatRequest:async t=>{let{projectId:r,body:a,onStart:s,onComplete:n}=t;e(a),null==s||s();let i=(0,b.P)();try{await i.post("/projects/".concat(r,"/chat"),a)}finally{null==n||n()}}}}(),{createOptimisticMessage:R}=(0,M.h)(),{selectedModel:D}=(0,o.Y$)(),{getActiveViewDescription:O}=(0,f.At)(),{view:N,description:L}=O(),{showErrorDialog:U}=(0,p.f)(),q=(0,l.X5)(),F=async(e,a)=>{"preview"===N&&(e.current_page=I),e.view=N,e.view_description=L,"auto"!==D&&(e.model=D);let s=a||t;if(!s){let e=Error("Project ID is required to send chat message");throw d.logging.error("missing_project_id",{error:e.message}),e}let{measureRequestStart:n}=j({projectId:s});if(!T(k)){var i;P(k,null!=(i=e.id)?i:void 0,r);return}await A({projectId:s,body:e,onStart:n})};return(0,a.n)({mutationFn:async e=>{let{body:r,projectId:a}=e;C(!0);let s=a||t;if(!s){let e=Error("Project ID is required to send chat message");throw d.logging.error("missing_project_id_in_mutation",{error:e.message}),e}return F(x(r),s)},onMutate:e=>{let{body:t,onRequestSent:r}=e;R({body:x(t)}),null==i||i(t.message),null==r||r()},onSuccess:()=>{null==m||m()},onError:(e,t)=>{let{onError:r}=t;if(C(!1),"AbortError"!==e.name){if(e instanceof c.L){switch(e.status){case 402:s.Ay.capture("out_of_credits_dialog_opened"),q();break;case 429:d.logging.error("rate_limit_exceeded",{error:e}),(0,h.np)(),s.Ay.capture("send_chat_request_rate_limit_exceeded"),e.message.includes("We are currently under heavy load, please try again later")?n.toast.error("We are currently under heavy load, please try again later"):U(e.message,!1,e.traceId);break;case 499:d.logging.info("send_chat_request_client_closed",{error:e});break;case 503:d.logging.error("send_chat_request_service_unavailable",{error:e});default:d.logging.error("send_chat_request_internal_error",{error:e}),U(e.details||e.message,!1,e.traceId)}return}U(),null==r||r()}}})}},24594:(e,t,r)=>{r.d(t,{X:()=>p,V:()=>f});var a=r(99289),s=r(11405),n=r(76918),i=r(80587),o=r(82594),l=r(69147),c=r(99490);let d=c.Ik({message:c.Yj().min(1),stack:c.Yj().optional(),filename:c.Yj().optional(),lineno:c.ai().optional(),colno:c.ai().optional(),blankScreen:c.zM().optional()});var u=r(33256);let g=()=>(0,n.vt)(()=>({runtimeErrors:[],latestBuildTimestamp:0})),m=(0,s.createContext)({store:g(),clearDiagnostics:()=>{},clearBlankScreenErrors:()=>{},updateLatestBuildTimestamp:()=>{},addRuntimeError:()=>{throw Error("ProjectDiagnostics must be used within a ProjectDiagnosticsProvider")}}),p=e=>{let{children:t}=e,r=(0,o.M)();if(!r)throw Error("Project ID is required and should always be set here");let n=(0,s.useRef)(void 0);n.current||(n.current=g());let c=(0,u.P)(),p={store:n.current,clearDiagnostics:()=>{n.current.setState({runtimeErrors:[]})},addRuntimeError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUNTIME_ERROR",a=function(e){let t=d.safeParse(e);return t.success?(t.data.stack||l.logging.warn("diagnostics.runtime_error.stack_missing",{parse_error:t.error,error_data:e}),t.data.filename||l.logging.warn("diagnostics.runtime_error.filename_missing",{parse_error:t.error,error_data:e}),t.data):(l.logging.error("diagnostics.runtime_error.invalid",{parse_error:t.error,error_data:e}),null)}(e);if(!a)return;a.blankScreen&&(0,i.N)({...a,error_type:"runtime"},r,c).catch(e=>{l.logging.error("error_reporting_runtime_error",{error:e})});let s=n.current,o=function(e,t){let r={timestamp:Date.now(),error_type:e,message:t.message||"Unknown error",filename:t.filename||"Unknown file",lineno:t.lineno||0,colno:t.colno||0,stack:t.stack||"Unavailable",has_blank_screen:(null==t?void 0:t.blankScreen)||!1};return r.message.length>1e4&&(r.message=r.message.slice(0,1e4)),r.stack.length>1e4&&(r.stack=r.stack.slice(0,1e4)),r}(t,a);s.setState(e=>{let t=[...e.runtimeErrors],r=t.findIndex(e=>0==e.lineno?e.message===o.message:e.filename===o.filename&&e.colno===o.colno&&e.lineno===o.lineno);-1!==r&&t.splice(r,1),t.push(o);let a=t.reduce((e,t)=>e+h(t),0);for(;a>1e5||t.length>50;){let e=t.shift();if(!e)break;a-=h(e)}return{runtimeErrors:t}})},updateLatestBuildTimestamp:e=>{let t=n.current;e>t.getState().latestBuildTimestamp&&t.setState({latestBuildTimestamp:e})},clearBlankScreenErrors:()=>{let e=n.current;e.setState({runtimeErrors:e.getState().runtimeErrors.filter(e=>!e.has_blank_screen)})}};return(0,a.jsx)(m.Provider,{value:p,children:t})};function f(){return(0,s.useContext)(m)}let h=e=>{var t,r,a,s,n,i;return((null==(t=e.error_type)?void 0:t.length)||0)+((null==(r=e.message)?void 0:r.length)||0)+((null==(a=e.filename)?void 0:a.length)||0)+((null==(s=e.lineno)?void 0:s.toString().length)||0)+((null==(n=e.colno)?void 0:n.toString().length)||0)+((null==(i=e.stack)?void 0:i.length)||0)}},28144:(e,t,r)=>{var a;r.d(t,{f:()=>a}),function(e){var t,r;(t=e.type||(e.type={})).AI_UPDATE="ai_update",t.REVERT="revert",t.INITIAL="initial",t.DEVELOPER_UPDATE="developer_update",t.MANUAL_UPDATE="manual_update",(r=e.feedback||(e.feedback={})).POSITIVE="positive",r.NEGATIVE="negative",r.NO_FEEDBACK="no_feedback"}(a||(a={}))},30315:(e,t,r)=>{r.d(t,{At:()=>u,TB:()=>d,y3:()=>g});var a=r(99289),s=r(11405),n=r(76918),i=r(67017),o=r(4440),l=r(35523);let c=(0,s.createContext)(null),d=e=>{let{children:t}=e,r=(0,s.useRef)((0,n.vt)(()=>({activeView:"preview",blocker:null,showBlockerDialog:!1,nextView:"preview"}))),d=(0,i.A)("md"),{setMobileView:u,setIsPreviewDocked:g}=(0,o.lG)(),m=e=>{r.current.setState({activeView:e})},p=e=>{r.current.setState({blocker:e})},f=e=>{r.current.setState({nextView:e})},h=e=>{null!==r.current.getState().blocker?(f(e),v(!0)):(m(e),d&&"preview"!==e&&(u(o.IM.VIEW),g(!0)))},v=e=>{r.current.setState({showBlockerDialog:e})},_={__internal:{store:r.current,setActiveView:m,setShowBlockerDialog:v,setNextView:f},switchToViewRaw:h,exitView:()=>{h("preview")},setBlocker:p,clearBlocker:()=>{p(null)},getActiveViewDescription:()=>{let e=r.current.getState().activeView;return{view:e,description:l.Bj[e]}}};return(0,a.jsx)(c.Provider,{value:_,children:t})};function u(){let e=(0,s.useContext)(c);if(!e)throw Error("useViewContext must be used within a ViewProvider");return e}function g(e){let{__internal:{store:t}}=u();return t(e)}},31167:(e,t,r)=>{r.d(t,{Ar:()=>v,Uw:()=>y,Xl:()=>_});var a=r(99289),s=r(11405),n=r(76918),i=r(9627),o=r(98213),l=r(37079),c=r(35225);let d=async(e,t)=>{let r=await fetch(e),a=await r.blob();return new File([a],t,{type:a.type})},u={message:"",images:[],imagesAddedViaDropdown:!1,suggestionLabel:void 0,wasCleared:!1},g=e=>({id:e.id,url:e.url,name:e.name,uploaded:e.uploaded}),m=e=>({id:e.id,url:e.url,name:e.name,uploading:!1,uploaded:e.uploaded}),p=async e=>{try{return(await fetch(e)).ok}catch(e){return!1}},f={message:"",images:[],imagesAddedViaDropdown:!1,suggestionLabel:void 0},h=(0,s.createContext)(null),v=e=>{let{children:t,localStorageKey:r}=e,v=(0,s.useRef)((0,n.vt)(e=>({...f,setMessage:t=>{e({message:t,suggestionLabel:void 0})},setSuggestionLabel:t=>{e({suggestionLabel:t})},setImages:t=>{Array.isArray(t)?0===t.length?e({images:t,imagesAddedViaDropdown:!1}):e({images:t}):e(e=>{let r=t(e.images);return 0===r.length?{images:r,imagesAddedViaDropdown:!1}:{images:r}})},setImagesAddedViaDropdown:t=>{e({imagesAddedViaDropdown:t})},clearEditorState:()=>{e(f)}}))),{clearEditorState:_,restoreEditorState:y,setStorageData:b}=((e,t)=>{let r=e(e=>e.setMessage),a=e(e=>e.setSuggestionLabel),n=e(e=>e.setImages),f=e(e=>e.setImagesAddedViaDropdown),{uploadImages:h}=(e=>{let{upload:t}=(0,c.l)(),{isAuthenticated:r}=(0,l.Z2)(),a=e(e=>e.setImages),n=(0,s.useCallback)(async e=>{if(!r)return;let s=e.filter(e=>!e.uploaded&&!e.uploading);if(0===s.length)return;a(e=>e.map(e=>s.some(t=>t.id===e.id)?{...e,uploading:!0}:e));let n=s.map(async e=>{if(e.existingFileId)return e.id;let r=await d(e.url,e.name);return await t({fileName:e.id,file:r,continueOnError:!0}),e.id}),i=new Set((await Promise.allSettled(n)).filter(e=>"fulfilled"===e.status).map(e=>e.value)),l=new Set(s.filter(e=>!i.has(e.id)).map(e=>e.id));l.size>0&&o.toast.error("Image upload failed",{description:"Failed to upload ".concat(l.size," file").concat(l.size>1?"s":"",". Removing failed uploads.")}),a(e=>e.filter(e=>!l.has(e.id)).map(e=>s.some(t=>t.id===e.id)?{...e,uploading:!1,uploaded:i.has(e.id)}:e))},[t,a,r]);return(0,s.useEffect)(()=>{if(r){let t=e.getState().images;t.filter(e=>!e.uploaded&&!e.uploading).length>0&&n(t)}},[r,n,e]),{uploadImages:n}})(e),v=(0,s.useRef)(!1),[_,y]=(0,i.A)("editor-store-".concat(t),{defaultValue:u,storageSync:!1});(0,s.useEffect)(()=>{y(e=>{if(!e.wasCleared){let{message:t,images:s,imagesAddedViaDropdown:i,suggestionLabel:o}=e;Promise.all(s.map(async e=>e.url.startsWith("blob:")?await p(e.url)?e:null:e)).then(e=>{let s=e.filter(e=>null!==e).map(m);r(t),a(o),n(s),f(i)})}return e})},[t,n,f,r,a,y]);let b=(0,s.useCallback)(e=>{y(t=>{if(v.current)return v.current=!1,t;let r={message:e.message,images:e.images.map(g),imagesAddedViaDropdown:e.imagesAddedViaDropdown,suggestionLabel:e.suggestionLabel,wasCleared:!1};return h(e.images),r})},[y,h]);return(0,s.useEffect)(()=>e.subscribe(b),[e,b]),{clearEditorState:(0,s.useCallback)(()=>{v.current=!0,y(e=>({...e,wasCleared:!0})),e.getState().clearEditorState()},[y,e]),restoreEditorState:(0,s.useCallback)(()=>{y(e=>{if(e.wasCleared){let{message:t,images:s,imagesAddedViaDropdown:i,suggestionLabel:o}=e,l=s.map(m);return r(t),a(o),n(l),f(i),{...e,wasCleared:!1}}return e})},[y,r,a,n,f]),setStorageData:y}})(v.current,r),S=(0,s.useMemo)(()=>({store:v.current,clearEditorState:_,restoreEditorState:y,setStorageData:b}),[_,y,b]);return(0,a.jsx)(h.Provider,{value:S,children:t})};function _(){let e=(0,s.useContext)(h);if(!e)throw Error("useEditorStore must be used within an EditorStoreProvider");return e}function y(e){let{store:t}=_();return t(e)}},34824:(e,t,r)=>{r.d(t,{O:()=>i});var a=r(32044),s=r(33256),n=r(273);let i={repoAccessibility:e=>{let{projectId:t,canEdit:r}=e;return(0,a.j)({queryKey:n.cm.repoAccessibility(t),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/repo-accessibility")),enabled:r&&!!t,retry:!1})},installations:e=>{let{enabled:t}=e;return(0,a.j)({queryKey:n.cm.installations(),queryFn:()=>(0,s.P)().get("/users/github-installations"),enabled:t,retry:!1})}}},35225:(e,t,r)=>{r.d(t,{l:()=>n});var a=r(11405),s=r(59173);let n=()=>({upload:(0,a.useCallback)(async e=>{let{fileName:t,file:r,options:a,continueOnError:n=!0}=e;return(0,s.QM)(t,r,a,n)},[]),download:(0,a.useCallback)(async e=>(0,s.PE)(e),[])})},35523:(e,t,r)=>{r.d(t,{AG:()=>n,Bj:()=>o,Xk:()=>a,Y1:()=>i,xc:()=>s});let a={preview:"Preview",analytics:"Analytics",backend:"Cloud",mermaid:"Diagram",codeEditor:"Code",codeViewer:"Code",snapshot:"Preview",error:"Error",annotation:"Annotation",debug:"Debug",seo:"Speed",security:"Security Center"},s={preview:"Preview",analytics:"Analytics",backend:"Cloud",mermaid:"Diagram",codeEditor:"Code",codeViewer:"Code",snapshot:"Preview",error:"Error",annotation:"Annotate",debug:"Debug",seo:"Speed",security:"Security"},n={preview:"language",analytics:"bid_landscape",backend:"cloud",mermaid:"flowsheet",codeEditor:"code",codeViewer:"code",snapshot:"language",error:"error",annotation:"edit",debug:"bug_report",seo:"speed",security:"security"},i={analytics:{label:"Analytics",icon:"bid_landscape",description:"View analytics for your project",view:"analytics",enabledOnMobile:!0},codeEditor:{label:"Code",icon:"code",description:"View the dev mode for your project",view:"codeEditor",enabledOnMobile:!1,defaultPinned:!0},backend:{label:"Cloud",icon:"cloud",description:"View the backend for your project",view:"backend",enabledOnMobile:!0,defaultPinned:!0,dependsOnFeatureFlag:!0},security:{label:"Security",icon:"security",description:"View the security for your project",view:"security",enabledOnMobile:!0},seo:{label:"Speed",icon:"speed",description:"View the SEO analysis for your project",view:"seo",enabledOnMobile:!0}},o={analytics:"The user is currently viewing analytics for their project. Analytics provides insights into the app's performance, like how many visitors the app gets, how long they stay, what countries they are from, etc.",backend:"The user is currently viewing the Cloud view for their project. Here they can view database tables, see how many users have signed up and information about individual users, browse logs, determine what authentication methods their app can use, see security warnings and suggestions, configure secrets, and view files stored in buckets, like uploaded user images.",mermaid:"The user is currently viewing a mermaid diagram visualizing some aspect of their project.",preview:"The user is currently viewing the live preview of their project.",codeEditor:"The user is currently viewing the code editor for their project. Here they can browse and search files and make changes to their code.",codeViewer:"The user is currently viewing the code viewer for their project. This shows a static version of the code, and allows switching between a DIFF and RAW view.",error:"The user is currently viewing the error for their project. This shows a static version of the code, and allows switching between a DIFF and RAW view. It shows the actual error in their code at the top.",snapshot:"The user is currently viewing a preview of a past commit for their project. They can use the Restore button to revert to this specific commit.",annotation:"The user is currently viewing the annotation view for their project. This is for developers only.",debug:"The user is currently viewing the debug view for their project. This is for developers only.",seo:"The user is currently viewing the Page Speed analysis view for their project. This uses Google Lighthouse to analyze the actual performance of the user's app and gives separate scores for both mobile and desktop performance.",security:"The user is currently viewing the security view for their project. This aggregates several sources of security information, like Supabase or Lovable Cloud if the user has it enabled, and scans the codebase for security issues like leaked API keys."}},36104:(e,t,r)=>{r.d(t,{c:()=>l,m:()=>c});var a=r(32044),s=r(33256),n=r(69147),i=r(59404),o=r(273);let l={sourceCode:e=>{let{projectId:t,enabled:r}=e;return(0,a.j)({queryKey:o.gO.sourceCode(t),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/source-code")),enabled:r})},feedbackStatus:e=>{let{projectId:t}=e;return(0,a.j)({queryKey:o.gO.feedbackStatus(t),queryFn:async()=>(0,s.P)().get("/user/feedback-status")})},presence:e=>{let{projectId:t,authUser:r,enablePresence:n}=e;return(0,a.j)({queryKey:o.gO.presence(t),queryFn:()=>r?(0,s.P)().post("/projects/".concat(t,"/presence")):Promise.resolve(null),enabled:!!r&&!!t&&n,refetchInterval:6e4,refetchOnWindowFocus:!0,refetchOnMount:!0})},magicCode:e=>{let{projectId:t}=e;return(0,a.j)({queryKey:o.gO.secretLinkId(t),queryFn:async()=>{let e=(0,s.P)(),r=(await e.get("/projects/".concat(t,"/magic-codes"))).magic_codes;return r&&0!==r.length?{id:r[0].id,accessLevel:r[0].access_level}:{id:null,accessLevel:null}}})},sharedWithMe:()=>(0,a.j)({queryKey:o.gO.sharedWithMe(),queryFn:async()=>(0,s.P)().get("/user/projects/shared"),select:e=>e.filter(e=>{var t;return!(null==(t=e.collaboration_status)?void 0:t.is_pending)})}),pendingProjectInvites:()=>(0,a.j)({queryKey:o.gO.sharedWithMe(),queryFn:async()=>(0,s.P)().get("/user/projects/shared"),select:e=>e.filter(e=>{var t;return null==(t=e.collaboration_status)?void 0:t.is_pending})}),collaborators:e=>{let{projectId:t,projectOwnerId:r}=e,i=(0,s.P)();return(0,a.j)({queryKey:o.gO.collaborators(null!=t?t:""),enabled:!!t&&!!r,refetchInterval:6e4,queryFn:async()=>{try{var e;let a=null!=(e=await i.get("/projects/".concat(t,"/collaborators")))?e:[];return c({collaborators:a,projectOwnerId:r})}catch(e){return n.logging.error("Failed to fetch collaborators",{error:e}),[]}}})},communityProjects:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recent",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;return(0,a.j)({queryKey:o.gO.communityProjects(e,t,r,n),queryFn:async()=>(0,s.g)().get("".concat("/projects/community","?limit=").concat(e,"&order_by=").concat(t).concat(r&&"all"!==r?"&category=".concat(r):"").concat(n?"&start_after=".concat(n):"").concat("trending"===t?"&feature_source=trending":""))})},analytics:e=>{let{projectId:t,timePeriod:r}=e;return(0,a.j)({queryKey:o.gO.analytics(t,r),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/analytics"),{params:{startDate:r.startDate,endDate:r.endDate,granularity:r.granularity}})})},analyticsTrend:e=>{let{projectId:t}=e;return(0,a.j)({queryKey:o.gO.analyticsTrend(t),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/analytics/trend")),refetchInterval:6e4})},projectDetails:e=>{let{projectId:t}=e;return(0,a.j)({queryKey:o.gO.projectDetails(t),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/details"))})},integrationsData:e=>{let{projectId:t}=e;return(0,a.j)({queryKey:o.gO.integrations(t),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/integrations"))})},integrationData:e=>{let{projectId:t,integrationName:r}=e;return(0,a.j)({queryKey:o.gO.integration(t,r),queryFn:async()=>(0,s.P)().get("/projects/".concat(t,"/integrations/").concat(r))})}};function c(e){let{collaborators:t,projectOwnerId:r}=e;return[...t].sort((e,t)=>{let a=r&&e.id===r,s=r&&t.id===r;return a&&!s?-1:!a&&s?1:e.access_level===i.h.ADMIN&&t.access_level!==i.h.ADMIN?-1:e.access_level!==i.h.ADMIN&&t.access_level===i.h.ADMIN?1:(e.email||"").localeCompare(t.email||"")})}},39365:(e,t,r)=>{r.d(t,{H:()=>u});var a=r(81797),s=r(37079),n=r(332),i=r(11405);let o="start-request",l="first-token",c="end-request",d="start-request";function u(){let{authUser:e}=(0,s.Z2)(),{snapshot:{getUserMessageCount:t,getLastUserMessage:r}}=(0,n.vd)();return{createChatRequestPerformanceMeasurer:(0,i.useCallback)(s=>{var n,i;let{projectId:u}=s,g=1>=t(),m=null!=(i=null==(n=r())?void 0:n.chatOnly)&&i,p=()=>performance.getEntriesByName(o,"mark").length>0;return{measureRequestStart:()=>{performance.mark(o)},measureTimeToFirstToken:()=>{if(!p())return;performance.mark(l);let t=performance.measure(d,o,l);a.Ay.capture("time_to_first_token",{duration:t.duration,project_id:u,user_id:null==e?void 0:e.uid,chat_only:m,is_creation:g})},measureTimeToLastToken:()=>{if(!p())return;performance.mark(c);let t=performance.measure(d,o,c);a.Ay.capture("time_to_last_token",{duration:t.duration,project_id:u,user_id:null==e?void 0:e.uid,chat_only:m,is_creation:g})}}},[t,r,null==e?void 0:e.uid])}}},39975:(e,t,r)=>{r.d(t,{N:()=>i,_:()=>o});var a=r(99289),s=r(11405);let n=(0,s.createContext)(null),i=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useChatInputContext must be used within a ChatInputProvider");return e},o=e=>{let{children:t,onSendChatMessage:r,hasActiveLock:i,isSubmitting:o}=e,l=(0,s.useRef)(null),[c,d]=(0,s.useState)(!1),u=(0,s.useMemo)(()=>({sendChatMessage:r,chatInputFormRef:l,hasActiveLock:i,isSubmitting:o,isVoiceListening:c,setIsVoiceListening:d}),[r,l,i,o,c,d]);return(0,a.jsx)(n.Provider,{value:u,children:t})}},40408:(e,t,r)=>{r.d(t,{A:()=>u,U:()=>g});var a=r(99289),s=r(34363),n=r(11405),i=r(76918),o=r(23594),l=r(34824),c=r(79312);let d=(0,n.createContext)(null),u=e=>{let{children:t,projectId:r}=e,u=(0,n.useRef)((0,i.vt)(()=>({repoAccessibilityResponse:void 0}))),g=(0,n.useMemo)(()=>({store:u.current}),[]),{permitted:m}=(0,o.J)(c.eZ.EditProject),{data:p}=(0,s.I)(l.O.repoAccessibility({projectId:r,canEdit:m}));return(0,n.useEffect)(()=>{u.current&&u.current.setState(e=>({...e,repoAccessibilityResponse:p}))},[p]),(0,a.jsx)(d.Provider,{value:g,children:t})};function g(){let{store:e}=function(){let e=(0,n.useContext)(d);if(!e)throw Error("useRepoAccessibility must be used within a RepoAccessibilityProvider");return e}();return e(e=>e.repoAccessibilityResponse)}},46981:(e,t,r)=>{r.d(t,{H2:()=>n,UE:()=>l,kp:()=>c,np:()=>o});var a=r(1596),s=r(22803);let n=e=>{if(!e)return!0;let t=e instanceof s.Dc?e.toDate():new Date(e);return(new Date().getTime()-t.getTime())/36e5>=24},i="lovable_rate_limit_timestamp",o=()=>{let e=Date.now();localStorage.setItem(i,e.toString())},l=()=>{let e=(()=>{let e=localStorage.getItem(i);return e?parseInt(e,10):null})();if(!e)return{isRateLimited:!1,secondsRemaining:0};let t=Math.max(0,60-Math.floor((Date.now()-e)/1e3));return 0===t?(localStorage.removeItem(i),{isRateLimited:!1,secondsRemaining:0}):{isRateLimited:!0,secondsRemaining:t}},c=e=>{let t=new Date;return e.getFullYear()===t.getFullYear()?(0,a.GP)(e,"h:mm a 'on' MMM dd"):(0,a.GP)(e,"h:mm a 'on' MMM dd yyyy")}},48714:(e,t,r)=>{r.d(t,{T:()=>i});var a=r(99289),s=r(11405),n=r(26551);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex w-full rounded-md bg-muted px-2 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s})});i.displayName="Textarea"},53822:(e,t,r)=>{r.d(t,{s:()=>a});let a=(0,r(76918).vt)(e=>({currentPage:"index",setCurrentPage:t=>e({currentPage:t})}))},54225:(e,t,r)=>{r.d(t,{U1:()=>u,py:()=>l,sK:()=>c,wV:()=>d});var a=r(99289),s=r(11405),n=r(76918),i=r(15402);let o=(0,s.createContext)(null),l=e=>{let{children:t}=e,r=(0,s.useRef)((0,n.vt)()((0,i.D)(e=>({isSendChatMessageMutationPending:!1,isBuildErrorOccurredDuringStream:!1,isSomeRevertMutationPending:!1,editIdToConfirmRestoreFor:void 0})))),l=(0,s.useCallback)(e=>{r.current.setState({isSendChatMessageMutationPending:e,isBuildErrorOccurredDuringStream:!1})},[]),c={store:r.current,setIsSendChatMessageMutationPending:l,setIsBuildErrorOccurredDuringStream:e=>{r.current.setState({isBuildErrorOccurredDuringStream:e})},setIsSomeRevertMutationPending:e=>{r.current.setState({isSomeRevertMutationPending:e})},setEditIdToConfirmRestoreFor:e=>{r.current.setState({editIdToConfirmRestoreFor:e})}};return(0,a.jsx)(o.Provider,{value:c,children:t})};function c(){let e=(0,s.useContext)(o);if(!e)throw Error("useMessageSubmissionContext must be used within a MessageSubmissionProvider");return e}function d(e){let{store:t}=c();return t(e)}let u=()=>{let{isSendChatMessageMutationPending:e,isSomeRevertMutationPending:t}=d(e=>e);return e||t}},59173:(e,t,r)=>{r.d(t,{PE:()=>i,QM:()=>n,QN:()=>o});var a=r(33256),s=r(69147);let n=async function(e,t,n){var i,o;let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],c=null!=(i=null==n?void 0:n.maxFileSize)?i:3145728,d=null!=(o=null==n?void 0:n.maxDimension)?o:2e3,u=t;if(t.type.startsWith("image/"))if(["image/svg+xml","image/gif","image/x-icon","image/vnd.microsoft.icon"].includes(t.type))u=t;else{let e=new Image,a=URL.createObjectURL(t);try{if(await new Promise(t=>{e.onload=()=>{URL.revokeObjectURL(a),t()},e.onerror=()=>{URL.revokeObjectURL(a),t()},e.src=a}),t.size>c||Math.max(e.width,e.height)>d)try{let{default:e}=await r.e(385).then(r.bind(r,10385));u=await e(t,{maxSizeMB:c/1024/1024,maxWidthOrHeight:Math.min(d,1920),useWebWorker:!0})}catch(e){if(s.logging.error("Error compressing image:",{error:e}),!l)throw e}}catch(e){s.logging.warn("Could not process image for compression, using original",{error:e}),u=t}}let g={file_name:e,content_type:u.type,status:"uploading"},m=await (0,a.P)().post("/files/generate-upload-url",g),p=await fetch(m.url,{method:"PUT",body:u,headers:{"Content-Type":u.type}});if(!p.ok){let t=Error("Upload failed with status ".concat(p.status));if(s.logging.error("File upload failed:",{fileName:e,status:p.status}),!l)throw t}},i=async e=>(0,a.P)().post("/files/generate-download-url",e),o=async e=>(0,a.P)().post("/files/generate-public-url",e)},60527:(e,t,r)=>{r.d(t,{AM:()=>o,Wv:()=>l,dT:()=>c,hl:()=>u,iN:()=>d});var a=r(99289),s=r(15269),n=r(11405),i=r(26551);let o=s.bL,l=s.l9,c=s.Mz,d=s.bm,u=n.forwardRef((e,t)=>{let{className:r,align:n="center",sideOffset:o=4,...l}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsx)(s.UC,{ref:t,align:n,sideOffset:o,className:(0,i.cn)("z-[10000] w-72 rounded-xl border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...l})})});u.displayName=s.UC.displayName},61255:(e,t,r)=>{r.d(t,{O:()=>c,h:()=>d});var a=r(22803),s=r(11405),n=r(37079),i=r(332),o=r(80617),l=r(90820);let c='\n<lov-tool-use id="thinking-opt" name="lov-think" data="">\n';function d(){let{authUser:e}=(0,n.Z2)(),t=null==e?void 0:e.uid,{updateMessage:r}=(0,i.vd)();return{createOptimisticMessage:(0,s.useCallback)(e=>{var s,n;let{body:i}=e,d={id:i.id,createdAt:new Date,role:"user",type:"userMessage",selectedElements:null!=(s=i.selected_elements)?s:[],content:i.message,tags:null!=(n=i.tags)?n:[],images:[],containsError:!!i.contains_error,userId:t,optimisticImageUrls:i.optimisticImageUrls};if(r(i.id,d,!0),i.ai_message_id){let e={id:i.ai_message_id,created_at:a.Dc.fromDate(new Date),content:c,thinking_time_ms:0,exclude_from_history:!1,message_type:"aiMessage",status:"running",stopped:!1,graph_id:"optimistic-graph-id",role:o.g.role.AI,tag:o.g.tag.INSTANT_MODE_MESSAGE},t=(0,l.wA)(e);t&&"aiMessage"===t.type&&r(t.id,t,!0)}},[r,t])}}},64285:(e,t,r)=>{r.d(t,{Z:()=>c});let a={preview:/^preview(?:-([a-zA-Z0-9]+))?--(.+)$/,idPreview:/^id-preview(?:-([a-zA-Z0-9]+))?--(.+)$/,deployment:/^([a-z0-9](?:[a-z0-9-]*[a-z0-9])?)$/};var s=function(e){return e.PREVIEW="preview",e.ID_PREVIEW="id-preview",e.DEPLOYMENT="deployment",e}({}),n=r(13022);let i=["lovableproject.com","lovableproject-dev.com","sandbox.lovable.dev"],o=["lovable.app","gpt-eng.com","gptengineer.run","preview.lovable.dev"],l={[s.PREVIEW]:{prefix:"preview",useProjectId:!1},[s.ID_PREVIEW]:{prefix:"id-preview",useProjectId:!0}},c=e=>{if(null==e?void 0:e.split(".").find(e=>e.startsWith("xn--")))return{mode:"customDomain",customDomain:e};let[t,r]=e.split(/\.(.*)/),c=i.includes(r),d=o.includes(r);if(!(c||d)){let t=(0,n.qg)(e);if(!t.domain)throw Error("parseLovableDomain: Invalid domain: "+e);return{mode:"customDomain",customDomain:t.subdomain?t.subdomain+"."+t.domain:t.domain}}if(c)return{mode:"livePreview",projectID:t,tldp1:r};let u=(e=>a.preview.test(e)?"preview":a.idPreview.test(e)?"id-preview":a.deployment.test(e)?"deployment":null)(t);if(!u)throw Error("Not valid preview domain");if(u==s.DEPLOYMENT)return{mode:"deployment",projectName:t};let g=t.split("--");if(2!==g.length)throw Error("Invalid domain syntax: "+t);let[m,p]=g;if(!p)throw Error("Invalid domain syntax - missing project identifier "+t);let f=m.replace(l[u].prefix,""),h={mode:"staticPreview",sha:f.startsWith("-")?f.substring(1):void 0,tldp1:r};if(u==s.ID_PREVIEW)return{...h,projectID:p};if(u==s.PREVIEW)return{...h,projectName:p};throw Error("Unknown preview type")}},77233:(e,t,r)=>{r.d(t,{$Q:()=>i,Us:()=>l,Y$:()=>c});var a=r(99289),s=r(11405);let n="editor-mode-store",i=["auto","gpt-4.1","gpt-4.1-mini","gpt-5-l","gpt-5-m","gpt-5","gpt-5-h","o4-mini","gemini-2.5-pro","gemini-2.5-flash","claude-3.5-sonnet","claude-3.7-sonnet","claude-4-sonnet","claude-4-opus","kimi-k2","grok-4"],o=(0,s.createContext)(null),l=e=>{let{children:t}=e,[r,i]=(0,s.useState)(()=>null);return(0,s.useEffect)(()=>{null===r?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(r))},[r]),(0,a.jsx)(o.Provider,{value:{selectedModel:r,setSelectedModel:i},children:t})},c=()=>{let e=(0,s.useContext)(o);if(!e)throw Error("useGetSelectedChatModel must be used within a ModelSelectorProvider");return e}},80587:(e,t,r)=>{r.d(t,{N:()=>i});var a=r(69147),s=r(43169);let n=(0,s.createServerReference)("402bf2a0d24fb5d865ddec63f5b65bc6b119dee5d8",s.callServer,void 0,s.findSourceMapURL,"handleInterceptedError");async function i(e,t,r){try{let s=await n(e);if(!s)return void a.logging.debug("skipping_reporting_error",{error:e,err_message:e.message});let i=s.error_type;await r.post("/projects/".concat(t,"/report_error"),{message:null==s?void 0:s.message,error_type:i,meta_data:s})}catch(e){a.logging.error("failed_to_report_intercepted_error",{error:e})}}},80617:(e,t,r)=>{var a;r.d(t,{g:()=>a}),function(e){var t;(t=e.role||(e.role={})).AI="ai",t.USER="user",(e.tag||(e.tag={})).INSTANT_MODE_MESSAGE="instant-mode-message"}(a||(a={}))},82176:(e,t,r)=>{r.d(t,{TR:()=>h,bq:()=>g,eb:()=>v,gC:()=>f,l6:()=>c,s3:()=>d,yv:()=>u});var a=r(99289),s=r(90502),n=r(76128),i=r(11405),o=r(97757),l=r(26551);let c=n.bL,d=n.YJ,u=n.WT,g=i.forwardRef((e,t)=>{let{className:r,children:s,...i}=e;return(0,a.jsxs)(n.l9,{ref:t,className:(0,l.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...i,children:[s,(0,a.jsx)(n.In,{asChild:!0,children:(0,a.jsx)(o.A,{name:"keyboard_arrow_down",size:"small",className:"opacity-50"})})]})});g.displayName=n.l9.displayName;let m=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,a.jsx)(n.PP,{ref:t,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",r),...i,children:(0,a.jsx)(s.Mtm,{className:"h-4 w-4"})})});m.displayName=n.PP.displayName;let p=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,a.jsx)(n.wn,{ref:t,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",r),...i,children:(0,a.jsx)(s.D3D,{className:"h-4 w-4"})})});p.displayName=n.wn.displayName;let f=i.forwardRef((e,t)=>{let{className:r,children:s,position:i="popper",...o}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsxs)(n.UC,{ref:t,className:(0,l.cn)("relative z-[10000] max-h-96 min-w-32 overflow-hidden rounded-md border bg-card text-card-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1","origin-[var(--radix-select-content-transform-origin)]",r),position:i,...o,children:[(0,a.jsx)(m,{}),(0,a.jsx)(n.LM,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,a.jsx)(p,{})]})})});f.displayName=n.UC.displayName;let h=i.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.JU,{ref:t,className:(0,l.cn)("px-2 py-1.5 text-sm font-medium",r),...s})});h.displayName=n.JU.displayName;let v=i.forwardRef((e,t)=>{let{className:r,children:i,...o}=e;return(0,a.jsxs)(n.q7,{ref:t,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...o,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(s.Srz,{className:"h-4 w-4"})})}),(0,a.jsx)(n.p4,{children:i})]})});v.displayName=n.q7.displayName,i.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.wv,{ref:t,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",r),...s})}).displayName=n.wv.displayName},82594:(e,t,r)=>{r.d(t,{B:()=>n,M:()=>s});var a=r(22291);let s=()=>{let e=(0,a.useParams)().project_id;return e&&"string"==typeof e?e:null},n=()=>{let e=s();if(!e)throw Error("Project ID is required and should always be set here");return e}},87887:(e,t,r)=>{r.d(t,{f:()=>u,n:()=>g});var a=r(99289),s=r(81797),n=r(11405),i=r(76918),o=r(49944),l=r(6072),c=r(97757),d=r(34958);let u=(0,i.vt)(e=>({open:!1,errorMessage:null,showTryAgain:!0,traceId:null,showErrorDialog:function(t){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=arguments.length>2?arguments[2]:void 0;return s.Ay.capture("error_dialog_shown",{error_message:t,show_try_again:r,trace_id:a}),e({open:!0,errorMessage:t,showTryAgain:r,traceId:a})},closeError:()=>e({open:!1,errorMessage:null,showTryAgain:!0,traceId:null})}));function g(){let{open:e,errorMessage:t,closeError:r,showTryAgain:i,traceId:g}=u(),[m,p]=(0,n.useState)(!1),f=(0,d.WW)(),h=async()=>{if(g)try{await navigator.clipboard.writeText(g),p(!0),setTimeout(()=>p(!1),2e3)}catch(e){}};return(0,a.jsx)(l.lG,{open:e,onOpenChange:e=>{e||(s.Ay.capture("error_dialog_closed",{action:"backdrop",error_message:t,trace_id:g}),r())},children:(0,a.jsxs)(l.Cf,{children:[(0,a.jsxs)(l.c7,{className:"text-left",children:[(0,a.jsx)(l.L3,{className:"text-left",children:"Error"}),(0,a.jsxs)(l.rr,{className:"flex flex-col items-start",children:[(t||"An unexpected error occurred. ").split("\n").map((e,r)=>(0,a.jsxs)("span",{children:[e,r!==(t||"An unexpected error occurred. ").split("\n").length-1&&(0,a.jsx)("br",{})]},r)),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),(0,a.jsx)("span",{children:"Please try again later."})]}),g&&(0,a.jsx)("div",{className:"mt-2 w-full text-[10px] text-muted-foreground/70",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[(0,a.jsx)("p",{children:"ID:"}),(0,a.jsx)("code",{className:"relative break-all rounded bg-muted/50 px-[0.2rem] font-mono",children:g}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(o.$,{variant:"link",size:"icon-xs",className:"p-0 text-muted-foreground/70 hover:text-muted-foreground focus:ring-0 focus-visible:ring-0 focus-visible:ring-offset-0",onClick:h,"aria-label":"Copy Trace ID",tabIndex:-1,children:(0,a.jsx)(c.A,{name:m?"check":"content_copy",size:"small"})}),f&&(0,a.jsx)(o.$,{variant:"link",size:"icon-xs",className:"p-0 text-muted-foreground/70 hover:text-muted-foreground focus:ring-0 focus-visible:ring-0 focus-visible:ring-offset-0",onClick:()=>window.open(g?"https://lovable.grafana.net/a/grafana-exploretraces-app/explore?from=now-24h&to=now&timezone=browser&var-ds=grafanacloud-traces&var-primarySignal=nestedSetParent%3C0&var-filters=&var-metric=rate&var-groupBy=resource.service.name&var-spanListColumns=&var-latencyThreshold=&var-partialLatencyThreshold=&actionView=breakdown&traceId=".concat(g):"","_blank"),"aria-label":"View in Grafana",tabIndex:-1,children:(0,a.jsx)(c.A,{name:"monitoring",size:"small"})})]})]})})]})]}),(0,a.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,a.jsxs)(l.Es,{className:"flex flex-row justify-end gap-2",children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>{s.Ay.capture("error_dialog_closed",{action:"get_help",error_message:t,trace_id:g}),r(),window.open("https://docs.lovable.dev/#stay-connected","_blank")},children:"Get help"}),(0,a.jsx)(o.$,{onClick:()=>{s.Ay.capture("error_dialog_closed",{action:"ok",error_message:t,trace_id:g}),r()},autoFocus:!0,children:"Dismiss"})]})})]})})}},90277:(e,t,r)=>{r.d(t,{a:()=>s,y:()=>a});let a={mobile:{name:"mobile",tooltip:"Show desktop preview",icon:"devices"},tablet:{name:"tablet",tooltip:"Show mobile preview",icon:"devices"},desktop:{name:"desktop",tooltip:"Show tablet preview",icon:"devices"}},s={STATIC:"static",LIVE:"live"}},90820:(e,t,r)=>{r.d(t,{g_:()=>p,wA:()=>g,m6:()=>m});var a,s,n,i=r(22803),o=r(45494),l=r(69147);!function(e){(e.tag||(e.tag={})).BRANCH_SWITCHED="branch-switched"}(a||(a={})),function(e){(e.tag||(e.tag={})).EXTERNAL_COMMIT_PUSHED="external-commit-pushed"}(s||(s={}));var c=r(80617);!function(e){(e.tag||(e.tag={})).REVERT_SUCCESS="revert-success"}(n||(n={}));let d=[],u=e=>"string"==typeof e?new Date(e):e instanceof i.Dc?e.toDate():new i.Dc(e.seconds,e.nanoseconds).toDate(),g=(e,t)=>{var r,i,o,g,m,p,f,h,v,_,y,b,S,w,E,M,k,I,x,C,j,T,P,A,R;switch(e.tag){case c.g.tag.INSTANT_MODE_MESSAGE:if("user"===e.role)return{createdAt:u(e.created_at),role:"user",id:e.id,content:e.content,type:"userMessage",selectedElements:null!=(r=e.selected_elements)?r:d,images:null!=(i=e.images)?i:d,containsError:null!=(o=e.contains_error)&&o,tags:null!=(g=e.tags)?g:d,userId:null!=(m=e.user_id)?m:void 0,chatOnly:null!=(p=e.chat_only)&&p,isStuck:null!=(f=e.is_stuck)&&f,intent:null!=(h=e.intent)?h:void 0};return{createdAt:u(e.created_at),role:"ai",id:e.id,content:e.content,type:"aiMessage",editId:null!=(_=e.edit_id)?_:void 0,stopped:!!e.stopped,errors:null!=(y=null==(v=e.errors)?void 0:v.sort((e,t)=>t.created_at.seconds-e.created_at.seconds))?y:void 0,sqlRunState:null!=(b=e.sql_run_state)?b:void 0,persisted:null!=(S=null==t?void 0:t.persisted)&&S,status:null!=(w=e.status)?w:"completed",thinkingTimeMs:null!=(E=e.thinking_time_ms)?E:void 0,timeToFirstTokenMs:null!=(M=e.time_to_first_token_ms)?M:void 0,feedbackSentiment:null!=(k=e.feedback_sentiment)?k:void 0,feedbackContent:null!=(I=e.feedback_content)?I:void 0,feedbackCategory:null!=(x=e.feedback_category)?x:void 0,costCredits:null!=(C=e.cost_credits)?C:void 0,pipelineErrors:(e.pipeline_errors||[]).map(e=>({traceId:e.trace_id,code:e.code,message:e.message,details:e.details}))};case a.tag.BRANCH_SWITCHED:return{createdAt:u(e.created_at),id:e.id,type:"branchSwitched",branchName:e.branch_name};case s.tag.EXTERNAL_COMMIT_PUSHED:return{createdAt:u(e.created_at),id:e.id,type:"userCommit",shortCommitHash:null!=(j=e.commit_hash)?j:void 0,commitMessage:e.commit_message};case n.tag.REVERT_SUCCESS:case"revert-success-v2":return{createdAt:u(e.created_at),id:e.id,type:"revertSuccess",shortCommitHash:null!=(T=e.commit_hash)?T:void 0,editId:null!=(P=e.edit_id)?P:""};case"manual-edit":return{createdAt:u(e.created_at),id:e.id,type:"manualEdit",content:e.content,editId:e.edit_id,errors:null!=(R=null==(A=e.errors)?void 0:A.sort((e,t)=>t.created_at.seconds-e.created_at.seconds))?R:void 0};case"revert":if("user"===e.role)return{createdAt:u(e.created_at),id:e.id,type:"userMessage",content:e.content,containsError:!1,tags:[],images:[],selectedElements:[],userId:e.user_id,role:"user"};return{createdAt:u(e.created_at),id:e.id,type:"aiMessage",content:e.content,role:"ai",persisted:!0,status:"completed",sqlRunState:void 0,stopped:!1};default:return l.logging.error("Unknown message tag",{message:e}),null}},m=(e,t)=>{let r={};return e.forEach(e=>{let a=e.data(),s=g(a,t);s&&(r[a.id]=s)}),r},p=()=>(0,o.Oy)("umsg").toString()},92936:(e,t,r)=>{r.d(t,{J:()=>n,p:()=>l});var a=r(99490),s=r(14026);let n=a.Ik({frame:a.Yj().optional(),id:a.Yj().optional(),loc:a.Ik({file:a.Yj().optional(),line:a.ai().optional(),column:a.ai().optional()}).optional(),message:a.Yj(),plugin:a.Yj().optional(),pluginCode:a.Yj().optional(),stack:a.Yj().optional()}).transform(e=>({...e,error_type:s.B.IMMEDIATE_RUNTIME})),i=a.Ik({body:a.Yj(),message:a.Yj(),status:a.ai(),statusText:a.Yj().optional(),url:a.Yj()}),o=a.Ik({message:a.Yj(),method:a.k5(["OPTIONS","GET","POST","PUT","DELETE","PATCH"]),origin:a.Yj().optional(),stack:a.Yj().optional(),url:a.Yj()}),l=a.KC([i,o])}}]);