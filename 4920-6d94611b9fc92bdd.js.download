try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="0e8e0917-e3a1-412e-8244-b4a6919e6437",e._sentryDebugIdIdentifier="sentry-dbid-0e8e0917-e3a1-412e-8244-b4a6919e6437")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4920],{245:(e,s,t)=>{t.d(s,{i:()=>a});let a=[{id:"notion",title:"Notion",description:"Create, edit, and manage Notion pages and databases.",icon:"/img/mcp-plugins/notion.png",category:"Productivity",serverUrl:"https://mcp.notion.com/mcp"},{id:"linear",title:"Linear",description:"Create issues, manage sprints, and track development.",icon:"/img/mcp-plugins/linear.png",category:"Development",serverUrl:"https://mcp.linear.app/mcp"},{id:"atlassian",title:"Atlassian",description:"Integrate with Jira, Confluence, and other tools.",icon:"/img/mcp-plugins/atlassian.png",category:"Development",serverUrl:"https://mcp.atlassian.com/v1/sse"},{id:"google-drive",title:"Google Drive",description:"Access, upload, and manage files in Google Drive.",icon:"/img/mcp-plugins/gdrive.png",category:"Storage"},{id:"monday",title:"Monday.com",description:"Manage projects, tasks, and team workflows.",icon:"/img/mcp-plugins/monday.png",category:"Project Management"},{id:"asana",title:"Asana",description:"Track tasks, projects, and team collaboration.",icon:"/img/mcp-plugins/asana.png",category:"Project Management"},{id:"canva",title:"Canva",description:"Design graphics, presentations, and visual content.",icon:"/img/mcp-plugins/canva.png",category:"Design"},{id:"zapier",title:"Zapier",description:"Automate workflows between different apps and services.",icon:"/img/mcp-plugins/zapier.png",category:"Automation"}]},2237:(e,s,t)=>{t.d(s,{N8:()=>h,cn:()=>m,dB:()=>o});var a=t(35663),r=t(7242),n=t(46905),i=t(38387),l=t(55940);let o=e=>{if(e)try{return Intl.DateTimeFormat(void 0,{timeZone:e}),e}catch(e){}return Intl.DateTimeFormat().resolvedOptions().timeZone},c=(e,s)=>(0,l.uk)(e,s).toISOString(),d=(e,s)=>{let t=(0,l.L_)(e,s),r=(0,a.o)(t);return(0,l.uk)(r,s)},u=(e,s)=>{let t=(0,l.L_)(e,s),a=(0,r.D)(t);return(0,l.uk)(a,s)},m=e=>{let s=o(e),t=new Date;return{startDate:c(new Date(t.getTime()-6048e5),s),endDate:c(t,s),granularity:"daily",preset:"7d"}},h={today:{label:"Today",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c(d(t,s),s),endDate:c(u(t,s),s),granularity:"hourly",preset:"today"}}},yesterday:{label:"Yesterday",getTimePeriod:e=>{let s=o(e),t=(0,n.e)(new Date,1);return{startDate:c(d(t,s),s),endDate:c(u(t,s),s),granularity:"hourly",preset:"yesterday"}}},"24h":{label:"Last 24 hours",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c((0,n.e)(t,1),s),endDate:c(t,s),granularity:"hourly",preset:"24h"}}},"7d":{label:"Last 7 days",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c((0,n.e)(t,7),s),endDate:c(t,s),granularity:"daily",preset:"7d"}}},"14d":{label:"Last 14 days",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c((0,n.e)(t,14),s),endDate:c(t,s),granularity:"daily",preset:"14d"}}},"30d":{label:"Last 30 days",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c((0,n.e)(t,30),s),endDate:c(t,s),granularity:"daily",preset:"30d"}}},"90d":{label:"Last 90 days",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c((0,n.e)(t,90),s),endDate:c(t,s),granularity:"daily",preset:"90d"}}},month:{label:"This month",getTimePeriod:e=>{let s=o(e),t=new Date;return{startDate:c((0,i.w)(t),s),endDate:c(t,s),granularity:"daily",preset:"month"}}}}},2469:(e,s,t)=>{t.d(s,{t:()=>n});var a=t(81797),r=t(45320);let n=()=>{let{triggerScan:e}=(0,r.J_)(),s=(0,r.dr)(e=>e.securitySummary),t=(0,r.dr)(e=>e.scanData),n=(0,r.dr)(e=>e.isLoading),i=(0,r.dr)(e=>{var s;return!!(null==(s=e.scanData)?void 0:s.is_scanning)||e.isUpdating}),l=(0,r.dr)(e=>e.error),o=(0,r.dr)(e=>e.projectId);return{securitySummary:s,scanData:t,isLoading:n,isUpdating:i,error:l,triggerScan:e,captureSecurityEvent:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={project_id:o,...s};a.Ay.capture(e,t)}}}},2903:(e,s,t)=>{t.d(s,{$:()=>h});var a=t(99289),r=t(76704),n=t(81797),i=t(11022),l=t(43328),o=t(70999),c=t(97757),d=t(24159),u=t(5531),m=t(97115);let h=()=>{let e=(0,r.c3)("EarnFreeCredits"),s=(0,o.f)(i.E),t=(0,l.j4)(e=>{var s;return null==(s=e.currentWorkspace)?void 0:s.plan}),{isEnterprisePlan:h}=(0,m.cb)(t);return h?null:(0,a.jsxs)(u._2,{onClick:()=>{n.Ay.capture(d.h6.OPENED_DIALOG,{button_used:"menu_item"}),s({childProps:{onSuccess:()=>s(!1)}})},children:[(0,a.jsx)(c.A,{name:"featured_seasonal_and_gifts",size:"small"}),(0,a.jsx)("span",{children:e("getFreeCredits")})]})}},4412:(e,s,t)=>{t.d(s,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>l});var a=t(99289),r=t(51233),n=t(11405),i=t(26551);let l=r.bL,o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.B8,{ref:s,className:(0,i.cn)("inline-flex h-9 items-center justify-center rounded-lg p-1 text-muted-foreground",t),...n})});o.displayName=r.B8.displayName;let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.l9,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...n})});c.displayName=r.l9.displayName;let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.UC,{ref:s,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n})});d.displayName=r.UC.displayName},5943:(e,s,t)=>{t.d(s,{G7:()=>o,L$:()=>u,h_:()=>m,oI:()=>c,uB:()=>l,xL:()=>d});var a=t(99289),r=t(37876);t(11405),t(6072);var n=t(26551),i=t(97757);function l(e){let{className:s,...t}=e;return(0,a.jsx)(r.uB,{"data-slot":"command",className:(0,n.cn)("flex h-full w-full flex-col overflow-hidden rounded-xl bg-popover text-popover-foreground",s),...t})}function o(e){let{className:s,...t}=e;return(0,a.jsxs)("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[(0,a.jsx)(i.A,{name:"search",className:"size-4 shrink-0 opacity-50"}),(0,a.jsx)(r.uB.Input,{"data-slot":"command-input",className:(0,n.cn)("flex h-10 w-full rounded-xl bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",s),...t})]})}function c(e){let{className:s,...t}=e;return(0,a.jsx)(r.uB.List,{"data-slot":"command-list",className:(0,n.cn)("max-h-[300px] scroll-py-1 overflow-y-auto overflow-x-hidden",s),...t})}function d(e){let{...s}=e;return(0,a.jsx)(r.uB.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...s})}function u(e){let{className:s,...t}=e;return(0,a.jsx)(r.uB.Group,{"data-slot":"command-group",className:(0,n.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...t})}function m(e){let{className:s,...t}=e;return(0,a.jsx)(r.uB.Item,{"data-slot":"command-item",className:(0,n.cn)("relative flex cursor-default select-none items-center gap-2 rounded-lg px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg:not([class*='text-'])]:text-muted-foreground [&_svg]:pointer-events-none [&_svg]:shrink-0",s),...t})}},9396:(e,s,t)=>{t.d(s,{II:()=>h,Nt:()=>x,at:()=>u});var a=t(99289),r=t(11405),n=t(44358),i=t(64770),l=t(38922),o=t(26551);let c={light:"",dark:".dark"},d=r.createContext(null);function u(e){let{id:s,className:t,children:i,config:l,...c}=e,u=r.useId(),h="chart-".concat(s||u.replace(/:/g,""));return(0,a.jsx)(d.Provider,{value:{config:l},children:(0,a.jsxs)("div",{"data-slot":"chart","data-chart":h,className:(0,o.cn)("[&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-surface]:outline-hidden flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent",t),...c,children:[(0,a.jsx)(m,{id:h,config:l}),(0,a.jsx)(n.u,{children:i})]})})}let m=e=>{let{id:s,config:t}=e,r=Object.entries(t).filter(e=>{let[,s]=e;return s.theme||s.color});return r.length?(0,a.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(c).map(e=>{let[t,a]=e;return"\n".concat(a," [data-chart=").concat(s,"] {\n").concat(r.map(e=>{var s;let[a,r]=e,n=(null==(s=r.theme)?void 0:s[t])||r.color;return n?"  --color-".concat(a,": ").concat(n,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},h=i.m;function x(e){let{active:s,payload:t,className:n,indicator:i="dot",hideLabel:l=!1,hideIndicator:c=!1,label:u,labelFormatter:m,labelClassName:h,formatter:x,color:g,nameKey:j,labelKey:f}=e,{config:v}=function(){let e=r.useContext(d);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}(),y=r.useMemo(()=>{var e;if(l||!(null==t?void 0:t.length))return null;let[s]=t,r="".concat(f||(null==s?void 0:s.dataKey)||(null==s?void 0:s.name)||"value"),n=p(v,s,r),i=f||"string"!=typeof u?null==n?void 0:n.label:(null==(e=v[u])?void 0:e.label)||u;return m?(0,a.jsx)("div",{className:(0,o.cn)("font-medium",h),children:m(i,t)}):i?(0,a.jsx)("div",{className:(0,o.cn)("font-medium",h),children:i}):null},[u,m,t,l,h,v,f]);if(!s||!(null==t?void 0:t.length))return null;let b=1===t.length&&"dot"!==i;return(0,a.jsxs)("div",{className:(0,o.cn)("grid min-w-32 items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[b?null:y,(0,a.jsx)("div",{className:"grid gap-1.5",children:t.map((e,s)=>{let t="".concat(j||e.name||e.dataKey||"value"),r=p(v,e,t),n=g||e.payload.fill||e.color;return(0,a.jsx)("div",{className:(0,o.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===i&&"items-center"),children:x&&(null==e?void 0:e.value)!==void 0&&e.name?x(e.value,e.name,e,s,e.payload):(0,a.jsxs)(a.Fragment,{children:[(null==r?void 0:r.icon)?(0,a.jsx)(r.icon,{}):!c&&(0,a.jsx)("div",{className:(0,o.cn)("border-(--color-border) bg-(--color-bg) shrink-0 rounded-[2px]",{"h-2.5 w-2.5":"dot"===i,"w-1":"line"===i,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===i,"my-0.5":b&&"dashed"===i}),style:{"--color-bg":n,"--color-border":n}}),(0,a.jsxs)("div",{className:(0,o.cn)("flex flex-1 justify-between leading-none",b?"items-end":"items-center"),children:[(0,a.jsxs)("div",{className:"grid gap-1.5",children:[b?y:null,(0,a.jsx)("span",{className:"text-muted-foreground",children:(null==r?void 0:r.label)||e.name})]}),e.value&&(0,a.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})}function p(e,s,t){if("object"!=typeof s||null===s)return;let a="payload"in s&&"object"==typeof s.payload&&null!==s.payload?s.payload:void 0,r=t;return s&&t in s&&"string"==typeof s[t]?r=s[t]:a&&t in a&&"string"==typeof a[t]&&(r=a[t]),r in e?e[r]:e[t]}l.s},9915:(e,s,t)=>{t.d(s,{R:()=>i});var a=t(11405),r=t(9563);let n=e=>{try{if(null==e)return!1;let s=e.toDate();if(new Date().getTime()-s.getTime()>6e4)return!1;return!0}catch(e){return!1}},i=()=>{let e=(0,r.Iw)(e=>e.project),s=null==e?void 0:e.locked_at,[t,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(!s||!n(s))return void i(!1);let e=setInterval(()=>{let t=n(s);i(t),t||clearInterval(e)},250);return()=>clearInterval(e)},[s]),t}},11583:(e,s,t)=>{function a(e){let s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=Math.floor(e%60),r="";return s>0&&(r+="".concat(s,"h ")),(t>0||s>0)&&(r+="".concat(t,"m ")),(r+="".concat(a,"s")).trim()}t.d(s,{Fl:()=>n,aM:()=>r,fU:()=>a});let r=e=>e<1e3?e.toString():e<1e6?"".concat((e/1e3).toFixed(1).replace(/\.0$/,""),"k"):"".concat((e/1e6).toFixed(1).replace(/\.0$/,""),"m"),n=e=>{let{value:s,valueType:t,roundNumber:n=!0}=e;switch(t){case"number":return n?r(s):s.toString();case"percentage":return"".concat(s,"%");case"time":return a(s)}}},12987:(e,s,t)=>{t.d(s,{N:()=>o});var a=t(51252),r=t(6919),n=t(98213),i=t(33256),l=t(69147);let o=e=>{let{projectId:s,onUnpublishComplete:t}=e,o=(0,a.jE)(),c=(0,r.n)({mutationFn:async()=>{let e=(0,i.P)();await e.post("/projects/".concat(s,"/unpublish"),{})},onSuccess:()=>{o.invalidateQueries({queryKey:["project",s]}),null==t||t(),n.toast.success("Success!",{description:"Your project has been unpublished."})},onError:e=>{n.toast.error("Unpublish failed",{description:"Please try again."}),null==t||t()}});return{handleUnpublish:async()=>s?c.mutateAsync():void l.logging.error("project id is missing, can't unpublish"),unpublishMutation:c}}},13252:(e,s,t)=>{t.d(s,{s:()=>i});var a=t(37079),r=t(43328),n=t(73728);let i=()=>{let{authUser:e}=(0,a.Z2)(),s=(()=>{let e=(0,n.tY)(),s=(0,n.Nn)(s=>e?s.projectWorkspace:null),t=(0,r.nu)(s=>e?null:s.currentWorkspace);return s||t})();return((e,s)=>!!e&&!!s&&s.owner_id===e)(null==e?void 0:e.uid,s)}},13465:(e,s,t)=>{t.d(s,{CreateWorkspaceDialog:()=>N});var a=t(99289),r=t(11405),n=t(98213),i=t(2906),l=t(76974),o=t(49944),c=t(88852),d=t(82162),u=t(52435),m=t(26551),h=t(66324),x=t(51252),p=t(6919),g=t(37079),j=t(43328),f=t(19618),v=t(34936),y=t(33256),b=t(72384);let w={name:{title:"Create a Workspace",description:"Create a new place to make projects or collaborate with others."},plan:{title:"Select a Plan",description:"Select a plan for your new workspace."}},N=()=>{let e=(0,l.Mu)(e=>e.showCreateWorkspaceDialog),s=(0,l.Mu)(e=>e.setShowCreateWorkspaceDialog),[t,n]=(0,r.useState)("name"),{title:o,description:c}=w[t];return(0,a.jsx)(u.E,{title:o,description:c,open:e,onOpenChange:e=>{e||n("name"),s(e)},className:"plan"===t?"max-w-[600px] md:px-6":"",children:(0,a.jsx)(i.ET,{pricingScenario:"newWorkspace",children:(0,a.jsx)(C,{closeDialog:()=>{n("name"),s(!1)},step:t,setStep:n})})})},C=e=>{let{closeDialog:s,step:t,setStep:o}=e,[c,d]=(0,r.useState)(""),{createWorkspace:u,isCreatingWorkspace:m}=(e=>{let{closeDialog:s}=e,t=(0,x.jE)(),{setCurrentWorkspaceId:a}=(0,j.Dx)(),{store:r}=(0,l.k9)(),{authUser:i}=(0,g.Z2)(),{toCheckout:o}=(0,f.R)(),{mutate:c,isPending:d}=(0,p.n)({mutationFn:async e=>{let{name:s}=e;return(0,y.P)().post("/user/workspaces",{name:s})},onSuccess:async(e,l)=>{var c;let{plan:d,planType:u}=l,m=b.y.workspaces({userId:null==i?void 0:i.uid}).queryKey;t.setQueryData(m,s=>({workspaces:[...(null==s?void 0:s.workspaces)||[],e]}));let h=b.y.detail({workspaceId:e.id,projectId:void 0}).queryKey;t.setQueryData(h,{workspace:e,is_member:!0,current_member:null}),null==r||r.setState({workspaces:[...null!=(c=null==r?void 0:r.getState().workspaces)?c:[],e]}),a(e.id);try{if(!e.id)throw Error("Workspace ID is required");await o({plan:d,workspaceId:e.id,changeType:"upgrade",planType:u}),n.toast.success("Workspace created successfully",{description:e.name})}finally{s()}},onSettled:e=>{e&&(t.invalidateQueries({queryKey:b.y.workspaces({userId:null==i?void 0:i.uid}).queryKey}),t.invalidateQueries({queryKey:b.y.detail({workspaceId:e.id,projectId:void 0}).queryKey}))},onError:e=>{(0,v.Ni)(e)}});return{createWorkspace:c,isCreatingWorkspace:d}})({closeDialog:s}),h=(0,i.et)();return(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(k,{step:t,workspaceName:c,setWorkspaceName:d,closeDialog:s,setStep:o}),(0,a.jsx)(_,{step:t,handleSubmit:()=>{if("name"===t)return""===c?void n.toast.error("Workspace name is required"):void o("plan");null!==h.newWorkspaceSelectedPlan&&u({name:c,plan:h.newWorkspaceSelectedPlan,planType:h.planType})},setStep:o,workspaceName:c,isCreatingWorkspace:m})]})},k=e=>{let{step:s,workspaceName:t,setWorkspaceName:r,closeDialog:n,setStep:i}=e;return(0,a.jsxs)("div",{className:(0,m.cn)("hidden flex-col gap-4","name"===s&&"flex"),children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-1",children:[(0,a.jsx)(d.Label,{children:"Workspace Name"}),(0,a.jsx)(c.p,{id:"workspaceName",value:t,onChange:e=>r(e.target.value),placeholder:"Enter workspace name",required:!0})]}),(0,a.jsxs)("div",{className:"mt-2 flex w-full gap-6 px-1 pb-1",children:[(0,a.jsx)(o.$,{type:"button",className:"flex-1",variant:"secondary",onClick:n,children:"Go Back"}),(0,a.jsx)(o.$,{className:"flex-1",disabled:!t,type:"button",onClick:()=>i("plan"),children:"Continue to Plan"})]})]})},_=e=>{let{step:s,setStep:t,workspaceName:r,isCreatingWorkspace:n,handleSubmit:i}=e;return(0,a.jsxs)("div",{className:(0,m.cn)("hidden flex-col gap-4","plan"===s&&"flex"),children:[(0,a.jsxs)("div",{className:(0,m.cn)("grid grid-cols-1 gap-4 md:grid-cols-2"),children:[(0,a.jsx)(h.ZL.Pro,{}),(0,a.jsx)(h.ZL.Biz,{})]}),(0,a.jsxs)("div",{className:"sticky bottom-0 mt-2 flex w-full gap-6 border-t bg-background px-1 py-3",children:[(0,a.jsx)(o.$,{type:"button",className:"flex-1",variant:"secondary",onClick:()=>t("name"),children:"Go Back"}),(0,a.jsx)(o.$,{className:"flex-1",onClick:i,disabled:!r||n,loading:n,children:n?"Creating...":"Create Workspace"})]})]})}},14090:(e,s,t)=>{t.d(s,{Fc:()=>o,TN:()=>d,XL:()=>c});var a=t(99289),r=t(67312),n=t(11405),i=t(26551);let l=(0,r.F)("relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:text-foreground [&>svg]:left-4 [&>svg]:top-4 [&>svg+div]:translate-y-[-3px] [&>svg~*]:pl-7",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [&>svg]:text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground [&>svg]:text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground [&>svg]:text-destructive-foreground",warning:"border-transparent bg-warning text-warning-foreground [&>svg]:text-warning-foreground",success:"border-transparent bg-success text-success-foreground [&>svg]:text-success-foreground",accent:"border-transparent bg-accent text-accent-foreground [&>svg]:text-accent-foreground",affirmative:"border-transparent bg-affirmative text-affirmative-foreground [&>svg]:text-affirmative-foreground",outline:"text-foreground border border-border","brand-bubblegum":"bg-brand-bubblegum text-brand-bubblegum-foreground","brand-tiger":"bg-brand-tiger text-brand-tiger-foreground","brand-saffron":"bg-brand-saffron text-brand-saffron-foreground","brand-sapphire":"bg-brand-sapphire text-brand-sapphire-foreground","brand-twilight":"bg-brand-twilight text-brand-twilight-foreground","brand-flamingo":"bg-brand-flamingo text-brand-flamingo-foreground"}},defaultVariants:{variant:"default"}}),o=n.forwardRef((e,s)=>{let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,i.cn)(l({variant:r}),t),...n})});o.displayName="Alert";let c=n.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",t),...r})});c.displayName="AlertTitle";let d=n.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",t),...r})});d.displayName="AlertDescription"},14164:(e,s,t)=>{t.d(s,{N:()=>U,U:()=>B});var a=t(99289),r=t(74880),n=t(51252),i=t(6919),l=t(26984),o=t(98213),c=t(99490),d=t(37079),u=t(76974),m=t(39226),h=t(95358),x=t(65746),p=t(39627),g=t(49944),j=t(9562),f=t(6072),v=t(37598),y=t(88852),b=t(90352),w=t(48714),N=t(53012),C=t(34936),k=t(33256),_=t(48591),S=t(97115),I=t(72384),E=t(22291),A=t(43328),P=t(11405),D=t(97757),T=t(59173),L=t(273),z=t(26551),R=t(35225);let O=["image/png","image/jpeg","image/jpg","image/webp"],F=e=>{let{workspace:s,className:t}=e,{authUser:r}=(0,d.Z2)(),l=(0,k.P)(),{upload:c}=(0,R.l)(),u=(0,n.jE)(),m=(0,P.useRef)(null),h=()=>{m.current&&(m.current.value="")},{mutateAsync:x,isPending:p}=(0,i.n)({mutationFn:async e=>{let{file:t,workspaceId:a}=e;if(!r)throw Error("You must be logged in to upload files");await c({fileName:t.name,file:t,options:{maxFileSize:10240,maxDimension:200},continueOnError:!1});let{url:n}=await (0,T.QN)({dir_name:r.uid,file_name:t.name});return await l.put("/user/workspaces/".concat(s.id),{image_url:n})},onSuccess:(e,s)=>{o.toast.success("Updated workspace avatar",{description:"Succesfully uploaded new workspace avatar"}),u.invalidateQueries({queryKey:L.workspaceKeys.all}),h()},onError:()=>{o.toast.error("Failed to update workspace avatar",{description:"Please try again"}),h()}}),j=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&await x({file:a,workspaceId:s.id})};return(0,a.jsxs)(g.$,{variant:"secondary",size:"icon-sm",className:(0,z.cn)("absolute -bottom-1 -right-2 h-5 w-5 rounded-sm border disabled:opacity-100",t),type:"button",disabled:p,onClick:()=>{var e;null==(e=m.current)||e.click()},children:[(0,a.jsx)("input",{type:"file",className:"hidden",accept:O.join(","),onChange:j,disabled:p,ref:m}),(0,a.jsx)(D.A,{name:p?"progress_activity":"edit_square",size:"xsmall",className:p?"animate-spin":""})]})},M=c.Ik({name:c.Yj().min(1,"Workspace name is required"),description:c.Yj().optional(),dataOptOut:c.zM().optional(),shareSampleDataWithLLMs:c.zM().optional(),defaultMonthlyMemberCreditLimit:c.KC([c.ai().positive("Credit limit must be a positive number"),c.ch(),c.Vx()]).optional(),editorCanInvite:c.zM().optional()}),U=e=>{var s,t,n,o,c;let{workspace:d,myWorkspaceRole:u}=e,C="free"===(0,S.m6)(d.plan),I=(0,l.mN)({defaultValues:{name:null!=(s=d.name)?s:"",description:null!=(t=d.description)?t:"",dataOptOut:null!=(n=d.data_opt_out)?n:void 0,shareSampleDataWithLLMs:null==(o=d.share_sample_data_with_llms)||o,defaultMonthlyMemberCreditLimit:null!=(c=d.default_monthly_member_credit_limit)?c:void 0,editorCanInvite:(()=>{var e;return null==(e=d.editor_can_invite)||e})()},resolver:(0,r.u)(M)}),P="owner"===u,D="member"===u,{leaveWorkspace:T,isLeavingWorkspace:L}=function(){let{setCurrentWorkspaceId:e}=(0,A.Dx)(),s=(0,E.useRouter)(),{mutateAsync:t,isPending:a}=(0,i.n)({mutationFn:async e=>(0,k.P)().post("/user/workspaces/".concat(e,"/leave")),onSuccess:async()=>{e(null),s.push("/")}});return{leaveWorkspace:t,isLeavingWorkspace:a}}(),{updateWorkspace:z,isUpdatingWorkspace:R}=B({form:I,workspaceId:d.id}),{isBizPlan:O}=(0,S.cb)(d.plan),U=(0,_.ZS)(),$=(0,h.BK)();return(0,a.jsx)(p.Pt,{title:"Workspace Settings",value:"workspace",description:"Workspaces allow you to collaborate on projects in real time.",docsLink:"https://docs.lovable.dev/user-guides/teams",children:(0,a.jsx)(v.lV,{...I,children:(0,a.jsxs)("form",{className:"flex w-full flex-col gap-6",onSubmit:I.handleSubmit(e=>{z({...e,editor_can_invite:e.editorCanInvite})}),children:[(0,a.jsx)(x.m,{label:"Workspace Avatar",description:"Set an avatar for your workspace.",mobileLayout:"horizontal",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.z,{className:"h-10 w-10",workspace:d}),("admin"===u||P)&&(0,a.jsx)(F,{workspace:d})]})}),(0,a.jsx)(x.m,{label:"Workspace Name",description:"Your full workspace name, as visible to others.",children:(0,a.jsx)(v.zB,{control:I.control,name:"name",render:e=>{let{field:s}=e;return(0,a.jsxs)(v.eI,{className:"w-full",children:[(0,a.jsx)(v.MJ,{children:(0,a.jsx)(j.Q,{showTooltip:D,tooltipContent:"You need to be a workspace admin to modify this field",children:(0,a.jsx)(y.p,{...s,placeholder:"Enter workspace name",disabled:D})})}),(0,a.jsx)(v.C5,{})]})}})}),(0,a.jsx)(x.m,{label:"Workspace Description",description:"A short description about your workspace or team.",isLast:!U&&P&&!O,children:(0,a.jsx)(v.zB,{control:I.control,name:"description",render:e=>{let{field:s}=e;return(0,a.jsxs)(v.eI,{className:"w-full",children:[(0,a.jsx)(v.MJ,{children:(0,a.jsx)(j.Q,{showTooltip:D,tooltipContent:"You need to be a workspace admin to modify this field",children:(0,a.jsx)(w.T,{rows:3,className:"border bg-background",placeholder:"Description",disabled:D,...s})})}),(0,a.jsx)(v.C5,{})]})}})}),U&&(0,a.jsx)(x.m,{isLast:P&&!O,label:"Default Monthly Member Credit Limit",description:"The default monthly credit limit for members of this workspace. Leave empty to use no limit.",children:(0,a.jsx)(v.zB,{control:I.control,name:"defaultMonthlyMemberCreditLimit",render:e=>{var s,t;let{field:r}=e;return(0,a.jsxs)(v.eI,{className:"w-full",children:[(0,a.jsx)(v.MJ,{children:(0,a.jsx)(y.p,{...r,type:"number",placeholder:"Enter default monthly member credit limit (optional)",disabled:D,onChange:e=>{let s=e.target.value;if(""===s)r.onChange(null),I.setValue("defaultMonthlyMemberCreditLimit",null,{shouldDirty:!0});else{let e=Number(s);!isNaN(e)&&e>0&&r.onChange(e)}},onBlur:r.onBlur,name:r.name,value:null===r.value?"":null!=(t=null==(s=r.value)?void 0:s.toString())?t:""})}),(0,a.jsx)(v.C5,{})]})}})}),(0,a.jsx)(x.m,{label:"Include Unprotected Database Samples in Security Scans",description:"Allow sharing sample data from unprotected database tables when analyzing security vulnerabilities.",justify:"end",children:(0,a.jsx)(v.zB,{control:I.control,name:"shareSampleDataWithLLMs",render:e=>{var s;let{field:t}=e;return(0,a.jsx)(v.eI,{children:(0,a.jsx)(v.MJ,{children:(0,a.jsx)(b.d,{disabled:D,checked:null==(s=t.value)||s,onCheckedChange:t.onChange})})})}})}),!!O&&(0,a.jsx)(x.m,{label:"Data Collection Opt Out",description:"Opt out of data collection for this workspace.",isLast:P,badges:["business"],justify:"end",children:(0,a.jsx)(v.zB,{control:I.control,name:"dataOptOut",render:e=>{var s;let{field:t}=e;return(0,a.jsx)(v.eI,{children:(0,a.jsx)(v.MJ,{children:(0,a.jsx)(b.d,{disabled:!P,checked:null!=(s=t.value)&&s,onCheckedChange:t.onChange})})})}})}),P&&(0,a.jsx)(x.m,{label:"Allow editors to invite workspace members",description:C?(0,a.jsxs)("p",{children:[(0,a.jsx)(N.z,{scenario:h.KU.PRO_EDITORS_CAN_INVITE})," to allow editors and viewers to invite other members to this workspace."]}):(0,a.jsx)("p",{children:"When enabled, editors can invite other users to this workspace as editors."}),mobileLayout:"horizontal",badges:["pro"],children:(0,a.jsx)(v.zB,{control:I.control,name:"editorCanInvite",render:e=>{var s;let{field:t}=e;return(0,a.jsx)(b.d,{checked:null==(s=t.value)||s,onCheckedChange:e=>{if(C)return void $(h.KU.PRO_EDITORS_CAN_INVITE);t.onChange(e)},disabled:!1,className:""})}})}),!P&&(0,a.jsx)(x.m,{label:"Leave Workspace",description:"Leave the workspace (you will lose all access to projects inside this workspace).",isLast:!0,justify:"end",children:(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,a.jsxs)(f.lG,{children:[(0,a.jsx)(f.zM,{asChild:!0,children:(0,a.jsx)(g.$,{variant:"destructive",type:"button",loading:L,children:"Leave Workspace"})}),(0,a.jsxs)(f.Cf,{size:"sm",children:[(0,a.jsxs)(f.c7,{children:[(0,a.jsx)(f.L3,{children:"Leave Workspace"}),(0,a.jsx)(f.rr,{children:"Are you sure you want to leave this workspace?"})]}),(0,a.jsxs)(f.Es,{children:[(0,a.jsx)(f.HM,{asChild:!0,children:(0,a.jsx)(g.$,{variant:"outline",children:"Cancel"})}),(0,a.jsx)(g.$,{variant:"destructive",type:"button",loading:L,onClick:()=>T(d.id),children:"Leave Workspace"})]})]})]})})}),I.formState.isDirty&&(0,a.jsx)(x.E,{children:(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsx)(g.$,{variant:"secondary",type:"button",onClick:()=>{I.reset()},children:"Cancel"}),(0,a.jsx)(g.$,{variant:"affirmative",type:"submit",loading:R,children:"Update"})]})})]})})})};function B(e){let{form:s,workspaceId:t}=e,a=(0,n.jE)(),{authUser:r}=(0,d.Z2)(),{store:l}=(0,u.k9)(),{mutate:c,isPending:m}=(0,i.n)({mutationFn:async e=>{var s;return(0,k.P)().put("/user/workspaces/".concat(t),{name:e.name,description:null!=(s=e.description)?s:"",...void 0!==e.dataOptOut&&{data_opt_out:e.dataOptOut},...void 0!==e.shareSampleDataWithLLMs&&{share_sample_data_with_llms:e.shareSampleDataWithLLMs},...void 0!==e.defaultMonthlyMemberCreditLimit&&{default_monthly_member_credit_limit:null===e.defaultMonthlyMemberCreditLimit?-1:e.defaultMonthlyMemberCreditLimit},...void 0!==e.editor_can_invite&&{editor_can_invite:e.editor_can_invite}})},onSuccess:e=>{var n,i,c,d,u,m,h;o.toast.success("Success",{description:"Workspace settings updated successfully"});let x=I.y.detail({workspaceId:t,projectId:void 0}).queryKey;a.setQueryData(x,s=>s?{...s,workspace:e}:{workspace:e,projects:[],is_member:!0,current_member:null});let p=I.y.workspaces({userId:null==r?void 0:r.uid}).queryKey;a.setQueryData(p,s=>s?{workspaces:s.workspaces.map(s=>s.id===e.id?e:s)}:{workspaces:[e]});let g=(null!=(n=null==l?void 0:l.getState().workspaces)?n:[]).map(s=>s.id===e.id?e:s);null==l||l.setState({workspaces:g}),s.reset({name:null!=(i=e.name)?i:"",description:null!=(c=e.description)?c:"",dataOptOut:null!=(d=e.data_opt_out)?d:void 0,shareSampleDataWithLLMs:null==(u=e.share_sample_data_with_llms)||u,defaultMonthlyMemberCreditLimit:null!=(m=e.default_monthly_member_credit_limit)?m:null,editorCanInvite:null==(h=e.editor_can_invite)||h})},onError:e=>{(0,C.Ni)(e)}});return{updateWorkspace:c,isUpdatingWorkspace:m}}},14635:(e,s,t)=>{t.d(s,{S:()=>o});var a=t(99289),r=t(3204),n=t(11405),i=t(26551),l=t(97757);let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.bL,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:(0,a.jsx)(r.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(l.A,{name:"check",className:"h-4 w-4"})})})});o.displayName=r.bL.displayName},15153:(e,s,t)=>{t.d(s,{ViewSwitcherAutoEnable:()=>o});var a=t(11405),r=t(37079),n=t(80328),i=t(19489),l=t(69201);function o(e){var s;let{project:t}=e,{authUser:o}=(0,r.Z2)(),c=(0,n.l)(),d=(0,l.D)(t),u=(0,a.useRef)(!1),{mutate:m}=(0,i.S)({featureKey:"view_switcher",silent:!0,retry:0});return(0,a.useEffect)(()=>{var e;if(!(null==o?void 0:o.uid))return;let s=!!(null==(e=c.features)?void 0:e.view_switcher);!d||s||u.current||(u.current=!0,m(!0))},[d,null==(s=c.features)?void 0:s.view_switcher,m,null==o?void 0:o.uid]),null}},17169:(e,s,t)=>{var a;t.d(s,{s:()=>a}),function(e){var s;(s=e.status||(e.status={})).CONNECTED="connected",s.FAILED="failed",s.NEEDS_REFRESH="needs_refresh"}(a||(a={}))},17489:(e,s,t)=>{t.d(s,{S:()=>M,Z:()=>U});var a=t(99289),r=t(11405),n=t(48591),i=t(23719),l=t(2469),o=t(9563),c=t(90672),d=t(24159);let u=e=>{let{error:s}=e;return(0,a.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:[(0,a.jsx)("h3",{className:"mb-2 text-sm font-medium text-red-800",children:"Error Loading Security Data"}),(0,a.jsx)("p",{className:"text-sm text-red-700",children:s})]})};var m=t(16161);let h=()=>(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(m.E,{className:"h-32 w-full"}),(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(m.E,{className:"h-12 w-full"},s))})]}),x=()=>(0,a.jsx)("div",{className:"rounded-lg border p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-medium",children:"No Security Issues Found"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"All clear—no issues spotted. Keep in mind our scan can't catch every possible risk."})]})});var p=t(49944),g=t(9562),j=t(26551);let f=e=>{let{className:s,text:t="Free"}=e;return(0,a.jsxs)("span",{className:(0,j.cn)("align-baseline text-xs opacity-70",s),children:["(",t,")"]})},v=e=>{let{onClick:s,disabled:t=!1,loading:r=!1,className:n,text:i="Get Security Advice",tooltipContent:l}=e;return(0,a.jsx)(g.Q,{showTooltip:!!l,tooltipContent:l,align:"center",side:"top",children:(0,a.jsxs)(p.$,{variant:"affirmative",onClick:e=>{s(e.shiftKey)},disabled:t,loading:r,className:"gap-1.5 ".concat(n||""),size:"sm",children:[i,(0,a.jsx)(f,{})]})})};var y=t(99017),b=t(45320),w=t(40193),N=t(72887);let C=async(e,s)=>{let t=(0,N.Ok)();try{await e.mutateAsync({body:{id:t,message:"Load the security issues from the scan results and fix them.",intent:w.a.SECURITY_FIX_V2,chat_only:!1}}),null==s||s()}catch(e){}};var k=t(54931);let _=e=>{var s,t;let{projectId:r,onClose:n}=e,{scanData:o,isUpdating:c,captureSecurityEvent:u}=(0,l.t)(),m=!!(null==o||null==(t=o.results)||null==(s=t.agent_security)?void 0:s.isScanUpToDate),{triggerScan:h}=(0,b.J_)(),x=(0,i.mg)({projectId:r||""}),{isChatRequestDisabled:g}=(0,k.v)(r),v=async e=>{if(u(d.$6.SECURITY.VIEW_REVIEW_CLICKED,{action:"deep_scan",forced:!!e.shiftKey,is_up_to_date:m}),!m||e.shiftKey)try{await h({scanner_names:["agent_security"],background:!0,force:e.shiftKey}),null==n||n()}catch(e){}},w=c?"Updating":m?"Up to date":"Outdated";return(0,a.jsx)(y.Bc,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[c?(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-muted-foreground border-t-transparent"}):(0,a.jsx)("div",{className:(0,j.cn)("h-2 w-2 rounded-full",m?"bg-green-500":"bg-amber-500")}),(0,a.jsx)("span",{className:"text-sm text-foreground",children:w})]})}),(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)(p.$,{variant:"affirmative",onClick:v,size:"sm",disabled:g||c,className:(0,j.cn)("w-full gap-1.5",m&&"opacity-60"),children:["Deep Scan",(0,a.jsx)(f,{})]})})}),m&&(0,a.jsx)(y.ZI,{children:"Scan is up to date."})]})}),(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)(p.$,{className:"w-full gap-1.5",variant:"default",size:"sm",onClick:()=>{u(d.$6.SECURITY.VIEW_TRY_FIX_CLICKED,{action:"try_fix_all",is_up_to_date:m}),C(x,n)},disabled:!m||g||c,children:["Try to Fix",(0,a.jsx)(f,{})]})})}),!m&&(0,a.jsx)(y.ZI,{children:"Run a scan first to enable quick fixes"})]})})]})})};var S=t(97757);let I=()=>(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-4 rounded-lg border bg-muted p-3 lg:flex-row lg:items-start lg:justify-between lg:gap-0",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"AI security suggestions. Use the chat to analyze more in detail or fix issues. The deep-scan and try-fix-all is free; guided, step-by-step help uses credits."})}),(0,a.jsx)("div",{className:"flex items-start gap-2 lg:ml-4",children:(0,a.jsx)(y.Bc,{children:(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{asChild:!0,children:(0,a.jsx)("a",{href:"https://docs.lovable.dev/features/security",target:"_blank",rel:"noopener noreferrer",className:"inline-flex cursor-pointer items-center justify-center rounded-md p-2 text-muted-foreground",children:(0,a.jsx)(S.A,{name:"help",size:"small"})})}),(0,a.jsx)(y.ZI,{children:(0,a.jsx)("p",{children:"Check Lovable Security documentation for guidance"})})]})})})]});var E=t(58036),A=t(53417),P=t(2184),D=t(94987);let T=e=>{let{finding:s,source:t,colSpan:r,isAdmin:i=!1}=e,l=(0,n.O3)();return(0,a.jsx)(E.Hj,{children:(0,a.jsx)(E.nA,{colSpan:r,className:"bg-muted/30",children:(0,a.jsxs)("div",{className:"space-y-3 px-2 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"mb-1 text-sm font-medium text-muted-foreground",children:"Issue Description"}),(0,a.jsx)("p",{className:"text-sm text-foreground",children:(e=>{try{let s=/(https?:\/\/[^\s]+)/g;return e.split(s).map((e,t)=>e.match(s)?(0,a.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:e},t):e)}catch(s){return e}})(s.description)})]}),i&&s.details&&l&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"mb-1 text-sm font-medium text-muted-foreground",children:"Technical Details"}),(0,a.jsx)("div",{className:"prose prose-sm prose-invert max-w-none text-foreground prose-code:text-foreground prose-pre:text-foreground",children:(0,a.jsx)(P.oz,{children:s.details})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,a.jsx)(A.E,{variant:"secondary",children:(0,D.Cu)(t)}),(0,a.jsx)(A.E,{variant:"secondary",children:s.id})]})]})})})};var L=t(31167),z=t(39975);let R=e=>{let{source:s,finding:t,rowKey:r,isExpanded:n,onToggleExpansion:i,onTryFix:o,isLoading:c,showLinkColumn:u,showChatAction:m,isDisabled:h=!1,isOutdated:x=!1}=e,{captureSecurityEvent:g}=(0,l.t)(),f=(0,L.Uw)(e=>e.setMessage),{chatInputFormRef:v}=(0,z.N)(),b=e=>{var s;e.stopPropagation(),f((e=>"Security Finding: [".concat(e.level.toUpperCase(),"] ").concat(e.name,"\n\n").concat(e.description,"\n\nIdeas to discuss (pick one and add context):\n- Analyze: explain the risk and remediation details\n- Fix: ask for a fix; optionally outline steps"))(t)),null==(s=v.current)||s.focus()};return(0,a.jsxs)(E.Hj,{className:(0,j.cn)("h-12 cursor-pointer hover:bg-muted/50",h&&"opacity-60"),onClick:()=>i(r),children:[(0,a.jsx)(E.nA,{className:"w-[32px] pl-3",children:n?(0,a.jsx)(S.A,{name:"chevron_down",className:"h-4 w-4"}):(0,a.jsx)(S.A,{name:"chevron_right",className:"h-4 w-4"})}),(0,a.jsx)(E.nA,{children:(0,a.jsx)(A.E,{variant:(0,D.FA)(t.level),children:(0,a.jsx)("span",{className:(0,j.cn)("capitalize",(0,D.XY)(t.level),x&&"opacity-60"),children:t.level})})}),u&&(0,a.jsx)(E.nA,{children:t.link&&(0,a.jsx)("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-muted-foreground hover:text-foreground","aria-label":"Open finding link",children:(0,a.jsx)(S.A,{name:"arrow_outward",className:"h-4 w-4"})})}),(0,a.jsxs)(E.nA,{className:(0,j.cn)("font-medium",x&&"text-muted-foreground"),children:[(0,a.jsx)("span",{className:(0,j.cn)(t.ignore?"line-through":void 0),children:t.name}),t.ignore&&(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:"(ignored)"}),x&&(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:"(outdated)"})]}),m?x?(0,a.jsx)(E.nA,{}):(0,a.jsx)(E.nA,{children:(0,a.jsx)(y.Bc,{children:(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{asChild:!0,children:(0,a.jsx)("button",{type:"button",onClick:b,className:"text-muted-foreground hover:text-foreground","aria-label":"Discuss in chat",children:(0,a.jsx)(S.A,{name:"chat_bubble",className:"h-4 w-4"})})}),(0,a.jsx)(y.ZI,{children:"Open chat with a friendly prompt to discuss this issue."})]})})}):(0,a.jsx)(E.nA,{children:"error"===t.level&&(0,a.jsx)(p.$,{size:"sm",variant:"default",onClick:e=>{e.stopPropagation(),g(d.$6.SECURITY.VIEW_TRY_FIX_CLICKED,{finding_id:t.id,finding_name:t.name,finding_level:t.level,source:s}),o(t,s)},disabled:c||h,children:"Try to Fix"})})]},r)};var O=t(34958);let F=e=>{let{findings:s,expandedRows:t,onToggleExpansion:r,onTryFix:i,isLoading:l,isDisabled:o=!1,outdatedBySource:c={}}=e,d=(0,n.O3)(),u=(0,O.WW)(),m=s.some(e=>!!e.finding.link),h=!!d;return(0,a.jsx)("div",{className:"rounded-lg border",children:(0,a.jsxs)(E.XI,{className:"table-fixed",children:[(0,a.jsx)(E.A0,{children:(0,a.jsxs)(E.Hj,{children:[(0,a.jsx)(E.nd,{className:"w-[32px]"}),(0,a.jsx)(E.nd,{className:"w-[64px]",children:"Level"}),m&&(0,a.jsx)(E.nd,{className:"w-[48px]",children:"Link"}),(0,a.jsx)(E.nd,{children:"Issue"}),h&&(0,a.jsx)(E.nd,{className:"w-[56px]",children:"Chat"}),!h&&(0,a.jsx)(E.nd,{className:"w-[100px]"})]})}),(0,a.jsx)(E.BF,{children:s.map((e,s)=>{let{source:n,finding:d}=e,x="".concat(n,"-").concat(d.id,"-").concat(s),p=t.has(x),g=c[n];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R,{source:n,finding:d,rowKey:x,isExpanded:p,onToggleExpansion:r,onTryFix:i,isLoading:l,showLinkColumn:m,showChatAction:h,isDisabled:o||!!g,isOutdated:!!g},x),p&&(0,a.jsx)(T,{finding:d,source:n,colSpan:+!!m+1+3,isAdmin:u})]})})})]})})},M=e=>{let{onClose:s}=e,t=(0,o.Iw)(e=>e.project),m=null==t?void 0:t.id,{scanData:p,isLoading:g,error:j,triggerScan:f,captureSecurityEvent:y}=(0,l.t)(),b=(0,n.O3)(),{isChatRequestDisabled:w}=(0,k.v)(m),[C,S]=(0,r.useState)(new Set),E=(0,i.mg)({projectId:m||""}),{handleSecurityReview:A}=(0,c.O)({projectId:m,setIsOpen:s});(0,r.useEffect)(()=>{f({scanner_names:["supabase","supabase_lov"]})},[f]);let P=(null==p?void 0:p.results)?Object.entries(p.results).flatMap(e=>{var s;let[t,a]=e;return(null!=(s=a.items)?s:[]).map(e=>({source:t,finding:e}))}):[],D=(null==p?void 0:p.results)?Object.fromEntries(Object.entries(p.results).filter(e=>{let[,s]=e;return s&&"object"==typeof s}).map(e=>{let[s,t]=e;return[s,!t.isScanUpToDate]})):{},T=P.filter(e=>!0).sort((e,s)=>{let t={error:0,warn:1,info:2};return t[e.finding.level]-t[s.finding.level]}),L=async e=>{await (0,N.Vv)(e,E,s)};return j?(0,a.jsx)(u,{error:j}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(I,{}),b&&(0,a.jsx)(_,{projectId:m,onClose:s}),g?(0,a.jsx)(h,{}):T.length>0?(0,a.jsx)(F,{findings:T,expandedRows:C,onToggleExpansion:e=>{let s=new Set(C);s.has(e)?s.delete(e):s.add(e),S(s)},onTryFix:L,isLoading:E.isPending,isDisabled:w,outdatedBySource:D}):(0,a.jsx)(x,{}),!b&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)(v,{onClick:()=>{y(d.$6.SECURITY.VIEW_REVIEW_CLICKED),A()},disabled:w,loading:E.isPending,text:"Additional Security Review"})})]})},U=()=>(0,a.jsx)("div",{className:"flex min-h-full flex-col gap-6 overflow-y-auto p-4",children:(0,a.jsx)(M,{})})},19489:(e,s,t)=>{t.d(s,{S:()=>d});var a=t(51252),r=t(6919),n=t(7907),i=t(37079),l=t(34936),o=t(33256),c=t(50088);function d(e){let{featureKey:s,silent:t=!1,onSuccess:d,onError:u,retry:m}=e,{authUser:h}=(0,i.Z2)(),x=(0,n.sf)(),p=(0,a.jE)(),g=["labs-feature",null==h?void 0:h.uid,s];return(0,r.n)({mutationKey:g,retry:m,mutationFn:async e=>{if(!(null==h?void 0:h.uid))throw Error("User not found");return(0,o.P)().patch("/users/".concat(null==h?void 0:h.uid,"/experimental-features"),{feature:s,enabled:e})},onMutate:e=>{p.cancelQueries({queryKey:c.Y.experimentalFeatures({user:h}).queryKey});let t=p.getQueryData(c.Y.experimentalFeatures({user:h}).queryKey);return p.setQueryData(c.Y.experimentalFeatures({user:h}).queryKey,t=>t?{...t,[s]:e}:null),{previousFeatures:t}},onSuccess:(e,t)=>{x.capture("lab-feature-toggled",{feature:s,enabled:t}),null==d||d(t)},onError:(e,a,r)=>{p.setQueryData(c.Y.experimentalFeatures({user:h}).queryKey,e=>{var t;return e?{...e,[s]:null==r||null==(t=r.previousFeatures)?void 0:t[s]}:null}),t||(0,l.Ni)(e),null==u||u(e)},onSettled:()=>{let e=c.Y.experimentalFeatures({user:h}).queryKey;p.invalidateQueries({queryKey:e})}})}},22952:(e,s,t)=>{t.d(s,{N:()=>j});var a=t(99289),r=t(22803),n=t(11405),i=t(19550),l=t.n(i),o=t(22291),c=t(81797),d=t(26551),u=t(52983),m=t(49944),h=t(97757),x=t(40074);let p=e=>{let{type:s,message:t,persistDismiss:r=!1,storageKey:i,bgColor:p,href:g,onClick:j,className:f,darkCloseIcon:v=!1}=e,y=(0,o.usePathname)(),b=(0,n.useRef)(null),[w,N]=(0,u.V)(i||"default-banner-key",{defaultValue:!0}),[C,k]=(0,n.useState)(!1),[_,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{S(!0),k(!0)},[]);let I=(null==y?void 0:y.startsWith("/projects/"))&&["ph-launch-banner","rebrand-banner"].includes(i||""),E=!I&&(r?w:C);if(I||r&&!i||!E||x.env.TEST_E2E)return null;let A=(0,a.jsxs)("div",{ref:b,className:(0,d.cn)("z-[1050] hidden w-full items-center justify-between px-2 py-2 text-sm text-white transition-opacity duration-300 md:px-4 md:text-base",p||("error"===s?"bg-destructive-primary":"bg-background"),f,_&&"flex"),children:[(0,a.jsx)("div",{className:"flex flex-grow items-center justify-center space-x-4 pr-6 md:text-center",children:t}),(0,a.jsx)(m.$,{variant:"ghost",size:"icon",className:(0,d.cn)("hover:bg-transparent md:absolute md:right-2",v?"text-primary-foreground hover:text-primary-foreground":"text-primary"),onClick:e=>{e.stopPropagation(),r?N(!1):k(!1),c.Ay.capture("banner_dismissed",{banner_type:s,message:t,persisted:r})},children:(0,a.jsx)(h.A,{name:"close_small"})})]});return g?(0,a.jsx)(l(),{href:g,target:"_blank",rel:"noopener noreferrer",onClick:j,className:"w-full",children:A}):A};var g=t(26787);let j=e=>{let{className:s}=e,[t,i]=(0,n.useState)({showStatusBanner:!1,statusBannerContent:"",statusBannerLink:""});return((0,n.useEffect)(()=>{(async()=>{try{let e=(0,r.H9)(g.db,"system","info"),s=await (0,r.x7)(e);s.exists()&&i(s.data())}catch(e){}})()},[]),t.showStatusBanner&&t.statusBannerContent)?(0,a.jsx)(p,{message:t.statusBannerContent,type:"error",className:s,href:t.statusBannerLink}):null}},23660:(e,s,t)=>{t.d(s,{g:()=>x});var a=t(99289),r=t(19550),n=t.n(r),i=t(11405),l=t(5943),o=t(9562),c=t(5531),d=t(97757),u=t(17169),m=t(62593),h=t(77987);let x=e=>{var s;let{organization:t,reconnectOrg:r,isWorkspaceAdmin:i}=e;return t.status===u.s.status.NEEDS_REFRESH?(0,a.jsx)(o.Q,{showTooltip:!0,tooltipContent:i?"Click to reconnect to Supabase":"Ask an admin of your workspace to reconnect to Supabase",children:(0,a.jsxs)(c._2,{onClick:()=>r({supabaseOrgId:t.id}),className:"flex items-center gap-2 text-destructive-primary",disabled:!i,children:[(0,a.jsx)(d.A,{name:"warning_fill",size:"small",className:"text-destructive-primary"}),(0,a.jsx)("span",{className:"truncate",children:t.name})]})}):(0,a.jsxs)(c.lv,{children:[(0,a.jsx)(c.nV,{className:"text-sm",children:(0,a.jsx)("span",{className:"truncate",children:t.name})}),(0,a.jsxs)(c.M5,{className:"w-56 p-0",children:[(0,a.jsxs)(l.uB,{children:[(0,a.jsx)(l.G7,{placeholder:"Search projects...",autoFocus:!0}),(0,a.jsxs)(l.oI,{className:"max-h-60",children:[(0,a.jsx)(l.xL,{children:"No projects found."}),(0,a.jsx)(l.L$,{children:null==(s=t.projects)?void 0:s.map(e=>(0,a.jsx)(p,{project:e},e.id))})]})]}),(0,a.jsx)(c.mB,{className:"mt-0"}),(0,a.jsx)("div",{className:"px-1 pb-1",children:(0,a.jsx)(c._2,{asChild:!0,children:(0,a.jsxs)(n(),{href:"https://supabase.com/dashboard/new/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"flex w-full items-center gap-2",children:[(0,a.jsx)(d.A,{name:"add",size:"small"}),"Create project",(0,a.jsx)(d.A,{name:"arrow_outward",size:"small",className:"ml-auto"})]})})})]})]},t.id)},p=e=>{let{project:s}=e,t=(0,h.L)(s),{setSelectedProject:r,setOpen:n}=(0,m.C)(),c=(0,i.useCallback)(()=>{r(s),n(!1)},[s,r,n]);return(0,a.jsx)(o.Q,{showTooltip:!t,side:"left",tooltipContent:"Check project status in Supabase.",children:(0,a.jsxs)(l.h_,{onSelect:c,disabled:!t,className:"group flex w-full items-center",value:s.name,children:[(0,a.jsx)("span",{className:"truncate",children:s.name}),!t&&(0,a.jsx)(d.A,{name:"warning_fill",size:"small",className:"ml-auto text-destructive-primary"})]},s.id)})}},24655:(e,s,t)=>{t.d(s,{AY:()=>u,Ge:()=>h,SM:()=>o,U$:()=>c,jj:()=>m,kF:()=>d});var a=t(11405),r=t(98213),n=t(99490),i=t(69147);let l=(e,s)=>"integrationOAuth_".concat(e,"_").concat(s),o=e=>l(e,"nonce"),c=e=>l(e,"codeVerifier"),d=e=>l(e,"clientData"),u=n.Ik({workspaceId:n.Yj(),integrationName:n.Yj(),serverUrl:n.Yj(),nonce:n.Yj(),testConnection:n.zM().optional()}),m=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{testConnection:!1},[t,n]=(0,a.useState)(!1);return{handleConnect:(0,a.useCallback)(async(t,a)=>{n(!0);let l=window.location.origin,u="".concat(l,"/integration/").concat(t,"/oauth/callback"),m=crypto.randomUUID();try{localStorage.setItem(o(t),m)}catch(e){throw i.logging.error("Error storing nonce in localStorage:",{error:e}),r.toast.error("Failed to initiate OAuth flow",{description:"Try clearing browser local storage and try again."}),n(!1),Error("Failed to initiate OAuth flow",{cause:e})}try{let r=btoa(JSON.stringify({workspaceId:e,integrationName:t,serverUrl:a,nonce:m,testConnection:null==s?void 0:s.testConnection})),n=function(){let e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(),l=await p(n);localStorage.setItem(c(t),n);let{resourceMetadata:o,authMetadata:g}=await h(a);if(!g)throw Error("Server does not support OAuth authentication");let j=null;if(g.registration_endpoint)try{j=await x(g.registration_endpoint,u),localStorage.setItem(d(t),JSON.stringify(j))}catch(e){i.logging.warn("Dynamic client registration failed, continuing without client_id",{error:e})}let f=new URL(g.authorization_endpoint);f.searchParams.set("response_type","code"),f.searchParams.set("redirect_uri",u),f.searchParams.set("state",r),f.searchParams.set("code_challenge",l),f.searchParams.set("code_challenge_method","S256"),(null==o?void 0:o.resource)?f.searchParams.set("resource",o.resource):f.searchParams.set("resource",a),(null==j?void 0:j.clientId)&&f.searchParams.set("client_id",j.clientId);let v=window.open(f.toString(),"_blank","width=600,height=700,left=100,top=100");if(!v){window.location.href=f.toString();return}return v.focus(),new Promise((e,s)=>{let t=r=>{if(r.origin!==window.location.origin)return;let n=r.data;"integrationAuth"===n.type&&(window.removeEventListener("message",t),clearInterval(a),n.success?e():s(Error(n.error||"OAuth authentication failed")))};window.addEventListener("message",t);let a=setInterval(()=>{v.closed&&(clearInterval(a),window.removeEventListener("message",t),s(Error("OAuth popup was closed by user")))},1e3);setTimeout(()=>{clearInterval(a),window.removeEventListener("message",t),v.closed||v.close(),s(Error("OAuth authentication timed out"))},3e5)})}catch(e){throw i.logging.error("Error initiating OAuth connection:",{error:e}),r.toast.error("Connection Error",{description:"An error occurred while connecting. Please try again."}),e}finally{n(!1)}},[e]),isConnecting:t}};async function h(e){var s;let t=new URL(e),a="".concat(t.protocol,"//").concat(t.host),r=null,n=null,l="".concat(a,"/.well-known/oauth-protected-resource");try{let e=await fetch(l);e.ok&&(r=await e.json())}catch(e){i.logging.warn("Failed to fetch protected resource metadata",{error:e,url:l})}let o=(null==r||null==(s=r.authorization_servers)?void 0:s[0])||a,c="".concat(o,"/.well-known/oauth-authorization-server");try{let e=await fetch(c);e.ok&&(n=await e.json())}catch(e){i.logging.warn("Failed to fetch authorization server metadata",{error:e,url:c})}return{resourceMetadata:r,authMetadata:n}}async function x(e,s){let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_name:"Lovable",client_uri:"https://lovable.dev",redirect_uris:[s],grant_types:["authorization_code","refresh_token"],response_types:["code"],token_endpoint_auth_method:"none"})});if(!t.ok){let e=await t.text();throw Error("Client registration failed with status ".concat(t.status,": ").concat(e))}let a=await t.json();return{clientId:a.client_id,clientSecret:a.client_secret}}async function p(e){let s=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",s);return btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(t)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}},31196:(e,s,t)=>{t.d(s,{AF:()=>c,UO:()=>m,xO:()=>d,yk:()=>u});var a=t(11405),r=t(98213),n=t(99490),i=t(66608),l=t(69147),o=t(40074);let c="supabaseOAuthNonce",d="supabaseOAuthCodeVerifier",u=n.Ik({workspaceId:n.Yj(),userId:n.Yj().optional(),nonce:n.Yj()}),m=e=>{let[s,t]=(0,a.useState)(!1),{userData:n}=(0,i.ur)();return{handleConnect:(0,a.useCallback)(async s=>{t(!0);try{let a=window.location.origin,i=crypto.randomUUID();try{localStorage.setItem(c,i)}catch(e){l.logging.error("Error storing nonce in localStorage:",{error:e}),r.toast.error("Failed to initiate Supabase OAuth flow",{description:"Try clearing browser local storage and try again."}),t(!1);return}let u=btoa(JSON.stringify({workspaceId:e,userId:null==n?void 0:n.id,nonce:i})),m=o.env.NEXT_PUBLIC_SUPABASE_OAUTH_CLIENT_ID||"dbd565fc-4637-4cb6-ab68-0af4b5708417",x=function(){let e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(),p=await h(x);localStorage.setItem(d,x);let g=new URL("https://api.supabase.com/v1/oauth/authorize");g.searchParams.set("response_type","code"),g.searchParams.set("client_id",m),g.searchParams.set("redirect_uri","".concat(a,"/supabase/callback")),g.searchParams.set("state",u),g.searchParams.set("code_challenge",p),g.searchParams.set("code_challenge_method","S256"),(null==s?void 0:s.supabaseOrgId)&&g.searchParams.set("organization_slug",encodeURIComponent(s.supabaseOrgId));let j=window.open(g.toString(),"_blank","width=600,height=700,left=100,top=100");j?j.focus():window.location.href=g.toString()}catch(e){l.logging.error("Error initiating Supabase connection:",{error:e}),r.toast.error("Connection Error",{description:"An error occurred while connecting to Supabase. Please try again."})}finally{t(!1)}},[e,null==n?void 0:n.id]),isConnecting:s}};async function h(e){let s=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",s);return btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(t)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}},35270:(e,s,t)=>{t.d(s,{l:()=>a});var a=function(e){return e.AGENT="agent",e.INSTANT="instant",e}({})},38590:(e,s,t)=>{t.d(s,{m:()=>w});var a=t(99289),r=t(1596),n=t(38387),i=t(74174),l=t(9070),o=t(97757),c=t(68939),d=t(99605),u=t(26551),m=t(18883),h=t(27899);let x=e=>{let{workspace:s,isOwnerOfWorkspace:t}=e,x=(0,c.D)(s),{openSettings:p}=(0,l.t)(),g=(0,h.IJ)(x.currentlyConsuming,x.sources),j=(0,r.GP)((0,n.w)((0,i.P)(new Date,1)),"dd MMM");return(0,a.jsxs)("div",{className:"flex flex-col gap-2.5 rounded-xl bg-muted p-4 md:rounded-md md:p-3",children:[(0,a.jsxs)("div",{className:(0,u.cn)("flex items-center justify-between",{"cursor-pointer transition-all duration-150 ease-in-out hover:opacity-80":t}),onClick:t?()=>{p("billing")}:void 0,children:[(0,a.jsx)("p",{className:"text-base font-medium text-foreground md:text-sm",children:"Credits"}),(0,a.jsxs)("div",{className:"flex items-center gap-px",children:[(0,a.jsx)("p",{className:(0,u.cn)("text-base font-normal md:text-sm",0===x.totalRemaining&&t?"text-foreground":"text-muted-foreground"),children:0===x.totalRemaining&&t?"Upgrade":0===x.totalRemaining?"0 left":"".concat((0,m.Q)(x.totalRemaining)," left")}),t&&(0,a.jsx)(o.A,{name:"chevron_right",size:"small",className:(0,u.cn)(0===x.totalRemaining?"text-foreground":"text-muted-foreground")})]})]}),(0,a.jsx)(h.bY,{progressData:x}),(x.currentlyConsuming||0===x.totalRemaining)&&"free"!==s.plan&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(g)}),(0,a.jsx)("p",{className:"text-base text-muted-foreground md:text-sm",children:(0,h.bT)(x.currentlyConsuming)})]}),("free"===s.plan||"ktlo"===s.plan)&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-muted-foreground"}),(0,a.jsx)("p",{className:"text-base text-muted-foreground md:text-sm",children:x.totalCreditsUsedInBillingPeriod>=d.le?"Free credits reset on ".concat(j):"Daily credits reset at midnight UTC"})]})]})};var p=t(85967);let g=t(11405).forwardRef((e,s)=>{let{className:t,value:r,...n}=e;return(0,a.jsx)(p.bL,{ref:s,className:(0,u.cn)("relative h-4 w-full overflow-hidden rounded-full bg-muted-active",t),...n,children:(0,a.jsx)(p.C1,{className:"h-full w-full flex-1 bg-brand-twilight-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});g.displayName=p.bL.displayName;var j=t(99017),f=t(34958),v=t(83469),y=t(97115),b=t(79062);let w=e=>{let{workspace:s,membership:t,className:r}=e,{userMonthlyUsage:n,maxUserMonthlyUsage:i,hasCreditLimit:l}=(0,v.$)(s),c=(0,f.WW)();if("inactive"===s.plan)return null;let d=(null==t?void 0:t.role)==="owner"||(null==t?void 0:t.role)==="admin",{isBizPlan:m,isEnterprisePlan:h}=(0,y.cb)(s.plan);if(h)return null;let p=m&&!d;return(0,a.jsxs)("div",{className:(0,u.cn)("flex flex-col gap-1",r),children:[(!p||c)&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(x,{workspace:s,isOwnerOfWorkspace:(null==t?void 0:t.role)==="owner"})}),(n>0||l)&&m&&(0,a.jsxs)("div",{className:"flex flex-col gap-2.5 rounded-xl bg-muted p-4 md:rounded-md md:p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-base font-medium text-foreground md:text-sm",children:"Personal usage"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("p",{className:"text-base font-normal text-muted-foreground md:text-sm",children:[(0,b.Q)(n),l&&" / ".concat((0,b.Q)(i))]}),(0,a.jsxs)(j.m_,{children:[(0,a.jsx)(j.k$,{asChild:!0,children:(0,a.jsx)("div",{children:(null==t?void 0:t.role)!=="owner"&&l&&(0,a.jsx)(o.A,{name:"info",size:"small",className:"h-4 w-4 cursor-pointer text-muted-foreground"})})}),(null==t?void 0:t.role)!=="owner"&&l&&(0,a.jsx)(j.ZI,{children:(0,a.jsx)("p",{children:"Ask your workspace admin to increase the limit"})})]})]})]}),l&&(0,a.jsx)(g,{value:n/i*100,className:"h-2.5 w-full"})]})]})}},40193:(e,s,t)=>{t.d(s,{a:()=>a});let a={SECURITY_REVIEW:"security_review",SECURITY_FIX:"security_fix",SECURITY_FIX_V2:"security_fix_v2"}},43724:(e,s,t)=>{t.d(s,{A:()=>o});var a=t(99289),r=t(9563),n=t(73728),i=t(34958),l=t(91253);let o=e=>{let s=(0,r.Iw)(e=>e.project),t=null==s?void 0:s.supabase_project_config,o=!!(null==t?void 0:t.supabase_project_id),c=(0,n.B5)(e=>e.membership),d=(0,i.WW)()||(null==c?void 0:c.role)==="admin"||(null==c?void 0:c.role)==="owner";return(0,a.jsx)(l.J,{...e,isAdmin:d,showConnectStep:!o})}},45320:(e,s,t)=>{t.d(s,{O5:()=>x,J_:()=>g,dr:()=>j});var a=t(99289),r=t(22803),n=t(11405),i=t(76918),l=t(33256),o=t(26787),c=t(69147);let d={errorCount:0,warnCount:0,infoCount:0},u={results:{},project_id:"",is_scanning:!1};var m=t(9563);let h=(0,n.createContext)(null),x=e=>{let{children:s,projectId:t}=e;return(0,a.jsx)(p,{projectId:t,children:s},t)},p=e=>{let{children:s,projectId:t}=e,x=(0,n.useRef)((0,i.vt)(()=>({securitySummary:d,scanData:null,isLoading:!0,isUpdating:!1,error:null,projectId:t,hasTriggeredInitialScan:!1}))),p=(0,m.Iw)(e=>{var s;return null==(s=e.project)?void 0:s.latest_commit_sha}),g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=x.current;if(t)try{var a,r;s.setState({isUpdating:!0,error:null});let n=await (0,l.P)().getApi(),i={scanner_names:null!=(r=e.scanner_names)?r:["supabase","supabase_lov"],background:e.background,force:e.force};(null==(a=(await n.post("/projects/".concat(t,"/security-scan"),i)).data)?void 0:a.status)!=="started"&&s.setState({isUpdating:!1})}catch(e){c.logging.error("Error triggering security scan",{projectId:t,error:e}),s.setState({error:"Failed to trigger security scan",isUpdating:!1})}};(0,n.useEffect)(()=>{if(!t)return;let e=(0,r.H9)(o.db,"projects/".concat(t,"/security/data")),s=(0,r.aQ)(e,e=>{let s=x.current;try{if(e.exists()){let t=e.data(),a=Object.fromEntries(Object.entries(t.results||{}).map(e=>{let[s,t]=e,a=!!(p&&(null==t?void 0:t.commit)===p);return[s,{...t,isScanUpToDate:a}]})),r={...t,results:a};if(s.setState({scanData:r,securitySummary:(e=>{if(!(null==e?void 0:e.results))return d;let s=0,t=0,a=0;return Object.values(e.results).forEach(e=>{e.items&&e.items.forEach(e=>{switch(e.level){case"error":s++;break;case"warn":t++;break;case"info":a++}})}),{errorCount:s,warnCount:t,infoCount:a}})(r),error:null,isLoading:!1,isUpdating:!!t.is_scanning}),!s.getState().hasTriggeredInitialScan&&!t.is_scanning){s.setState({hasTriggeredInitialScan:!0});let e=(e=>{if(!(null==e?void 0:e.results))return null;let s=null,t=null;return(Object.values(e.results).forEach(e=>{(null===s||e.timestamp>s)&&(s=e.timestamp,t=e.commit)}),s&&t)?{timestamp:s,commit:t}:null})(t);p&&(null==e?void 0:e.commit)!==p&&g()}}else s.setState({securitySummary:d,scanData:{...u,project_id:t},error:null,isLoading:!0,isUpdating:!1}),s.getState().hasTriggeredInitialScan||(s.setState({hasTriggeredInitialScan:!0}),g())}catch(e){c.logging.error("Error parsing security findings data",{projectId:t,error:e}),s.setState({error:"Failed to parse security data",isLoading:!1,isUpdating:!1})}},e=>{c.logging.error("Error listening to security findings",{projectId:t,error:e}),x.current.setState({error:"Failed to load security data",isLoading:!1,isUpdating:!1})});return()=>s()},[t,p]);let j={store:x.current,triggerScan:g};return(0,a.jsx)(h.Provider,{value:j,children:s})};function g(){let e=(0,n.useContext)(h);if(!e)throw Error("useSecurityContext must be used within a SecurityProvider");return e}function j(e){let{store:s}=g();return s(e)}},50363:(e,s,t)=>{t.d(s,{H:()=>o});var a=t(99289),r=t(76185),n=t(5531),i=t(97757),l=t(67017);let o=()=>{let e=(0,l.A)("md"),{theme:s,setTheme:t}=(0,r.D)();return e?null:(0,a.jsxs)(n.lv,{children:[(0,a.jsxs)(n.nV,{children:[(0,a.jsx)(i.A,{name:"contrast"}),(0,a.jsx)("p",{children:"Appearance"})]}),(0,a.jsx)(n.dc,{children:(0,a.jsx)(n.M5,{children:(0,a.jsxs)(n.Hr,{value:s,onValueChange:e=>{("light"===e||"dark"===e||"system"===e)&&t(e)},children:[(0,a.jsx)(n.Ht,{value:"light",children:"Light"}),(0,a.jsx)(n.Ht,{value:"dark",children:"Dark"}),(0,a.jsx)(n.Ht,{value:"system",children:"System theme"})]})})})]})}},51758:(e,s,t)=>{t.d(s,{$w:()=>g,Cl:()=>j,KE:()=>p});var a=t(6919),r=t(22803),n=t(11405),i=t(64705),l=t(3158),o=t(33256),c=t(26787),d=t(69147),u=t(14026),m=t(92936),h=t(80587);function x(e){var s,t,a;let r=e.meta_data?"|".concat(null==(s=e.meta_data)?void 0:s.colno,"|").concat(null==(t=e.meta_data)?void 0:t.lineno,"|").concat(null==(a=e.meta_data)?void 0:a.filename):"";return"".concat(e.error_message,"|").concat(e.type).concat(r)}function p(e){return e.filter((e,s,t)=>s===t.findIndex(s=>x(s)===x(e)))}function g(e){let{projectId:s,errorIds:t,setErrors:r}=e;return(0,a.n)({mutationFn:async()=>(r([]),(0,o.P)().patch("/projects/".concat(s,"/handle-errors"),{error_ids:t})),onError:e=>{d.logging.error("failed_to_submit_handled_errors",{error:e})}})}let j=e=>{let{projectId:s}=e,[t,a]=(0,n.useState)([]),x=(0,o.P)(),p=(0,l.sF)();(0,i.Ay)(p,{protocols:"vite-hmr",share:!0,onMessage:e=>{try{let a=JSON.parse(e.data);if((null==a?void 0:a.type)==="error"){var t;d.logging.info("build_error_from_devserver",{message:null==a||null==(t=a.err)?void 0:t.message});let e=m.J.safeParse(null==a?void 0:a.err);e.success?(0,h.N)(e.data,s,x):(d.logging.error("error_parsing_devserver_error",{error:e}),(0,h.N)(null==a?void 0:a.err,s,x))}}catch(e){d.logging.error("error_parsing_devserver_error",{error:e})}},onOpen:e=>{d.logging.debug("devserver_websocket_open")},onClose:e=>{d.logging.debug("devserver_websocket_close")},onError:e=>{d.logging.error("devserver_websocket_error",{event:e})},shouldReconnect:()=>!0,reconnectInterval:1e3});let j=g({projectId:s,errorIds:t.map(e=>e.id),setErrors:a});return(0,n.useEffect)(()=>{let e=function(e,s){let t=(0,r.rJ)(c.db,"projects/".concat(e,"/errors")),a=(0,r.P)(t,(0,r._M)("handled_at","==",null));return(0,r.aQ)(a,e=>{e.empty?s([]):s(e.docs.map(e=>({...e.data(),id:e.id})))})}(s,a);return()=>e()},[s]),{errors:(0,n.useMemo)(()=>0===t.length?null:(e=>{e.sort((e,s)=>e.type===u.B.RUNTIME&&s.type!==u.B.RUNTIME?-1:s.created_at.seconds-e.created_at.seconds);let s={uniqueErrors:[],runtimeErrorMessages:new Set};return e.reduce((e,s)=>{if(s.type===u.B.IMMEDIATE_RUNTIME||s.type===u.B.RUNTIME){let t=s.error_message.replace(/\?v=[a-z0-9]{8}/,"?'");e.runtimeErrorMessages.has(t)||(e.runtimeErrorMessages.add(t),e.uniqueErrors.push(s))}else e.uniqueErrors.push(s);return e},s).uniqueErrors})(t),[t]),setErrors:a,handleErrorMutation:t.length>0?j:null}}},52435:(e,s,t)=>{t.d(s,{E:()=>u});var a=t(99289),r=t(69764),n=t(99990),i=t(11405),l=t(49944),o=t(97757),c=t(86077),d=t(26551);let u=e=>{let{title:s,description:t,children:u,open:m,onOpenChange:h,className:x}=e;return(0,i.useEffect)(()=>(m?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[m]),(0,a.jsx)(r.lG,{open:m,onOpenChange:h,children:(0,a.jsx)(r.ZJ,{children:(0,a.jsxs)(r.Cf,{className:"fixed inset-0 z-[10000] flex items-center justify-center overflow-y-auto bg-background",onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,a.jsxs)(n.s6,{children:[(0,a.jsx)(r.L3,{children:s}),(0,a.jsx)(r.rr,{children:t})]}),(0,a.jsxs)("div",{className:(0,d.cn)("flex max-h-full w-full max-w-96 flex-col gap-6 px-4 py-4 md:px-1",x),children:[(0,a.jsx)(c.Fy,{className:"size-9 shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h2",{className:"mr-auto text-2xl md:text-3xl",children:s}),(0,a.jsx)("p",{className:"w-full",children:t})]}),u]}),(0,a.jsx)("div",{className:"absolute right-2 top-2 md:right-8 md:top-8",children:(0,a.jsx)(r.HM,{asChild:!0,children:(0,a.jsx)(l.$,{className:"hover:bg-transparent hover:opacity-75",variant:"ghost",children:(0,a.jsx)(o.A,{name:"close",size:"small"})})})})]})})})}},52959:(e,s,t)=>{t.d(s,{S:()=>M});var a=t(99289),r=t(81797),n=t(11405),i=t(39627),l=t(49944),o=t(9562),c=t(97757),d=t(24159),u=t(48591),m=t(26551);let h=e=>{let{children:s,descriptionAction:t,description:r,title:n}=e;return(0,a.jsxs)("div",{className:"flex min-h-full flex-col gap-6 overflow-y-auto p-4",children:[(n||r||t)&&(0,a.jsxs)("div",{className:"flex w-full flex-col gap-2 border-b pb-3",children:[n&&(0,a.jsx)("h4",{className:"flex items-center gap-2 text-lg font-medium",children:(0,a.jsx)("span",{children:n})}),(r||t)&&(0,a.jsxs)("div",{className:"flex flex-col items-start justify-between gap-2 text-sm text-muted-foreground md:flex-row",children:[(0,a.jsx)("div",{children:r}),t&&t]})]}),s]})};var x=t(44794),p=t(34363),g=t(78380),j=t(33256);let f={error:0,warning:1,minor:2,info:3},v={severities:["error"]},y=e=>e.filter(e=>v.severities.includes(e.severity)),b={all:["pageSpeed"],project:e=>[...b.all,e],combination:(e,s,t)=>[...b.project(e),s,t]},w={combination:e=>{let{projectId:s,strategy:t,category:a,forceReload:r=!1,isPublished:n,publishedCommitSha:i}=e;return{queryKey:b.combination(s,t,a),queryFn:async()=>{let e=(0,j.P)();return((e,s,t,a)=>{var r,n,i,l,o;let c=((e,s)=>{var t,a;let r=null==e||null==(a=e.results)||null==(t=a.lighthouseResult)?void 0:t.categories;if(!r)return null;let n=r[({performance:"performance",accessibility:"accessibility","best-practices":"best-practices",seo:"seo"})[s]];return n?{label:({performance:"Performance",accessibility:"Accessibility","best-practices":"Best Practices",seo:"SEO"})[s],score:Math.round(100*(n.score||0)),category:s}:null})(e,t);return c?{strategy:s,category:t,score:c,audits:(e=>{var s,t;if(!(null==e||null==(t=e.results)||null==(s=t.lighthouseResult)?void 0:s.audits))return[];let a=e.results.lighthouseResult.audits,r=[];return Object.entries(a).forEach(e=>{let[s,t]=e;if("number"!=typeof t.score||t.score>=1)return;let a="info";t.score<.5?a="error":t.score<.7?a="warning":t.score<.9&&(a="minor"),r.push({id:t.id||s,severity:a,title:t.title||s,description:t.description||t.explanation||"No description available",score:t.score,scoreDisplayMode:t.scoreDisplayMode,displayValue:t.displayValue,explanation:t.explanation,errorMessage:t.errorMessage,warnings:t.warnings,details:t.details,savings:t.displayValue})}),r})(e),screenshot:null==e||null==(o=e.results)||null==(l=o.lighthouseResult)||null==(i=l.audits)||null==(n=i["final-screenshot"])||null==(r=n.details)?void 0:r.data,timestamp:Date.now(),publishedCommitSha:a}:null})(await e.post("/projects/".concat(s,"/preview-page-speed"),{url_source:"publish",strategy:t,categories:[a]}),t,a,i)},staleTime:9e5*!r,gcTime:36e5,enabled:!!s&&n}}},N=e=>{let{label:s,score:t,issueCount:r=0,isSelected:n=!1,isLoading:i=!1,onClick:o,onRun:d,onForceRefresh:u}=e;return(0,a.jsxs)("div",{className:(0,m.cn)("group relative flex cursor-pointer flex-col gap-2 rounded-xl border bg-muted p-4 transition-colors",n&&"border-accent-primary/50",void 0===t&&"hover:bg-muted/80"),onClick:void 0===t?d:o,children:[void 0!==t&&u&&(0,a.jsx)(l.$,{size:"sm",variant:"ghost",className:"absolute right-1 top-1 h-6 w-6 p-0 opacity-0 transition-opacity group-hover:opacity-60 hover:!opacity-100",onClick:e=>{e.stopPropagation(),u()},disabled:i,title:"Force refresh",children:(0,a.jsx)(c.A,{name:"refresh",size:"small"})}),(0,a.jsx)("p",{className:(0,m.cn)("text-sm font-medium group-hover:text-accent-primary",n&&"text-accent-primary"),children:s}),(0,a.jsx)("div",{className:"flex items-center justify-between gap-2",children:void 0!==t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:(0,m.cn)("h-5 font-medium","text-foreground"),children:"".concat(Math.round(t),"%")}),r>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground",children:[(0,a.jsx)(c.A,{name:"warning",size:"small"}),(0,a.jsx)("p",{className:"text-xs font-medium",children:r})]})]}):(0,a.jsx)("div",{className:"flex items-center gap-2 text-muted-foreground",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-3 w-3 animate-spin rounded-full border-2 border-current border-t-transparent"}),(0,a.jsx)("span",{className:"text-xs",children:"Analyzing..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{name:"schedule",size:"small"}),(0,a.jsx)("span",{className:"text-xs",children:"Click to analyze"})]})})})]})};var C=t(22803),k=t(98213),_=t(90820),S=t(54225),I=t(9070),E=t(82594),A=t(69147),P=t(14026),D=t(87409);let T=new Map,L=e=>{let{audit:s,strategy:t,category:i}=e,{handleFix:o,isFixing:c,hasBeenAttempted:u,isPending:m,isChatRequestPending:h}=((e,s,t)=>{let a=(0,E.B)(),[i,l]=(0,n.useState)(!1),{closeSettings:o}=(0,I.t)(),c=(0,n.useRef)(null),{hasBeenAttempted:u,markAsAttempted:m}=(e=>{let[s,t]=(0,n.useState)(()=>T.has(e));return(0,n.useEffect)(()=>{t(T.has(e))},[e]),{hasBeenAttempted:s,markAsAttempted:(0,n.useCallback)(e=>{T.set(e,Date.now()),t(!0)},[])}})(e.id),{onClick:h,isPending:x}=(0,D.Ue)({projectId:a,errors:[{id:(0,_.g_)(),type:P.B.BUILD,error_message:"SEO Audit Issue (".concat(e.severity,"): ").concat(e.title,"\n\nDescription: ").concat(e.description).concat(e.explanation&&e.explanation!==e.description?"\n\nExplanation: ".concat(e.explanation):"").concat(void 0!==e.score?"\n\nCurrent Score: ".concat(e.score):"").concat(e.savings?"\n\nEstimated savings: ".concat(e.savings):"").concat(e.errorMessage?"\n\nError: ".concat(e.errorMessage):"").concat(e.details?"\n\nAdditional Details: ".concat(JSON.stringify(e.details,null,2)):"","\n\nIMPORTANT INSTRUCTIONS FOR FIXING THIS SEO ISSUE:\n- STRICTLY preserve the existing functional behavior, design, and UX of the application\n- ONLY make changes that are absolutely necessary to fix this specific SEO issue\n- DO NOT modify the application's visual design, layout, or user experience unless it's essential for the SEO fix\n- If the audit requires changes that might affect functionality or UX, be extremely cautious and make minimal changes\n- If you cannot clearly determine how to fix this issue safely without risking application functionality, simply provide the analysis in chat mode instead of making code changes\n- Focus on technical SEO fixes like meta tags, HTML structure, accessibility attributes, etc. that don't affect the user experience\n\nPlease analyze this SEO issue and implement only the minimal necessary changes to improve the website's SEO performance without affecting the application's functionality or user experience."),occurred_at:new Date().toISOString(),created_at:C.Dc.now()}]}),p=(0,S.wV)(e=>e.isSendChatMessageMutationPending);return(0,n.useEffect)(()=>()=>{c.current&&clearTimeout(c.current)},[]),{handleFix:(0,n.useCallback)(async()=>{if(!i&&!u&&!x&&!p)try{l(!0),m(e.id),r.Ay.capture(d.iK.TRY_FIX,{strategy:s,category:t,auditId:e.id,auditSeverity:e.severity,auditTitle:e.title}),h(),k.toast.success("SEO fix attempt initiated successfully"),c.current=setTimeout(()=>{l(!1),o()},3e3)}catch(e){A.logging.error("Failed to initiate SEO fix:",{error:e}),k.toast.error("Failed to initiate SEO fix. Please try again."),l(!1)}},[h,i,u,x,p,m,s,t,e.id,e.severity,e.title,o]),isFixing:i,hasBeenAttempted:u,isPending:x,isChatRequestPending:p}})(s,t,i),x=(0,n.useCallback)(async()=>{await o()},[o]);return(0,a.jsx)(l.$,{onClick:x,disabled:c||u||m||h,variant:u?"outline":"default",size:"sm",className:"text-xs",children:c||m?"Fixing...":u?"Fix attempted":"Try to fix"})},z=e=>{let{audit:s,strategy:t,category:r}=e;return(0,a.jsx)("div",{className:"rounded-lg border bg-muted p-4",children:(0,a.jsxs)("div",{className:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-0",children:[(0,a.jsxs)("div",{className:"flex w-full flex-1 flex-col items-start gap-3 md:flex-row md:gap-0",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(c.A,{name:(e=>{switch(e){case"error":return"error";case"warning":return"warning";case"info":default:return"info";case"minor":return"help"}})(s.severity),size:"small",className:"mt-1 text-muted-foreground"})}),(0,a.jsxs)("div",{className:"w-full flex-1 md:ml-3",children:[(0,a.jsx)("h5",{className:"font-medium text-foreground",children:s.title}),(0,a.jsxs)("p",{className:"mt-1 w-full break-words text-sm text-muted-foreground",children:[s.description,s.savings&&(0,a.jsxs)("span",{children:[" Est. savings: ",s.savings]})]})]})]}),(0,a.jsx)("div",{className:"flex-shrink-0 md:ml-4",children:(0,a.jsx)(L,{audit:s,strategy:t,category:r})})]})})};var R=t(2418);let O=e=>{let{screenshotData:s}=e;return s?(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h4",{className:"mb-4 text-base font-medium",children:"Page Screenshot"}),(0,a.jsx)("div",{className:"float-left",children:(0,a.jsx)("div",{className:"relative inline-block max-w-full overflow-hidden rounded-lg border shadow-sm",children:(0,a.jsx)(R.default,{src:s,alt:"Page screenshot",width:0,height:0,sizes:"100vw",style:{width:"auto",height:"auto",maxHeight:"400px",maxWidth:"100%"},className:"block",unoptimized:!0})})}),(0,a.jsx)("div",{className:"clear-both"})]}):null},F=e=>{var s;let{isProjectPublished:t,strategy:r,selectedCategory:i,categories:o,scores:d,allData:u,selectedData:m,filteredAndSortedAudits:h,isSelectedCategoryLoading:p,hasError:g,scoresError:j,selectedError:f,scoresLoading:v,refreshingCategories:b,onCategorySelect:w,onRunAnalysis:C,onForceRefresh:k,project:_}=e,[S,I]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{I(!1)},[i]),t)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-6 grid grid-cols-2 gap-4 md:grid-cols-4",children:o.map(e=>{let s,t,n=(e=>{let s=d.find(s=>s.category===e);return null==s?void 0:s.score})(e.key),l=(s=e.key,u.some(e=>e.category===s)),o=(t=e.key,v||b.has(t));return(0,a.jsx)(N,{label:e.label,score:n,isSelected:i===e.key,isLoading:o,onClick:()=>w(e.key),onRun:l?void 0:()=>C(e.key),onForceRefresh:()=>k(e.key)},"".concat(r,"-").concat(e.key))})}),g&&(0,a.jsxs)("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-red-700",children:(null==(s=j||f)?void 0:s.message)||"Failed to fetch page speed data"})]}),p&&(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(x.y,{size:"large"}),(0,a.jsxs)("p",{className:"text-lg text-muted-foreground",children:["Loading ",i," data for ",r,"..."]})]})}),m&&!p&&(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("h4",{className:"mb-4 text-base font-medium",children:[m.score.label," Issues",(()=>{let e=y(h).length;return e>0&&(0,a.jsx)("div",{className:"ml-2 inline-block",children:(0,a.jsx)("div",{className:"inline-flex h-5 flex-col items-center justify-center gap-2.5 rounded bg-warning px-2 py-1",children:(0,a.jsxs)("div",{className:"justify-start text-xs font-medium leading-3 text-warning-primary",children:[e," ",1===e?"issue":"issues"]})})})})()]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(S?y(h):y(h).slice(0,3)).map((e,s)=>(0,a.jsx)(z,{audit:e,strategy:r,category:i},"".concat(e.id,"-").concat(s))),(()=>{let e=y(h);return e.length>3&&(0,a.jsx)("div",{className:"pt-4 text-center",children:(0,a.jsx)(l.$,{variant:"outline",onClick:()=>I(!S),className:"gap-2",children:S?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{name:"chevron_right",size:"small",className:"-rotate-90"}),"Show Less"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{name:"chevron_right",size:"small",className:"rotate-90"}),"Show More (",e.length-3," more)"]})})})})(),0===y(h).length&&(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-1 text-lg font-medium text-foreground",children:"No Issues Found!"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[m.score.label," category is performing excellently. Great job!"]})]})})})]})]}),m.screenshot&&"performance"===i&&(0,a.jsx)(O,{screenshotData:m.screenshot})]}),!m&&!p&&!g&&(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"mb-4 text-muted-foreground",children:["Click on a category above to analyze your project's ",i," performance"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Analysis results are cached for each strategy and category combination"})]})})]}):(0,a.jsxs)("div",{className:"flex w-full flex-1 flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,a.jsx)(c.A,{name:"trending_up",size:"large"}),(0,a.jsx)("p",{className:"text-center text-base md:text-sm",children:"To view page speed analysis, you first need to publish your project."})]})},M=e=>{var s;let{project:t}=e,[i,u]=(0,n.useState)("desktop"),[h,x]=(0,n.useState)("performance"),[j,v]=(0,n.useState)(new Set),y=!!(null==t?void 0:t.url),b=null==t||null==(s=t.published_deployment)?void 0:s.commit_sha,{scores:N,data:C,isLoading:k,error:_,runAnalysis:S,forceRefresh:I}=(e=>{let{projectId:s,strategy:t,isPublished:a,publishedCommitSha:r}=e,{data:i,isLoading:l,error:o,runAnalysis:c,forceRefresh:d}=(e=>{var s;let{projectId:t,combinations:a,isPublished:r,publishedCommitSha:i}=e,l=(0,g.E)({queries:a.map(e=>{let{strategy:s,category:a}=e;return w.combination({projectId:t,strategy:s,category:a,isPublished:r,publishedCommitSha:i})})}),o=l.map(e=>e.data).filter(Boolean),c=l.some(e=>e.isLoading),d=null==(s=l.find(e=>e.error))?void 0:s.error;return{data:o,isLoading:c,error:d,runAnalysis:(0,n.useCallback)(async(e,s)=>{let t=a.findIndex(t=>t.strategy===e&&t.category===s);if(-1!==t)return l[t].refetch()},[l,a]),forceRefresh:(0,n.useCallback)(async(e,s)=>{let t=a.findIndex(t=>t.strategy===e&&t.category===s);if(-1!==t)return l[t].refetch()},[l,a]),queries:l}})({projectId:s,combinations:["performance","accessibility","best-practices","seo"].map(e=>({strategy:t,category:e})),isPublished:a,publishedCommitSha:r});return{scores:i.map(e=>e.score),data:i,isLoading:l,error:o,runAnalysis:c,forceRefresh:d}})({projectId:t.id,strategy:i,isPublished:y,publishedCommitSha:b}),{data:E,isLoading:A,error:P,forceRefresh:D}=(e=>{var s;let{projectId:t,strategy:a,category:r,forceReload:i=!1,isPublished:l,publishedCommitSha:o}=e,c=(0,p.I)(w.combination({projectId:t,strategy:a,category:r,forceReload:i,isPublished:l,publishedCommitSha:o})),d=(0,n.useCallback)(async()=>c.refetch(),[c]),u=(0,n.useCallback)(async()=>c.refetch(),[c]);return{data:c.data,isLoading:c.isLoading,error:c.error,runAnalysis:d,forceRefresh:u,isStale:c.isStale,lastUpdated:null==(s=c.data)?void 0:s.timestamp}})({projectId:t.id,strategy:i,category:h,isPublished:y,publishedCommitSha:b}),T=(0,n.useMemo)(()=>(null==E?void 0:E.audits)?[...E.audits].sort((e,s)=>{let t=f[e.severity]-f[s.severity];return 0!==t?t:e.title.localeCompare(s.title)}):[],[null==E?void 0:E.audits]),L=e=>{u(e),r.Ay.capture(d.iK.STRATEGY_SELECTED,{strategy:e})},z=async e=>{v(s=>new Set([...s,e]));try{await S(i,e)}finally{v(s=>{let t=new Set(s);return t.delete(e),t})}},R=async e=>{v(s=>new Set([...s,e]));try{e===h&&await D(),await I(i,e)}finally{v(s=>{let t=new Set(s);return t.delete(e),t})}},O=async()=>{let e=["performance","accessibility","best-practices","seo"];r.Ay.capture(d.iK.REGENERATE,{strategy:i,categories:e,context:"all"}),v(new Set(e));try{await Promise.all(e.map(e=>I(i,e))),e.includes(h)&&await D()}finally{v(new Set)}},M=k||A||j.size>0,B=A||j.has(h),$=!!(_||P),W=(()=>{if(0!==C.length)return Math.max(...C.map(e=>e.timestamp||0))})(),G=()=>{var e;return!!(null==E?void 0:E.publishedCommitSha)&&!!b&&((null==t?void 0:t.latest_commit_sha)!==(null==t||null==(e=t.published_deployment)?void 0:e.commit_sha)||E.publishedCommitSha!==b)};return(0,a.jsx)(U,{description:"Check data for the most recent published version of your project",descriptionAction:(0,a.jsxs)("div",{className:"flex items-center gap-5 md:-mt-1.5",children:[(0,a.jsx)(o.Q,{showTooltip:G(),tooltipContent:(()=>{var e;return(null==t?void 0:t.latest_commit_sha)!==(null==t||null==(e=t.published_deployment)?void 0:e.commit_sha)?"You have unpublished changes":(null==E?void 0:E.publishedCommitSha)!==b?"Analysis from a previous published version":"Analysis data may be outdated"})(),side:"bottom",align:"center",instant:!0,children:(0,a.jsxs)("button",{className:(0,m.cn)("inline-flex min-h-8 items-center rounded-md border px-3 py-1 text-sm font-medium shadow-sm transition-colors",(e=>!e||Math.floor((Date.now()-e)/36e5)>=24)(W)||G()?"bg-warning text-warning-primary hover:bg-warning/80":"bg-muted text-foreground hover:bg-muted/80"),onClick:O,disabled:M,children:[M?(0,a.jsx)("div",{className:"mr-1.5 size-2 animate-pulse rounded-full bg-current"}):(0,a.jsx)(c.A,{name:"refresh",size:"small",className:"mr-1.5 h-4 w-4"}),M?"Updating...":(e=>{if(!e)return"Never updated";let s=Math.floor((Date.now()-e)/6e4);if(s<1)return"Updated just now";if(s<60)return"Updated ".concat(s,"m ago");let t=Math.floor(s/60);if(t<24)return"Updated ".concat(t,"h ago");let a=Math.floor(t/24);return"Updated ".concat(a,"d ago")})(W)]})}),(0,a.jsxs)("div",{className:"flex h-8 items-center rounded-md border bg-background p-0.5 shadow-sm",children:[(0,a.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>L("desktop"),className:(0,m.cn)("h-7 rounded-sm px-3 py-1 text-sm","desktop"===i?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground"),children:"Desktop"}),(0,a.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>L("mobile"),className:(0,m.cn)("h-7 rounded-sm px-3 py-1 text-sm","mobile"===i?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground"),children:"Mobile"})]})]}),children:(0,a.jsx)(F,{isProjectPublished:y,strategy:i,selectedCategory:h,categories:[{key:"performance",label:"Performance"},{key:"accessibility",label:"Accessibility"},{key:"best-practices",label:"Best Practices"},{key:"seo",label:"SEO"}],scores:N,allData:C,selectedData:E||null,filteredAndSortedAudits:T,isSelectedCategoryLoading:B,hasError:$,scoresError:_,selectedError:P,scoresLoading:k,refreshingCategories:j,onCategorySelect:e=>{x(e),r.Ay.capture(d.iK.CATEGORY_SELECTED,{category:e,strategy:i})},onRunAnalysis:z,onForceRefresh:R,project:t,isAnalysisOutdated:G()})})},U=e=>{let{children:s,description:t,descriptionAction:r}=e;return(0,u.Li)()?(0,a.jsx)(h,{description:t,descriptionAction:r,children:s}):(0,a.jsx)(i.Pt,{title:"Page Speed",value:"page_speed",description:t,descriptionAction:r,children:s})}},53012:(e,s,t)=>{t.d(s,{z:()=>n});var a=t(99289),r=t(95358);let n=e=>{let{scenario:s,className:t="cursor-pointer text-sm text-muted-foreground underline transition-opacity duration-150 ease-in-out hover:opacity-75",children:n="Upgrade your plan"}=e,i=(0,r.BK)();return(0,a.jsx)("span",{onClick:()=>{i(s)},className:t,children:n})}},54931:(e,s,t)=>{t.d(s,{v:()=>n});var a=t(23719),r=t(9915);let n=e=>{let s=(0,r.R)(),t=(0,a.mg)({projectId:e||""});return{isChatRequestDisabled:s||t.isPending,disabledReason:s?"Wait for Lovable to finish working":null,isPending:t.isPending}}},58036:(e,s,t)=>{t.d(s,{A0:()=>l,BF:()=>o,Hj:()=>c,XI:()=>i,nA:()=>u,nd:()=>d});var a=t(99289),r=t(11405),n=t(26551);let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,n.cn)("w-full caption-bottom text-sm",t),...r})})});i.displayName="Table";let l=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:(0,n.cn)("[&_tr]:border-b",t),...r})});l.displayName="TableHeader";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,n.cn)("[&_tr:last-child]:border-0",t),...r})});o.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:(0,n.cn)("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",t),...r})});c.displayName="TableRow";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:(0,n.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})});d.displayName="TableHead";let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:(0,n.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})});u.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption"},58873:(e,s,t)=>{t.d(s,{s:()=>d});var a=t(99289),r=t(6919),n=t(11405),i=t(98213),l=t(49944),o=t(6072),c=t(33256);let d=e=>{let{projectId:s,disabled:t}=e,[d,u]=(0,n.useState)(!1),m=()=>u(!1),h=(0,r.n)({mutationFn:()=>(0,c.P)().post("/projects/".concat(s,"/supabase/disconnect")),onSuccess:()=>{(0,i.toast)("Supabase disconnected",{description:"You can connect to a new Supabase project later."}),m()},onError:e=>{i.toast.error("Error",{description:e.message})}});return(0,a.jsxs)(o.lG,{open:d,onOpenChange:u,children:[(0,a.jsx)(o.zM,{asChild:!0,children:(0,a.jsx)(l.$,{variant:"outline",size:"sm",disabled:t,children:"Disconnect"})}),(0,a.jsxs)(o.Cf,{size:"sm",children:[(0,a.jsxs)(o.c7,{children:[(0,a.jsx)(o.L3,{children:"Disconnect Supabase"}),(0,a.jsx)(o.rr,{children:"Are you sure you want to disconnect Supabase?"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"We will stop deploying edge functions and reading your database schema, but no changes will be made to your code. You can reconnect to Supabase later."}),(0,a.jsxs)(o.Es,{children:[(0,a.jsx)(l.$,{variant:"outline",onClick:m,children:"Cancel"}),(0,a.jsx)(l.$,{variant:"destructive",onClick:()=>{h.mutate()},loading:h.isPending,children:"Disconnect"})]})]})]})}},59319:(e,s,t)=>{t.d(s,{T:()=>i});var a=t(99289),r=t(99017),n=t(11405);let i=e=>{let[s,t]=(0,n.useState)(!1),i=(0,n.useRef)(void 0),l=(0,n.useCallback)(e=>{e&&(clearTimeout(i.current),navigator.clipboard.writeText(e),t(!0),i.current=setTimeout(()=>{t(!1)},1e3))},[]);return t=>{let{TriggerComponent:n,textToCopy:i,copiedFeedbackText:o="Copied!"}=t;return(0,a.jsx)(r.Bc,{children:(0,a.jsxs)(r.m_,{open:s,children:[(0,a.jsx)(r.k$,{onClick:s=>{(null==e||!e.altKey||s.altKey)&&i&&l(i)},asChild:!0,className:"hello",children:(0,a.jsx)(n,{})}),(0,a.jsx)(r.ZI,{children:(0,a.jsx)("p",{children:o})})]})})}}},61664:(e,s,t)=>{t.d(s,{default:()=>t4});var a=t(99289),r=t(11405),n=t(50471),i=t(37079),l=t(43328),o=t(23594),c=t(39627),d=t(67088),u=t(34363),m=t(33256),h=t(49944),x=t(5531),p=t(97757),g=t(67017);let j=()=>{let e=new Date,s=[];return s.push({label:"Last 24 hours",value:"24h",start:new Date(e.getTime()-864e5).toISOString(),end:e.toISOString()}),s.push({label:"Last 7 days",value:"7d",start:new Date(e.getTime()-6048e5).toISOString(),end:e.toISOString()}),s.push({label:"Last 30 days",value:"30d",start:new Date(e.getTime()-2592e6).toISOString(),end:e.toISOString()}),s},f=e=>{let{selectedPeriod:s,onPeriodChange:t}=e,r=(0,g.A)("md"),n=j();return(0,a.jsxs)(x.rI,{children:[(0,a.jsx)(x.ty,{asChild:!0,children:(0,a.jsxs)(h.$,{variant:"outline",className:"justify-between text-foreground md:min-w-32 md:px-3",size:r?"sm":"default",children:[s.label,(0,a.jsx)(p.A,{name:"chevron_right",size:"small",className:"rotate-90"})]})}),(0,a.jsx)(x.SQ,{align:"end",className:"min-w-32",children:n.map(e=>(0,a.jsx)(x._2,{onClick:()=>t(e),children:e.label},e.value))})]})};var v=t(83644),y=t(48661),b=t(8895),w=t(35663),N=t(25331),C=t(20717),k=t(15377),_=t(1596),S=t(44358),I=t(49095),E=t(42132),A=t(84751),P=t(27868),D=t(38922),T=t(11001),L=t(44794),z=t(9396);let R=e=>{let{active:s,payload:t,label:r}=e;return s&&t&&t.length?(0,a.jsxs)("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[(0,a.jsx)("p",{className:"mb-2 font-medium text-foreground",children:r}),(0,a.jsx)("div",{className:"space-y-1",children:t.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-sm",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:e.dataKey})]}),(0,a.jsx)("span",{className:"text-sm font-medium text-foreground",children:e.value})]},s))})]}):null},O=e=>{let{data:s,isLoading:t,granularity:n="day"}=e,{chartData:i,chartConfig:l}=(0,r.useMemo)(()=>{if(!s||0===s.length)return{chartData:[],chartConfig:{}};let e=new Set,t=null,a=null,r={};return(s.forEach(s=>{try{var i;let l=null==(i=s.timestamp)?void 0:i.trim();if(!l)return;let o=(0,v.H)(l);if(isNaN(o.getTime()))return;(!t||o<t)&&(t=o),(!a||o>a)&&(a=o);let c=("minute"===n?(0,y.c)(o):"hour"===n?(0,b.Q)(o):(0,w.o)(o)).toISOString(),d=s.model||"Unknown";e.add(d),r[c]||(r[c]={}),r[c][d]=(r[c][d]||0)+(s.count||1)}catch(e){}}),t&&a)?{chartData:("minute"===n?(0,N.G)({start:(0,y.c)(t),end:(0,y.c)(a)}):"hour"===n?(0,C.w)({start:(0,b.Q)(t),end:(0,b.Q)(a)}):(0,k.k)({start:(0,w.o)(t),end:(0,w.o)(a)})).map(s=>{let t=s.toISOString(),a={timeKey:"minute"===n?(0,_.GP)(s,"HH:mm"):"hour"===n?(0,_.GP)(s,"MMM dd, HH:mm"):(0,_.GP)(s,"MMM dd")};return e.forEach(e=>{a[e]=0}),r[t]&&Object.entries(r[t]).forEach(e=>{let[s,t]=e;a[s]=t}),a}),chartConfig:(e=>{let s={};return e.forEach((e,t)=>{s[e]={label:e,color:(e=>"hsl(".concat(120+137.508*e%360/360*200,", ").concat(70+e%3*10,"%, ").concat(50+e%4*5,"%)"))(t)}}),s})(Array.from(e))}:{chartData:[],chartConfig:{}}},[s,n]);if(t)return(0,a.jsx)("div",{className:"flex h-80 w-full items-center justify-center",children:(0,a.jsx)(L.y,{})});if(0===i.length)return(0,a.jsx)("div",{className:"flex h-80 w-full items-center justify-center rounded-lg border border-dashed",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No AI Gateway usage data available for the selected period."})});let o=Object.keys(l);return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(z.at,{config:l,className:"h-80 w-full",children:(0,a.jsx)(S.u,{width:"100%",height:"100%",children:(0,a.jsxs)(I.E,{data:i,width:void 0,height:void 0,margin:{top:20,right:5,left:0,bottom:20},children:[(0,a.jsx)(E.d,{strokeDasharray:"3 3"}),(0,a.jsx)(A.W,{dataKey:"timeKey",tick:!1,axisLine:!1,tickLine:!1}),(0,a.jsx)(P.h,{axisLine:!1,tickLine:!1,tick:{fontSize:12},width:30}),(0,a.jsx)(z.II,{content:(0,a.jsx)(R,{})}),(0,a.jsx)(D.s,{}),o.map(e=>(0,a.jsx)(T.y,{dataKey:e,stackId:"models",fill:l[e].color,radius:[0,0,0,0]},e))]})})})})};var F=t(16161);let M=e=>{let{data:s,isLoading:t}=e,r=s.reduce((e,s)=>e+s.count,0);return(0,a.jsx)("div",{className:"rounded-lg border p-4",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Requests"}),t?(0,a.jsx)(F.E,{className:"h-8 w-20"}):(0,a.jsx)("p",{className:"text-3xl font-medium",children:r.toLocaleString()})]})})},U=e=>{let{project:s}=e,[t,n]=(0,r.useState)(j()[1]),i="24h"===t.value?"hour":"day",{data:l}=(0,d.c)({projectId:s.id}),{data:o,isLoading:h}=(e=>{let{projectId:s,start:t,end:a,enabled:r=!0}=e;return(0,u.I)({queryKey:["projects",s,"integrations","ai_gateway","usage",{start:t,end:a}],queryFn:async()=>{let e=(0,m.P)(),r=new URLSearchParams;t&&r.append("start",t),a&&r.append("end",a);let n=r.toString(),i="/projects/".concat(s,"/integrations/ai_gateway/usage").concat(n?"?".concat(n):"");return e.get(i)},enabled:r&&!!s})})({projectId:s.id,start:t.start,end:t.end});return(0,a.jsx)(c.Pt,{title:"AI Gateway",value:"ai_gateway",description:"Monitor your project's AI Gateway usage and performance.",docsLink:"https://docs.lovable.dev/features/ai-gateway",children:(0,a.jsxs)("div",{className:"flex w-full flex-col gap-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-5",children:[(0,a.jsx)("p",{className:"font-medium",children:"AI Gateway Status"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border border-border p-4",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-full ".concat((null==l?void 0:l.is_used)?"bg-green-500":"bg-gray-400")}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:["Status: ",(null==l?void 0:l.is_used)?"Active":"Not in use"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==l?void 0:l.is_used)?"Your project is using Lovable's AI Gateway for secure API communication.":"Your project is not currently using the AI Gateway. Lovable will automatically activate it when you implement a feature that uses AI."})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium",children:"Usage Statistics"}),(0,a.jsx)(f,{selectedPeriod:t,onPeriodChange:n})]}),(0,a.jsx)(M,{data:o||[],isLoading:h})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-5",children:(0,a.jsx)(O,{data:o||[],isLoading:h,granularity:i})})]})})};var B=t(98743),$=t(545),W=t(8467),G=t.n(W),K=t(19550),q=t.n(K),V=t(81797),H=t(98213),Y=t(40177),Q=t(77809),Z=t(31126);let J=e=>{let{projectWorkspace:s,canEdit:t}=e;return s&&t?(0,a.jsx)(Z.M,{workspace:s,requiredPlanCategory:"pro"}):null};var X=t(95358),ee=t(65746),es=t(53012),et=t(69147),ea=t(15207),er=t(97115),en=t(71569),ei=t(96772),el=t(16457),eo=t(79312),ec=t(73728);let ed="You don't have permission to manage domains for this project.",eu=e=>{let{project:s}=e,{permissions:t}=(0,o.S)(),n=t.includes(eo.eZ.EditProject),l=t.includes(eo.eZ.ManageProjectDomains),{isAuthenticated:c}=(0,i.Z2)(),{data:d,refetch:x}=(0,u.I)(en.z.domains({projectId:s.id,enabled:c})),g=(0,ec.B5)(e=>e.projectWorkspace),[j,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{let e=(0,m.P)();f(await e.get("/entri/token"))})(),G().load()},[]);let v=(0,X.BK)(),y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n)return void H.toast.error(ed);if("free"===(null==g?void 0:g.plan))return void v(X.KU.PRO_DOMAIN_CONNECT);if(!(null==s?void 0:s.url)){let e=(0,m.P)();try{let t=await e.post("/projects/".concat(null==s?void 0:s.id,"/deployments"),{});(null==t?void 0:t.deployment_id)&&await (0,el.o)({projectId:null==s?void 0:s.id,deploymentId:t.deployment_id})}catch(e){et.logging.error("Error publishing project",e),H.toast.error("Error when publishing your project",{description:e.message}),$.Cp(e)}}if(null===j)return;let a={...j,dnsRecords:(e=>{let s="development"===e?"185.158.133.10":"185.158.133.1";return{domain:[{type:"A",host:"@",value:s,ttl:300},{type:"A",host:"www",value:s,ttl:300}],subDomain:[{type:"A",host:"{SUBDOMAIN}",value:s,ttl:300}]}})("production"),userId:null==s?void 0:s.id,monitor:!0,sellVersion:"v3",whiteLabel:{customCopy:{initialScreen:{title:{en:"Use your domain with Lovable"}}},theme:{primary:"#000000",secondary:"#000000",onSecondary:"#FFFFFF",headerBackground:"#000000"},logo:"https://lovable.dev/apple-icon.png",sell:{partnerName:"Lovable",partnerLogo:"https://lovable.dev/img/lovable-logo-text-nav.png",partnerUrl:"https://lovable.dev",overlayScreenHeight:"75%",flowTarget:"_blank"}}};try{"buy"===e?(a.prefilledDomain=(null==s?void 0:s.name)+".com",G().purchaseDomain(a)):G().showEntri(a)}catch(s){if(!t){let s=(0,m.P)();f(await s.get("/entri/token")),y(e,!0)}}V.Ay.capture("domain_connecting_attempt",{mode:e})},b=async e=>{if(e.detail.success){let t=H.toast.success("Connecting domain...",{description:"Hold on while we were mapping ".concat(e.detail.domain," to your project.")});try{let t=(0,m.P)();await t.post("/projects/".concat(null==s?void 0:s.id,"/domains"),{domain:e.detail.domain}),x(),H.toast.success("Domain connected!",{description:"The domain ".concat(e.detail.domain," is now mapped to your project. It might take a few minutes to propagate.")}),V.Ay.capture("domain_connected",{mode:"purchase"===e.detail.setupType?"buy":"connect"})}catch(e){H.toast.info("Domain not connected",{description:"There was an error while connecting your domain. Please try again."}),$.Cp(e)}H.toast.dismiss(t)}};(0,r.useEffect)(()=>(window.addEventListener("onEntriClose",b,!1),()=>{window.removeEventListener("onEntriClose",b)}),[]);let w=(0,Y.Tp)(ea.x.CustomDomainsBuy),{isPaidPlan:N}=(0,er.cb)(null==g?void 0:g.plan);return(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)(ee.m,{label:"Connected Domains",description:"View or remove domains linked to your project.",justify:"end",children:(0,a.jsxs)("ul",{className:"flex flex-col gap-2",children:[(null==s?void 0:s.url)?(0,a.jsx)(Q.A,{showRemove:!1,showIcon:!0,domain:{domain:(0,ei.b)(null==s?void 0:s.url),status:"active"}}):(0,a.jsx)("li",{className:"flex items-center",children:(0,a.jsxs)("span",{className:"flex-grow text-sm text-muted-foreground",title:"You have to publish your project for this domain to work",children:[null==s?void 0:s.name,".lovable.app"]})}),null==d?void 0:d.map((e,s)=>(0,a.jsx)(Q.A,{domain:e,showRemove:l,showIcon:!0,refetchDomains:x},s))]})}),(0,a.jsx)(ee.m,{label:"Add Existing Domain",description:l?N?"Connect a domain you already own.":(0,a.jsxs)("p",{children:[(0,a.jsx)(es.z,{scenario:X.KU.PRO_DOMAIN_CONNECT})," to connect a domain you already own."]}):ed,mobileLayout:"horizontal",justify:"end",customBadge:(0,a.jsx)(J,{projectWorkspace:g,canEdit:l}),children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",type:"button",onClick:()=>y("connect"),className:"whitespace-nowrap",disabled:!l,children:d&&0===d.length?"Connect Domain":"Connect Another Domain"})}),w&&(0,a.jsx)(ee.m,{label:"Purchase New Domain",description:l?N?"Buy a new domain through Ionos.":(0,a.jsxs)("p",{children:[(0,a.jsx)(es.z,{scenario:X.KU.PRO_DOMAIN_CONNECT})," to buy a new domain through Ionos."]}):ed,mobileLayout:"horizontal",justify:"end",customBadge:(0,a.jsx)(J,{projectWorkspace:g,canEdit:l}),children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",type:"button",onClick:()=>y("buy"),className:"whitespace-nowrap",disabled:!l,children:"Buy Domain"})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",type:"button",asChild:!0,children:(0,a.jsxs)(q(),{href:"https://docs.lovable.dev/features/custom-domain#custom-domain",target:"_blank",children:["How Domains Work ",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})})})]})};var em=t(48714),eh=t(24159),ex=t(26551),ep=t(9563);let eg=()=>{let[e,s]=(0,r.useState)(""),t=(0,ep.Iw)(e=>e.project);(0,r.useEffect)(()=>{(null==t?void 0:t.custom_instructions)&&s(t.custom_instructions)},[t]);let{updateProject:n}=(0,ep.Om)(),i=async()=>{try{n({custom_instructions:e},{onSuccess:()=>{V.Ay.capture(eh.$6.KNOWLEDGE.SAVED),H.toast.success("Custom instructions updated",{description:"Your custom instructions have been saved successfully."})}}),o(!1)}catch(e){H.toast.error("Error",{description:"Failed to update custom instructions. Please try again."})}},[l,o]=(0,r.useState)(!1),c=e.length,d=c>1e5;return(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"mb-2 flex flex-col gap-2",children:[(0,a.jsx)("p",{className:"text-base font-medium",children:"Instructions & Guidelines"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Provide guidelines and context to improve your project’s edits. Use this space to:"}),(0,a.jsxs)("ul",{className:"list-disc pl-6 text-sm text-muted-foreground",children:[(0,a.jsx)("li",{children:"Set project-specific rules or best practices."}),(0,a.jsx)("li",{children:"Set coding style preferences (e.g. indentation, naming conventions)."}),(0,a.jsx)("li",{children:"Include external documentation or style guides."})]})]}),(0,a.jsx)(em.T,{value:e,onChange:e=>{s(e.target.value),e.target.value!==(null==t?void 0:t.custom_instructions)?o(!0):o(!1)},placeholder:"Enter your instructions here...",className:(0,ex.cn)("resize-none"),rows:14}),(0,a.jsx)("div",{className:(0,ex.cn)("flex justify-end",l&&"mb-12"),children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",type:"button",asChild:!0,children:(0,a.jsxs)(q(),{href:"https://docs.lovable.dev/features/knowledge",target:"_blank",children:["Get Inspiration ",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})})}),l&&(0,a.jsxs)(ee.E,{className:"justify-end gap-3",children:[d&&(0,a.jsxs)("div",{className:"mr-auto text-sm text-destructive-foreground",children:["Message is too long. Exceeded by ",c-1e5," characters."]}),(0,a.jsx)(h.$,{variant:"outline",onClick:()=>{s((null==t?void 0:t.custom_instructions)||""),o(!1)},children:"Cancel"}),(0,a.jsx)(h.$,{onClick:i,variant:"affirmative",disabled:d,children:"Save"})]})]})};var ej=t(52959),ef=t(51252),ev=t(82176);let ey=e=>{let{project:s,onCategoryChange:t,disabled:r=!1}=e;return(0,a.jsx)(ee.m,{label:"Project Category",description:"Categorize your project to help others find it.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsxs)(ev.l6,{defaultValue:(null==s?void 0:s.category)||"",onValueChange:e=>{t(e)},disabled:r,children:[(0,a.jsx)(ev.bq,{className:"w-[180px]",children:(0,a.jsx)(ev.yv,{placeholder:"Select category"})}),(0,a.jsxs)(ev.gC,{children:[(0,a.jsx)(ev.eb,{value:"internal_tools",children:"Internal Tools"}),(0,a.jsx)(ev.eb,{value:"website",children:"Website"}),(0,a.jsx)(ev.eb,{value:"personal",children:"Personal"}),(0,a.jsx)(ev.eb,{value:"consumer_app",children:"Consumer App"}),(0,a.jsx)(ev.eb,{value:"b2b_app",children:"B2B App"}),(0,a.jsx)(ev.eb,{value:"prototype",children:"Prototype"})]})]})})};var eb=t(13236),ew=t(4141);let eN={Title:e=>{let{title:s,description:t,className:r,...n}=e;return(0,a.jsxs)("div",{className:(0,ex.cn)("flex flex-col",r),...n,children:[(0,a.jsx)("h2",{children:s}),t&&(0,a.jsx)("p",{className:"text-muted-foreground",children:t})]})},Entry:e=>{let{label:s,value:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-1 text-sm",children:[(0,a.jsx)("p",{className:"font-medium",children:s}),"string"==typeof t?(0,a.jsx)("p",{className:"text-muted-foreground",children:t}):t]})},Separator:ew.Separator};var eC=t(87179),ek=t(84923),e_=t(53090),eS=t(9562),eI=t(90352),eE=t(51917),eA=t(34958),eP=t(273),eD=t(9915),eT=t(71305),eL=t(12987),ez=t(83332);let eR=e=>{var s;let{isPaidUser:t,className:n}=e,{setBadgeVisibility:i}=(0,ep.Om)(),l=(0,ep.Iw)(e=>e.project),o=(0,X.BK)(),[c,d]=(0,r.useState)(null!=(s=null==l?void 0:l.hide_badge)&&s);return(0,a.jsx)(eI.d,{checked:c,onCheckedChange:e=>{if(!t)return void o(X.KU.PRO_HIDE_BADGE);i(e),d(e)},disabled:!1,className:(0,ex.cn)("",n)})};var eO=t(6919),eF=t(34936);let eM=e=>{let{projectId:s,initialFeatured:t,className:n}=e,[i,l]=(0,r.useState)(t),o=(0,eO.n)({mutationFn:e=>{let{featured:t}=e;return(0,m.P)().put("/projects/".concat(s,"/featured"),{featured:t})},onSuccess:(e,s)=>{let{featured:t}=s;l(t),H.toast.success("Featured status updated",{description:"Project is now ".concat(t?"featured":"not featured",".")})},onError:e=>{(0,eF.Ni)(e)}});return(0,a.jsx)(eI.d,{disabled:o.isPending,checked:i,onCheckedChange:e=>{o.mutate({featured:e})},className:(0,ex.cn)("",n)})},eU=e=>{var s,t,n,i,l;let{project:c}=e,{permitted:d}=(0,o.J)(eo.eZ.EditProject),{permitted:u}=(0,o.J)(eo.eZ.DeleteProject),{permitted:m}=(0,o.J)(eo.eZ.DeployProject),[x,p]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),f=(0,eD.R)(),v=(0,ec.B5)(e=>e.projectWorkspace),y=(0,ec.B5)(e=>{var s;return(null==(s=e.projectWorkspace)?void 0:s.plan)||null}),b=c.id,w=(0,eA.WW)(),{isRemixable:N,isLovableCloudEnabled:C,isSupabaseEnabled:k}=(0,eb.I)(c),S=d||N,{updateProject:I,setIsRemixDialogOpen:E}=(0,ep.Om)(),A=(0,ef.jE)(),{isBizOrEnterprisePlan:P}=(0,er.cb)(y),D=(0,X.BK)(),{showUnpublishDialog:T,closeDialog:L}=(0,eT.S)(),{handleUnpublish:z,unpublishMutation:R}=(0,eL.N)({projectId:null==c?void 0:c.id,onUnpublishComplete:()=>{L()}}),O=async e=>P?(null==c?void 0:c.visibility)==="draft"&&e?void H.toast.error("Personal projects cannot be used as templates",{description:"Change the project visibility to Public or Workspace to use it as a template."}):void I({is_template:e},{onSuccess:()=>{A.invalidateQueries({queryKey:eP.workspaceKeys.templates((null==v?void 0:v.id)||"")})}}):void D(X.KU.BIZ_TEMPLATES),F=(null==c?void 0:c.is_analytics_disabled)||!1,M=(null==v?void 0:v.share_sample_data_with_llms)===!1,U=!M&&(null==(l=null==c?void 0:c.share_sample_data_with_llms)||l),B=async e=>{M||I({share_sample_data_with_llms:e})},$=async e=>{I({is_analytics_disabled:e},{onSuccess:()=>{(0,el.o)({projectId:b}).catch(e=>{et.logging.error("Error updating deployment ID",e)})}})},{isPaidPlan:W}=(0,er.cb)(y);return(0,a.jsxs)("div",{className:"flex w-full flex-col gap-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-5",children:[(0,a.jsx)("p",{className:"col-span-full font-medium",children:"Overview"}),(0,a.jsx)(eN.Entry,{label:"Project name",value:null==c?void 0:c.name}),(0,a.jsx)(eN.Entry,{label:"Owner",value:(null==c?void 0:c.created_by)&&(0,a.jsx)(eE.f,{username:c.created_by,className:"break-words text-sm text-muted-foreground underline"})}),(0,a.jsx)(eN.Entry,{label:"Created at",value:(e=>(null==e?void 0:e.seconds)?(0,_.GP)(new Date(1e3*e.seconds),"yyyy-MM-dd HH:mm:ss"):void 0)(null==c?void 0:c.created_at)}),(null==c||null==(s=c.creation_options)?void 0:s.tech_stack)&&(0,a.jsx)(eN.Entry,{label:"Tech stack",value:null==c||null==(t=c.creation_options)?void 0:t.tech_stack}),(0,a.jsx)(eN.Entry,{label:"Messages count",value:(null==c||null==(n=c.user_message_count)?void 0:n.toString())||"0"}),(0,a.jsx)(eN.Entry,{label:"AI Edits count",value:(null==c||null==(i=c.edit_count)?void 0:i.toString())||"0"})]}),(0,a.jsx)(eN.Separator,{}),(0,a.jsx)(ee.m,{label:"Project Visibility",description:W?"Keep your project hidden and prevent others from remixing it.":(0,a.jsxs)("p",{children:[(0,a.jsx)(es.z,{scenario:X.KU.PRO_PRIVATE_PROJECT})," to keep your project hidden and prevent others from remixing it."]}),mobileLayout:"vertical",justify:"end",customBadge:v&&(0,a.jsx)(Z.M,{workspace:v,requiredPlanCategory:"pro"}),children:(0,a.jsx)(ez.B,{})}),c&&(0,a.jsx)(ey,{project:c,onCategoryChange:e=>I({category:e}),disabled:!d}),(0,a.jsx)(ee.m,{label:'Hide "Lovable" Badge',description:W?'Remove the "Edit with Lovable" badge from your published work.':(0,a.jsxs)("p",{children:[(0,a.jsx)(es.z,{scenario:X.KU.PRO_HIDE_BADGE}),' to remove the "Edit with Lovable" badge from your published work.']}),mobileLayout:"horizontal",justify:"end",customBadge:v&&(0,a.jsx)(Z.M,{workspace:v,requiredPlanCategory:"pro"}),children:(0,a.jsx)(eR,{isPaidUser:W})}),(0,a.jsx)(ee.m,{label:"Include Unprotected Database Samples in Security Scans",description:"Allow including sample data from unprotected database tables when analyzing security vulnerabilities. Workspace settings may override.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(eS.Q,{showTooltip:M,tooltipContent:"This is disabled at the workspace level.",children:(0,a.jsx)(eI.d,{checked:U,onCheckedChange:B,disabled:M||!d})})}),c&&w&&(0,a.jsx)(ee.m,{label:"Feature Project",description:"Highlight this project on the homepage.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(eM,{projectId:b,initialFeatured:!!c.featured})}),P&&(0,a.jsx)(ee.m,{label:"Use as a Template",description:(0,a.jsxs)("p",{children:["Use this project as a template in"," ",(0,a.jsx)("span",{className:"font-medium",children:(null==v?void 0:v.name)?v.name:"your workspace"})," ","to reference when starting new projects."]}),mobileLayout:"horizontal",justify:"end",customBadge:v&&(0,a.jsx)(Z.M,{workspace:v,requiredPlanCategory:"biz"}),children:(0,a.jsx)(eS.Q,{showTooltip:(null==c?void 0:c.visibility)==="draft",tooltipContent:"Change project visibility to Public or Workspace to use it as a template.",delayDuration:0,children:(0,a.jsx)(eI.d,{checked:(null==c?void 0:c.is_template)||!1,onCheckedChange:O,disabled:(null==c?void 0:c.visibility)==="draft"})})}),c&&d&&(0,a.jsx)(ee.m,{label:"Rename Project",description:"Update your project's title.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(h.$,{onClick:()=>p(!0),children:"Rename"})}),c&&(0,a.jsx)(ee.m,{label:"Remix Project",description:"Duplicate this app in a new project.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsxs)(h.$,{onClick:()=>E(!0),disabled:!S,children:["Remix",!S&&(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:k?"Unavailable for projects connected to Supabase":C?"Unavailable for projects connected to Lovable Cloud":"Unavailable"})]})}),(0,a.jsx)(ee.m,{label:"Transfer",description:"Move this project to a different workspace.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(eC.O,{projectId:b,currentWorkspaceId:null==c?void 0:c.workspace_id})}),c&&(0,a.jsx)(ee.m,{label:"Disable Analytics",description:"Disable collecting analytics data for this project.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(eS.Q,{showTooltip:!d,tooltipContent:"You don't have permission to disable analytics.",children:(0,a.jsx)(eI.d,{checked:F,onCheckedChange:$,disabled:!d})})}),c&&(0,a.jsx)(ee.m,{label:"Unpublish Project",description:"Remove public access to this project.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(eS.Q,{showTooltip:!m,tooltipContent:"You don't have permission to unpublish this project.",children:(0,a.jsx)(h.$,{onClick:()=>T({onConfirm:z}),disabled:R.isPending||!(null==c?void 0:c.is_published)||!m,children:"Unpublish"})})}),c&&(0,a.jsx)(ee.m,{label:"Delete Project",description:"Permanently delete this project.",mobileLayout:"horizontal",justify:"end",children:(0,a.jsx)(eS.Q,{showTooltip:!u,tooltipContent:"You don't have permission to delete this project.",children:(0,a.jsx)(h.$,{variant:"destructive",onClick:()=>j(!0),disabled:!u,children:"Delete"})})}),c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e_.U,{project:c,isOpen:x,onClose:()=>p(!1)}),(0,a.jsx)(ek.B,{project:c,isOpen:g,onClose:()=>j(!1),hasActiveLock:f})]})]})};var eB=t(17489),e$=t(9070),eW=t(69764),eG=t(99990),eK=t(6072),eq=t(83863);let eV=e=>{let{shouldScaleBackground:s=!0,...t}=e;return(0,a.jsx)(eq._s.Root,{shouldScaleBackground:s,...t})};eV.displayName="Drawer",eq._s.Trigger;let eH=eq._s.Portal;eq._s.Close;let eY=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eq._s.Overlay,{ref:s,className:(0,ex.cn)("fixed inset-0 z-[10000] bg-black/80",t),...r})});eY.displayName=eq._s.Overlay.displayName;let eQ=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(eH,{children:[(0,a.jsx)(eY,{}),(0,a.jsxs)(eq._s.Content,{ref:s,className:(0,ex.cn)("fixed inset-x-0 bottom-0 z-[10000] mt-24 flex h-auto flex-col rounded-t-[24px] border bg-background",t),...n,children:[(0,a.jsx)("div",{className:"mx-auto mt-4 h-1.5 w-[60px] rounded-full bg-muted"}),r]})]})});eQ.displayName="DrawerContent";let eZ=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eq._s.Title,{ref:s,className:(0,ex.cn)("text-lg font-medium leading-none tracking-tight",t),...r})});eZ.displayName=eq._s.Title.displayName;let eJ=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eq._s.Description,{ref:s,className:(0,ex.cn)("text-sm text-muted-foreground",t),...r})});eJ.displayName=eq._s.Description.displayName;let eX=e=>{var s,t,a;let r=(null==(t=e.detail)||null==(s=t.originalEvent)?void 0:s.target)||e.target;r&&r.closest(".toaster")&&(e.preventDefault(),null==(a=e.stopPropagation)||a.call(e))},e0=e=>{let{children:s,open:t,onOpenChange:r}=e;return(0,g.A)("md")?(0,a.jsx)(eV,{open:t,onOpenChange:r,children:(0,a.jsx)(e2,{children:s})}):(0,a.jsx)(eK.lG,{open:t,onOpenChange:r,children:(0,a.jsx)(e1,{children:s})})},e1=e=>{let{children:s,className:t,...r}=e;return(0,a.jsxs)(eK.Cf,{hideCloseButton:!0,className:(0,ex.cn)("flex h-[90dvh] max-h-[800px] w-[95dvw] flex-1 flex-col items-start px-0 py-0",t),size:"2xl",onFocusOutside:eX,onPointerDownOutside:eX,...r,"aria-describedby":"Settings dialog",children:[(0,a.jsxs)(eG.s6,{children:[(0,a.jsx)(eK.rr,{children:"Settings dialog"}),(0,a.jsx)(eW.L3,{children:"Settings dialog"})]}),(0,a.jsx)(eW.HM,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"ghost",size:"icon-sm",className:"absolute right-2 top-2 z-10 hover:bg-transparent hover:opacity-75",children:(0,a.jsx)(p.A,{name:"close",size:"small"})})}),s]})},e2=e=>{let{children:s,className:t,...r}=e;return(0,a.jsxs)(eQ,{className:(0,ex.cn)("flex h-[90dvh] flex-col items-start px-0 py-0",t),onInteractOutside:eX,...r,children:[(0,a.jsxs)(eG.s6,{children:[(0,a.jsx)(eJ,{children:"Settings drawer"}),(0,a.jsx)(eZ,{children:"Settings drawer"})]}),s]})};var e5=t(48591),e9=t(39226),e4=t(86077),e3=t(80328),e6=t(19489);function e7(e){let{title:s,description:t,featureKey:r,checked:n}=e,{authUser:l}=(0,i.Z2)(),{mutate:o}=(0,e6.S)({featureKey:r,silent:!1});return(0,a.jsx)(ee.m,{label:s,description:t,mobileLayout:"horizontal",children:(0,a.jsx)(eI.d,{checked:n,onCheckedChange:o,disabled:!l,className:"ml-auto"})})}var e8=t(66608);let se=()=>{let{userData:e}=(0,e8.ur)(),s=(()=>{let{userData:e}=(0,e8.ur)();return(0,eO.n)({mutationFn:async s=>(0,m.P)().put("/user/".concat(e.id),{suggestions_enabled:s}),onSuccess:(e,s)=>{H.toast.success("Suggestions settings updated",{description:"Suggestions are now ".concat(s?"enabled":"disabled")})},onError:e=>{(0,eF.Ni)(e)}})})(),t=(null==e?void 0:e.suggestions_enabled)===!0;return(0,a.jsx)(ee.m,{label:"Chat Suggestions",description:"Show helpful suggestions in the chat interface to enhance your experience.",mobileLayout:"horizontal",isLast:!1,children:e?(0,a.jsx)(eI.d,{checked:t,onCheckedChange:e=>{s.mutate(e)},className:"ml-auto"}):(0,a.jsx)(F.E,{className:"h-5 w-9"})})},ss=()=>{let{isLoading:e,features:s}=(0,e3.l)(),t=(0,e5.QZ)();return(0,a.jsx)(c.Pt,{value:"labs",title:"Labs",description:"These are experimental features, that might be modified or removed.",docsLink:"https://docs.lovable.dev/features/labs",children:e?(0,a.jsx)(F.E,{className:"h-10 w-full"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e7,{title:"GitHub Branch Switching",description:"Select the branch to make edits to in your GitHub repository.",featureKey:"git_branch_switching",checked:!!(null==s?void 0:s.git_branch_switching)}),t&&(0,a.jsx)(se,{})]})})};var st=t(22291),sa=t(4099),sr=t(5790);let sn=e=>{var s;let{isInteractive:t=!1,className:r,authUser:n,userData:i,...l}=e,o=(0,sr.Q)(null==i?void 0:i.id),c=(null==i||null==(s=i.attributes)?void 0:s.display_name)||(null==n?void 0:n.email)||i.username;return(0,a.jsx)(sa._,{name:c,isInteractive:t,photoSrc:void 0,userColor:o,className:r,...l})},si=e=>{let{userData:s,authUser:t}=e;return(0,a.jsx)(ee.m,{label:"Your Avatar",description:"Your avatar is automatically generated based on your account.",mobileLayout:"horizontal",children:(0,a.jsx)(sn,{className:"ml-auto h-10 w-10 md:ml-0",userData:s,authUser:t})})};var sl=t(88852);let so=e=>{var s;let{authUser:t}=e;return(0,a.jsx)(ee.m,{label:"Email",description:"Your email address associated with your account.",children:(0,a.jsx)(sl.p,{value:null!=(s=null==t?void 0:t.email)?s:"",disabled:!0,readOnly:!0,className:"w-full",placeholder:"No email available"})})};var sc=t(74880),sd=t(26984),su=t(99490),sm=t(14635),sh=t(37598);let sx=su.Ik({display_name:su.Yj().optional(),bio:su.Yj().optional(),location:su.Yj().optional(),link:su.Yj().optional(),hide_profile_pictures:su.zM().optional()}),sp=e=>{var s,t,r,n,i,l,o,c,d,u;let{userData:x,avatarExists:p}=e,g=(0,sd.mN)({defaultValues:{display_name:null!=(l=null==(s=x.attributes)?void 0:s.display_name)?l:"",bio:null!=(o=null==(t=x.attributes)?void 0:t.bio)?o:"",location:null!=(c=null==(r=x.attributes)?void 0:r.location)?c:"",link:null!=(d=null==(n=x.attributes)?void 0:n.link)?d:"",hide_profile_pictures:null!=(u=null==(i=x.attributes)?void 0:i.hide_profile_pictures)&&u},resolver:(0,sc.u)(sx)}),j=(0,ef.jE)(),{mutate:f,isPending:v}=(0,eO.n)({mutationFn:async e=>(0,m.P)().put("/user/".concat(x.id),{attributes:e}),onSuccess:(e,s)=>{H.toast.success("Success",{description:"Account settings updated successfully"}),g.reset(s),j.invalidateQueries({queryKey:eP.workspaceKeys.all})},onError:e=>{(0,eF.Ni)(e)}});return(0,a.jsx)(sh.lV,{...g,children:(0,a.jsxs)("form",{className:"flex w-full flex-col gap-6",onSubmit:g.handleSubmit(e=>{let s=g.formState.defaultValues,t=Object.keys(e).filter(t=>e[t]!==(null==s?void 0:s[t]));V.Ay.capture(eh.fF.SETTINGS_UPDATED,{changedFields:t,fieldsCount:t.length,hasDisplayName:!!e.display_name,hasBio:!!e.bio,hasLocation:!!e.location,hasLink:!!e.link,hideProfilePictures:!!e.hide_profile_pictures}),f(e)}),children:[(0,a.jsx)(ee.m,{label:"Name",description:"Your full name, as visible to others.",children:(0,a.jsx)(sh.zB,{control:g.control,name:"display_name",render:e=>{let{field:s}=e;return(0,a.jsxs)(sh.eI,{className:"w-full",children:[(0,a.jsx)(sh.MJ,{children:(0,a.jsx)(sl.p,{...s})}),(0,a.jsx)(sh.C5,{})]})}})}),(0,a.jsx)(ee.m,{label:"Description",description:"A short description of yourself or your work.",children:(0,a.jsx)(sh.zB,{control:g.control,name:"bio",render:e=>{let{field:s}=e;return(0,a.jsxs)(sh.eI,{className:"w-full",children:[(0,a.jsx)(sh.MJ,{children:(0,a.jsx)(em.T,{className:"resize-none border bg-background",rows:3,...s})}),(0,a.jsx)(sh.C5,{})]})}})}),(0,a.jsx)(ee.m,{label:"Location",description:"Where you're based.",children:(0,a.jsx)(sh.zB,{control:g.control,name:"location",render:e=>{let{field:s}=e;return(0,a.jsxs)(sh.eI,{className:"w-full",children:[(0,a.jsx)(sh.MJ,{children:(0,a.jsx)(sl.p,{...s})}),(0,a.jsx)(sh.C5,{})]})}})}),(0,a.jsx)(ee.m,{label:"Link",description:"Add a link to your personal website or portfolio.",children:(0,a.jsx)(sh.zB,{control:g.control,name:"link",render:e=>{let{field:s}=e;return(0,a.jsxs)(sh.eI,{className:"w-full",children:[(0,a.jsx)(sh.MJ,{children:(0,a.jsx)(sl.p,{...s})}),(0,a.jsx)(sh.C5,{})]})}})}),p&&(0,a.jsx)(ee.m,{label:"Hide Profile Picture",mobileLayout:"horizontal",className:"last:border-b",children:(0,a.jsx)(sh.zB,{control:g.control,name:"hide_profile_pictures",render:e=>{let{field:s}=e;return(0,a.jsxs)(sh.eI,{className:"ml-auto flex flex-row items-center space-x-2 space-y-0",children:[(0,a.jsx)(sh.MJ,{children:(0,a.jsx)(sm.S,{checked:s.value,onCheckedChange:s.onChange})}),(0,a.jsx)(sh.C5,{})]})}})}),g.formState.isDirty&&(0,a.jsxs)(ee.E,{className:"justify-end gap-2",children:[(0,a.jsx)(h.$,{type:"button",variant:"secondary",onClick:()=>{V.Ay.capture(eh.fF.SETTINGS_CANCELLED),g.reset()},children:"Cancel"}),(0,a.jsx)(h.$,{type:"submit",loading:v,variant:"affirmative",children:"Update"})]})]})})},sg=su.Ik({username:su.Yj().min(3,{message:"Username must be at least 3 characters"}).max(16,{message:"Username must be at most 16 characters"}).regex(/^[a-z]/,{message:"Username must start with a letter"}).regex(/^[a-z0-9_]+$/,{message:"Username can only contain lowercase letters, numbers, and underscores"})}),sj=e=>{let s=(0,sd.mN)({resolver:(0,sc.u)(sg),defaultValues:{username:""}}),t=(0,eO.n)({mutationFn:async e=>{let{username:s}=e;return(0,m.P)().put("/user/username",{username:s})},onSuccess:()=>{var s;H.toast.success("Success",{description:"Username updated successfully"}),null==(s=e.onOpenChange)||s.call(e,!1)},onError:e=>{(0,eF.Ni)(e)}});return(0,a.jsx)(eK.lG,{...e,children:(0,a.jsxs)(eK.Cf,{children:[(0,a.jsx)(eK.L3,{children:"Set Username"}),(0,a.jsx)(eK.rr,{children:"Please enter your desired username. You can not change your username once you have set it."}),(0,a.jsx)("form",{onSubmit:s.handleSubmit(e=>{t.mutate(e)}),children:(0,a.jsxs)(sh.lV,{...s,children:[(0,a.jsx)(sh.zB,{control:s.control,name:"username",render:e=>{let{field:s}=e;return(0,a.jsxs)(sh.eI,{className:"w-full",children:[(0,a.jsx)(sh.lR,{children:"Username"}),(0,a.jsx)(sh.MJ,{children:(0,a.jsx)(sl.p,{...s})}),(0,a.jsx)(sh.C5,{})]})}}),(0,a.jsx)(eK.Es,{className:"mt-4",children:(0,a.jsx)(h.$,{loading:t.isPending,type:"submit",children:"Save"})})]})})]})})},sf=e=>{let{username:s,userId:t}=e,[n,i]=(0,r.useState)(!1),l=!!t&&s===t;return(0,a.jsxs)(ee.m,{label:"Username",description:"Your public identifier and profile URL.",children:[(0,a.jsxs)("div",{className:"flex w-full flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-start gap-2",children:(0,a.jsx)(sl.p,{placeholder:"Username",className:"w-full",value:null!=s?s:"",disabled:!l,readOnly:!0,onClick:()=>{s&&i(!0)}})}),(0,a.jsxs)("p",{className:"flex items-center gap-1 break-all text-sm text-muted-foreground underline transition-colors duration-150 ease-in-out hover:text-muted-foreground/80",children:[s?(0,a.jsxs)(q(),{className:"",href:"".concat(window.location.origin,"/@").concat(s),target:"_blank",rel:"noreferrer",children:["lovable.dev/@",s]}):"lovable.dev/@<username>",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})]}),(0,a.jsx)(sj,{open:n,onOpenChange:i})]})};var sv=t(46905),sy=t(50088),sb=t(99017);let sw=Math.ceil(365/7),sN=e=>{let{}=e,{userData:s}=(0,e8.ur)(),t=(e=>{let{data:s={}}=(0,u.I)({...sy.Y.contributions({userData:e}),enabled:!!(null==e?void 0:e.username)});return new Map(Object.entries(s))})(s),n=(0,r.useMemo)(()=>{let e=new Date,s=[];for(let a=0;a<sw;a++){let r=[];for(let s=0;s<7;s++){let n=(0,sv.e)(e,(sw-a-1)*7+(7-s-1)),i=(0,_.GP)(n,"yyyy-MM-dd"),l=t.get(i)||0;r.push({date:n,count:l})}s.push(r)}return s},[t]),i=(0,r.useRef)(null),[l,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>{let e=i.current;e&&(o(e.scrollLeft>0),d(e.scrollLeft+e.clientWidth<e.scrollWidth-1))},s=i.current;if(s)return s.scrollLeft=s.scrollWidth,o(s.scrollLeft>0),d(s.scrollWidth>s.clientWidth&&s.scrollLeft+s.clientWidth<s.scrollWidth-1),s.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{s.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]);let m=(0,r.useMemo)(()=>Math.max(...Array.from(t.values()),0),[t]),h=(0,r.useMemo)(()=>e=>{if(0===e||0===m)return"bg-muted";let s=e/m;return s<=.25?"bg-brand-sapphire-primary/40":s<=.5?"bg-brand-sapphire-primary/60":s<=.75?"bg-brand-sapphire-primary/80":"bg-brand-sapphire-primary"},[m]),x=(0,r.useMemo)(()=>n.flat(),[n]),p=(0,r.useMemo)(()=>x.slice(-365),[x]),g=(0,r.useMemo)(()=>p.reduce((e,s)=>e+s.count,0),[p]),j=(0,r.useMemo)(()=>g/365,[g]),f=(0,r.useMemo)(()=>p.filter(e=>e.count>0).length,[p]),v=(0,r.useMemo)(()=>f/365*100,[f]),y=(0,r.useMemo)(()=>{let e=0;for(let s=p.length-1;s>=0;s--)if(p[s].count>0)e++;else break;return e},[p]);return(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-2",children:[(0,a.jsxs)("p",{className:"flex items-center gap-1 text-base font-medium",children:[g," edits on"," ",(0,a.jsxs)("span",{className:"pl-0.5 pr-px",children:[(0,a.jsx)(e4.Qn,{className:"flex h-[12px] dark:hidden"}),(0,a.jsx)(e4.I_,{className:"hidden h-[12px] dark:flex"})]})," ","in the last year"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{ref:i,className:"overflow-x-auto pb-2",children:(0,a.jsx)("div",{className:"inline-block min-w-[600px] max-w-[760px] rounded-xl border border-input bg-card p-2",children:(0,a.jsx)("div",{className:"flex gap-[2px]",children:n.map((e,s)=>(0,a.jsx)("div",{className:"flex flex-col gap-[2px]",children:e.map((e,s)=>(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"relative size-2.5",children:(0,a.jsx)("div",{className:(0,ex.cn)("absolute inset-0 z-10 size-2.5 rounded-[2px] transition-colors duration-200",h(e.count))})})}),(0,a.jsxs)(sb.ZI,{side:"top",align:"center",children:["".concat((0,_.GP)(e.date,"MMM d, yyyy"),": ").concat(e.count>0?e.count:"No"," ").concat(1===e.count?"edit":"edits"),(0,a.jsx)(sb.PR,{})]})]},s))},s))})})}),l&&(0,a.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 h-full w-6 bg-gradient-to-r from-background via-background/80 to-transparent"}),c&&(0,a.jsx)("div",{className:"pointer-events-none absolute right-0 top-0 h-full w-6 bg-gradient-to-l from-background via-background/80 to-transparent"})]}),(0,a.jsxs)("div",{className:"grid max-w-[652px] grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"border-r py-3",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Daily average"}),(0,a.jsxs)("div",{className:"text-base font-medium",children:[j.toFixed(1)," ","1.0"===j.toFixed(1)?"edit":"edits"]})]}),(0,a.jsxs)("div",{className:"border-r py-3",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Days edited"}),(0,a.jsxs)("div",{className:"text-base font-medium",children:[f," (",v.toFixed(0),"%)"]})]}),(0,a.jsxs)("div",{className:"py-3",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Current streak"}),(0,a.jsxs)("div",{className:"text-base font-medium",children:[y," ",1===y?"day":"days"]})]})]})]})};var sC=t(82162),sk=t(33979);let s_=e=>{let{active:s,setActive:t,onClick:r,disabled:n}=e;return(0,a.jsxs)(sk.z,{className:"flex w-full flex-col gap-4",disabled:n,defaultValue:s,onValueChange:e=>{t(e)},children:[(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(sk.C,{value:"firstgen",id:"firstgen",onClick:()=>{null==r||r()}}),(0,a.jsx)(sC.Label,{htmlFor:"firstgen",className:"flex w-full cursor-pointer flex-col gap-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(p.A,{size:"small",name:"stacked_line_chart",className:"text-muted-foreground"}),"First Generation"]})})]}),(0,a.jsxs)("div",{className:"flex w-full items-start space-x-2",children:[(0,a.jsx)(sk.C,{value:"always",id:"always",onClick:()=>{null==r||r()}}),(0,a.jsx)(sC.Label,{htmlFor:"always",className:"flex w-full cursor-pointer flex-col gap-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(p.A,{size:"small",name:"volume_up",className:"text-muted-foreground"}),"Always"]})})]}),(0,a.jsxs)("div",{className:"flex w-full items-start space-x-2",children:[(0,a.jsx)(sk.C,{value:"never",id:"never",onClick:()=>{null==r||r()}}),(0,a.jsx)(sC.Label,{htmlFor:"never",className:"flex w-full cursor-pointer flex-col gap-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(p.A,{size:"small",name:"volume_off",className:"text-muted-foreground"}),"Never"]})})]})]})},sS=()=>{var e;let{userData:s}=(0,e8.ur)(),t=(()=>{let{userData:e}=(0,e8.ur)();return(0,eO.n)({mutationFn:async s=>{let t=(0,m.P)();return await t.put("/user/".concat(e.id),{sound_effect_active:s})},onSuccess:(e,s)=>{H.toast.success("Sound effect settings updated",{description:"Sound effects will now play ".concat("firstgen"===s?"on first generation":"always"===s?"on all generations":"never")})},onError:e=>{(0,eF.Ni)(e)}})})(),r=null!=(e=null==s?void 0:s.sound_effect_active)?e:"firstgen";return(0,a.jsx)(ee.m,{label:"Generation complete sound",description:"Plays a satisfying sound notification when a generation is finished.",isLast:!0,children:s?(0,a.jsx)(s_,{active:r,setActive:e=>{t.mutate(e)}}):(0,a.jsx)(F.E,{className:"h-10 w-full"})})},sI=()=>{let{authUser:e}=(0,i.Z2)(),{userData:s}=(0,e8.ur)(),t=(0,e5.sA)(),r=(0,l.j4)(e=>{var s;return null==(s=e.currentWorkspace)?void 0:s.plan}),{isEnterprisePlan:n}=(0,er.cb)(r),o=(0,st.useRouter)();return s?(0,a.jsxs)(c.Pt,{value:"account",title:"Account Settings",description:"Personalize how others see and interact with you on Lovable.",children:[t&&!n&&(0,a.jsx)(sN,{}),(0,a.jsx)(si,{userData:s,authUser:e}),(0,a.jsx)(sf,{userId:s.id,username:s.username}),(0,a.jsx)(so,{authUser:e}),(0,a.jsx)(sp,{userData:s,avatarExists:!!(null==e?void 0:e.photoURL)}),(0,a.jsx)(sS,{}),(0,a.jsx)(ee.m,{label:"Link SSO",description:"Connect your account to company SSO.",children:(0,a.jsx)(h.$,{variant:"outline",onClick:()=>o.push("/sso-login/"),children:"Link SSO"})}),(0,a.jsx)("div",{className:"mb-12"})]}):null};var sE=t(81688),sA=t(89906),sP=t(72384);let sD=e=>{var s,t,a;let{userData:n}=(0,e8.ur)(),i=null==n||null==(s=n.github)?void 0:s.encrypted_access_token,l=(0,r.useRef)(i),o=(0,u.I)(sP.y.workspaceGithubInstallations({workspaceId:e}));return(0,r.useEffect)(()=>{l.current!==i&&(o.refetch().catch(()=>{}),l.current=i)},[i,o]),{installations:null==(t=o.data)?void 0:t.installations,requiredAction:null==(a=o.data)?void 0:a.required_action}};var sT=t(95687);let sL=e=>{let{isLoading:s,hasAccessToken:t,hasValidAccessToken:n,githubUsername:i,onGithubConnected:l,isWorkspaceAdmin:o}=e;return(0,r.useEffect)(()=>{let e=e=>{"githubAppAuthenticated"===e.data&&l()};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[l]),(0,a.jsx)(ee.m,{label:"Connected Account",description:"Add your GitHub account to manage connected organizations.",justify:"end",badges:["admin"],children:s?(0,a.jsx)(F.E,{className:"h-7 w-32"}):t&&n?(0,a.jsxs)(h.$,{disabled:!0,variant:"outline",size:"sm",children:[(0,a.jsx)(e4.Xy.GitHub,{className:"h-4 w-4"}),null!=i?i:"Connected"]}):(0,a.jsx)(sz,{isWorkspaceAdmin:o})})},sz=e=>{let{isWorkspaceAdmin:s}=e;return(0,a.jsxs)(h.$,{variant:"default",size:"sm",onClick:sT.pT,disabled:!s,children:[(0,a.jsx)(e4.Xy.GitHub,{className:"h-4 w-4"}),"Connect GitHub"]})};var sR=t(60527),sO=t(76708);function sF(e){let{projectId:s,main_branch:t,searchTerm:n,setSearchTerm:i,switchBranchMutation:l}=e,{data:o,isPending:c,error:d}=(0,u.I)({queryKey:eP.gO.branches(s),queryFn:async()=>(0,m.P)().get("/projects/".concat(s,"/github/branches"))}),x=(0,r.useMemo)(()=>null==o?void 0:o.some(e=>e.name===t),[o,t]),{branchesWithCurrentFirst:g,filteredBranches:j}=(0,r.useMemo)(()=>{if(!o)return{branchesWithCurrentFirst:[],filteredBranches:[]};let e=o.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())),s=e.find(e=>e.name===t);return s?{branchesWithCurrentFirst:[s,...e.filter(e=>e.name!==t)],filteredBranches:e}:{branchesWithCurrentFirst:e,filteredBranches:e}},[o,t,n]);return(0,a.jsxs)("div",{className:"relative flex flex-col gap-3 p-4",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)("h4",{children:"Switch or create branch"}),(0,a.jsx)(sR.iN,{className:"absolute right-2 top-2",asChild:!0,children:(0,a.jsx)(h.$,{variant:"ghost",size:"icon-sm",children:(0,a.jsx)(p.A,{name:"close",size:"small"})})})]}),(0,a.jsx)("div",{children:c?(0,a.jsx)(sO.I,{text:"Loading branches from GitHub..."}):d?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-destructive-primary",children:[(0,a.jsx)(p.A,{name:"warning_fill",size:"small"}),d.message]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"",children:(0,a.jsx)(sl.p,{type:"text",placeholder:"Find or create a branch...",value:n,onChange:e=>i(e.target.value)})}),(0,a.jsxs)("div",{className:"branches-list flex max-h-[40vh] flex-col gap-2 overflow-y-auto pt-2",children:[g.map(e=>(0,a.jsxs)(h.$,{className:"branch-item flex w-full items-center justify-between px-3 text-left",onClick:()=>l.mutate(e.name),variant:e.name===t?"default":"ghost",disabled:l.isPending||e.name===t,loading:l.isPending&&l.variables===e.name,children:[(0,a.jsx)("span",{children:l.isPending&&l.variables===e.name?"Switching to "+e.name:e.name}),e.name===t&&(0,a.jsx)(p.A,{name:"check"})]},e.name)),n&&!j.some(e=>e.name===n)&&(0,a.jsx)(eS.Q,{showTooltip:!x,tooltipContent:"Your current branch does not exist on GitHub. Please switch to an existing branch first, then create your new branch.",children:(0,a.jsxs)(h.$,{className:(0,ex.cn)("h-auto w-full items-center justify-start"),onClick:()=>l.mutate(n),variant:"outline",disabled:l.isPending||!x,loading:l.isPending,children:[(0,a.jsx)(p.A,{name:"add",className:"text-muted-foreground",size:"small"}),(0,a.jsxs)("p",{className:"text-wrap text-left",children:["Create branch ",(0,a.jsx)("strong",{children:n})," from ",(0,a.jsx)("strong",{children:t})]})]})})]})]})})]})}let sM=e=>{let{mainBranch:s,projectId:t}=e,[n,i]=(0,r.useState)(""),[l,o]=(0,r.useState)(!1),c=(0,ep.Iw)(e=>{var s;return(null==(s=e.project)?void 0:s.main_branch)||"main"}),d=(0,g.A)("md"),u=(0,ef.jE)(),x=(0,eO.n)({mutationFn:async e=>{await (0,m.P)().post("/projects/".concat(t,"/github/branches"),{branch_name:e})},onSuccess:(e,s)=>{u.invalidateQueries({queryKey:eP.gO.branches(t)}),H.toast.success("Lovable is now using branch: ".concat(s)),i(""),o(!1)},onError:e=>{(0,eF.Ni)(e)}});return(0,a.jsx)(ee.m,{label:"Branch",description:"Choose the GitHub branch you want to work on inside Lovable.",justify:"end",badges:["labs"],children:(0,a.jsxs)(sR.AM,{open:l,onOpenChange:o,children:[(0,a.jsx)(sR.Wv,{asChild:!0,children:(0,a.jsxs)(h.$,{variant:"outline",size:"sm",loading:x.isPending,children:[(0,a.jsx)(p.A,{name:"graph_1",className:"h-4 w-4"}),s,(0,a.jsx)(p.A,{name:"chevron_right",size:"small",className:"rotate-90"})]})}),(0,a.jsx)(sR.hl,{className:"p-0",align:d?"start":"end",children:(0,a.jsx)(sF,{projectId:t,main_branch:c,searchTerm:n,setSearchTerm:i,switchBranchMutation:x})})]})})};var sU=t(4412),sB=t(59319);let s$=e=>{let{label:s,value:t}=e;return(0,a.jsx)(sU.Xi,{className:"rounded-none border-b border-transparent px-0 py-0.5 text-xs data-[state=active]:border-b-border data-[state=active]:font-medium data-[state=active]:shadow-none",value:t,children:s})},sW=e=>{let{url:s}=e,t=(0,r.forwardRef)((e,s)=>(0,a.jsx)(h.$,{ref:s,...e,variant:"ghost",className:"-mr-2 h-8 hover:text-primary",size:"icon-sm",children:(0,a.jsx)(p.A,{name:"content_copy",className:"h-4 w-4"})}));t.displayName="TriggerComponent";let n=(0,sB.T)()({TriggerComponent:t,textToCopy:s});return(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(sl.p,{className:"h-8 flex-1 p-2 font-mono text-muted-foreground focus:text-primary md:text-xs",value:s,onFocus:e=>e.target.select(),readOnly:!0}),(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{children:n}),(0,a.jsx)(sb.ZI,{children:"Copy to clipboard"})]})]})},sG=e=>{var s,t;let{project:r}=e,n=(null==r?void 0:r.github_repo_name)?(0,sE.rZ)(r.github_repo_name,null==r||null==(s=r.github_owner)?void 0:s.name):"#",i=(null==r||null==(t=r.github_owner)?void 0:t.name)+"/"+(null==r?void 0:r.github_repo_name);return(0,a.jsx)(ee.m,{label:"Clone",description:"Copy this repository to your local environment.",justify:"end",children:(0,a.jsxs)(sU.tU,{defaultValue:"https",className:"w-full pb-2",children:[(0,a.jsxs)(sU.j7,{className:"gap-2 px-0 pb-0 pt-0",children:[(0,a.jsx)(s$,{value:"https",label:"HTTPS"}),(0,a.jsx)(s$,{value:"ssh",label:"SSH"}),(null==r?void 0:r.is_github)&&(0,a.jsx)(s$,{value:"githubcli",label:"GitHub CLI"})]}),(0,a.jsx)(sU.av,{value:"https",className:"mt-0",children:(0,a.jsx)(sW,{url:"".concat(n,".git")})}),(0,a.jsx)(sU.av,{value:"ssh",className:"mt-0",children:(0,a.jsx)(sW,{url:"git@github.com:".concat(i,".git")})}),(0,a.jsx)(sU.av,{value:"githubcli",className:"mt-0",children:(0,a.jsx)(sW,{url:"gh repo clone ".concat(i)})})]})})};var sK=t(96431),sq=t(39);let sV=e=>{let{setStep:s,installations:t,workspaceInstallations:r,workspace:n}=e,i=r.filter(e=>!t.some(s=>s.id===e.id)),{addGithubTarget:l,isAddGithubTargetLoading:o}=(e=>{let s=(0,ef.jE)(),{mutate:t,isPending:a}=(0,eO.n)({mutationFn:async s=>{let{githubInstallation:t}=s,a=(0,m.P)();return await a.post("/workspaces/".concat(e,"/github-installations"),{github_installation_id:t.id})},onSuccess:async(t,a)=>{let r=eP.workspaceKeys.workspaceGithubInstallations(e),n=s.getQueryData(r);n&&s.setQueryData(r,{...n,installations:[...n.installations,a.githubInstallation]}),H.toast.success("Added GitHub Organization",{description:"You can now transfer projects in this workspace to ".concat(a.githubInstallation.account.login)})},onError:e=>{(0,eF.Ni)(e)},onSettled:()=>{s.invalidateQueries({queryKey:eP.workspaceKeys.workspaceGithubInstallations(e)})}});return{addGithubTarget:t,isAddGithubTargetLoading:a}})(n.id),c=e=>{l({githubInstallation:e})},{deleteGithubTarget:d,isDeleteGithubTargetLoading:u}=(e=>{let s=(0,ef.jE)(),{mutate:t,isPending:a}=(0,eO.n)({mutationFn:async s=>{let{githubInstallation:t}=s;return(0,m.P)().delete("/workspaces/".concat(e,"/github-installations/").concat(t.id))},onSuccess:async(t,a)=>{let r=eP.workspaceKeys.workspaceGithubInstallations(e),n=s.getQueryData(r);n&&s.setQueryData(r,{...n,installations:n.installations.filter(e=>e.id!==a.githubInstallation.id)}),H.toast.success("Removed GitHub Organization",{description:"You can no longer transfer projects in this workspace to ".concat(a.githubInstallation.account.login)})},onError:e=>{(0,eF.Ni)(e)},onSettled:()=>{s.invalidateQueries({queryKey:eP.workspaceKeys.workspaceGithubInstallations(e)})}});return{deleteGithubTarget:t,isDeleteGithubTargetLoading:a}})(n.id),x=e=>{d({githubInstallation:e})},p=r.length>0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(sK.Fh,{title:"Link your workspace to GitHub",description:"Anyone in your Lovable workspace can add Lovable projects to GitHub organizations.",badge:"admin"}),(0,a.jsx)(ew.Separator,{}),(0,a.jsxs)("div",{className:"grid min-h-[200px] grid-cols-1 gap-3 px-6 py-6 md:grid-cols-2",children:[(0,a.jsx)(sK.tX,{workspace:n}),(0,a.jsxs)("div",{className:"flex max-h-[40vh] flex-col gap-3 overflow-y-auto",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"GitHub Organizations"}),t.map(e=>{let s=r.find(s=>s.id===e.id);return(0,a.jsx)(sH,{installation:e,workspaceInstallation:s,addWorkspaceInstallation:c,disabled:o||u,deleteGithubTarget:x},e.id)}),i.length>0&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Other users have added the following organizations:"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"If unlinked, you can not add them back."}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:i.map(e=>(0,a.jsx)(sH,{installation:e,workspaceInstallation:e,addWorkspaceInstallation:c,disabled:o||u,deleteGithubTarget:x},e.id))})]})}),(0,a.jsx)(h.$,{variant:t.length>0?"outline":"default",size:"sm",onClick:()=>(0,sT.CN)({githubOwner:null,workspaceId:n.id}),className:"mt-auto",children:"Add Organizations"})]})]}),(0,a.jsx)(ew.Separator,{}),(0,a.jsx)(sK.p8,{children:(0,a.jsx)(eS.Q,{tooltipContent:"Please add and enable at least one organization to continue.",showTooltip:!p,className:"ml-auto",children:(0,a.jsx)(h.$,{disabled:!p,onClick:()=>s("transfer"),size:"sm",className:"ml-auto",children:"Continue"})})})]})},sH=e=>{let{installation:s,workspaceInstallation:t,addWorkspaceInstallation:r,disabled:n,deleteGithubTarget:i}=e,l=(null==t?void 0:t.id)===s.id;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(sq.eu,{className:"h-7 w-7 border",children:(0,a.jsx)(sq.BK,{src:s.account.avatar_url})}),(0,a.jsx)("span",{className:"font-medium",children:s.account.login})]}),(0,a.jsx)(eI.d,{disabled:n,onCheckedChange:e=>{e?r(s):i(s)},checked:l})]})};var sY=t(53417);let sQ=e=>{let{setStep:s,installations:t,isTransferProjectLoading:r,isWorkspaceAdmin:n,onTransfer:i}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(sK.Fh,{title:"Connect Project",description:"Connect your project to your GitHub organization in a 2-way sync."}),(0,a.jsx)(ew.Separator,{}),(0,a.jsxs)("div",{className:"flex max-h-[40vh] flex-col gap-3 overflow-y-auto px-6 py-6",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"GitHub Organizations"}),t.map(e=>(0,a.jsx)(sZ,{installation:e,disabled:r||!n&&!!e.suspended_at,onTransfer:i,isWorkspaceAdmin:n,isLoading:r},e.account.login))]}),(0,a.jsx)(ew.Separator,{}),(0,a.jsx)(sK.p8,{children:(0,a.jsx)(h.$,{disabled:r,variant:"secondary",onClick:()=>s("organizations"),size:"sm",children:"Back"})})]})},sZ=e=>{let{installation:s,disabled:t,onTransfer:n,isWorkspaceAdmin:i,isLoading:l}=e,[o,c]=(0,r.useState)(!1),d=l&&o;return(0,a.jsxs)("div",{className:"flex w-full items-center justify-start gap-2",children:[(0,a.jsx)(sq.eu,{className:"h-7 w-7 border",children:(0,a.jsx)(sq.BK,{src:s.account.avatar_url})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"truncate font-medium",children:s.account.login}),s.suspended_at&&(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"",children:(0,a.jsx)(sY.E,{className:"inline",variant:"destructive",children:"Suspended"})})}),(0,a.jsx)(sb.ZI,{children:i?(0,a.jsx)("p",{children:"This account is suspended. Reconnect to continue."}):(0,a.jsx)("p",{children:"This account is suspended. Talk to your workspace owner to reconnect."})})]})]}),(0,a.jsx)(h.$,{onClick:()=>{if(s.suspended_at)return void window.open(s.html_url,"_blank");n(s),c(!0)},disabled:t,className:"ml-auto",size:"sm",variant:s.suspended_at?"outline":"default",loading:d,children:s.suspended_at?"Reconnect":d?"Connecting":"Connect"})]},s.account.login)},sJ=e=>{let{isTransferProjectLoading:s,installations:t,isWorkspaceAdmin:n,onTransfer:i,showConnectDialog:l,setShowConnectDialog:o,workspace:c}=e,{installations:d}=sD(c.id),[u,m]=(0,r.useState)("organizations");return(0,a.jsxs)(eK.lG,{open:l,onOpenChange:e=>{e||m("organizations"),o(e)},children:[(0,a.jsx)(eK.zM,{asChild:!0,className:"hidden",children:(0,a.jsx)(h.$,{size:"sm",children:"Connect Project"})}),(0,a.jsx)(sK.Lg,{children:"organizations"===u?(0,a.jsx)(sV,{setStep:m,installations:null!=t?t:[],workspaceInstallations:null!=d?d:[],workspace:c}):(0,a.jsx)(sQ,{setStep:m,installations:null!=d?d:[],isTransferProjectLoading:s,isWorkspaceAdmin:n,onTransfer:i})})]})};var sX=t(38948);let s0=e=>{let{isTransferProjectLoading:s,workspaceInstallations:t,onTransfer:n,isWorkspaceAdmin:i,setShowConnectDialog:l}=e,o=(0,g.A)("md"),c=(0,eD.R)(),[d,u]=(0,r.useState)(!1),m=(null==t?void 0:t.length)===0,{disabled:j,disabledReason:f}=(0,r.useMemo)(()=>c?{disabled:!0,disabledReason:"Cannot transfer project while there is an active operation in progress."}:!i&&m?{disabled:!0,disabledReason:"Ask a workspace admin to add GitHub Organizations."}:{disabled:!1,disabledReason:null},[c,i,m]);return(0,a.jsxs)(x.rI,{open:d,onOpenChange:e=>{m?l(!0):u(e)},children:[(0,a.jsx)(eS.Q,{showTooltip:j,tooltipContent:f,children:(0,a.jsx)(x.ty,{asChild:!0,children:(0,a.jsx)(h.$,{disabled:j,className:"justify-start",size:"sm",loading:s,children:s?"Connecting":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e4.Xy.GitHub,{className:"h-4 w-4"}),"Connect Project"]})})})}),(0,a.jsxs)(x.SQ,{className:"min-w-[200px]",align:o?"start":"end",children:[(0,a.jsx)(x.lp,{className:"text-xs font-medium text-muted-foreground",children:"GitHub Organizations"}),null==t?void 0:t.map(e=>(0,a.jsx)(s1,{installation:e,disabled:s||!i&&!!e.suspended_at,onTransfer:n,isWorkspaceAdmin:i},e.account.login)),(0,a.jsx)(eS.Q,{showTooltip:!i,tooltipContent:"Only workspace admins can add organizations.",side:"left",instant:!0,children:(0,a.jsxs)(x._2,{disabled:!i,onClick:()=>l(!0),children:[(0,a.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border bg-background",children:(0,a.jsx)(p.A,{name:"add",size:"small"})}),m?"Add Organization":"Manage Organizations",(0,a.jsx)(sX.x,{badge:"admin",className:"flex md:hidden"})]})})]})]})},s1=e=>{let{installation:s,disabled:t,onTransfer:r,isWorkspaceAdmin:n}=e;return(0,a.jsx)(eS.Q,{showTooltip:!!s.suspended_at,tooltipContent:n?"This account is suspended. Click to reconnect.":"This account is suspended. Talk to your workspace owner to reconnect.",side:"left",children:(0,a.jsxs)(x._2,{className:"flex w-full items-center justify-start gap-2",onClick:()=>{if(s.suspended_at)return void window.open(s.html_url,"_blank");r(s)},disabled:t,children:[(0,a.jsx)(sq.eu,{className:"h-6 w-6 border",children:(0,a.jsx)(sq.BK,{src:s.account.avatar_url})}),(0,a.jsx)("p",{className:"truncate text-sm font-medium",children:s.account.login}),s.suspended_at&&(0,a.jsx)(sY.E,{className:"inline",variant:"destructive",children:"Suspended"})]},s.account.login)})};var s2=t(82594);let s5=e=>{var s;let{isWorkspaceAdmin:t,workspace:n,showConnectDialog:i,setShowConnectDialog:l}=e,[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),{transferProject:x,isTransferProjectLoading:p}=(e=>{let s=(0,s2.B)(),{mutate:t,isPending:r}=(0,eO.n)({mutationFn:async e=>{let t={new_owner:{id:e.account.id,name:e.account.login,type:e.target_type}},a=(0,m.P)();return await a.post("/projects/".concat(s,"/github/transfer"),t)},onSuccess:async(s,t)=>{H.toast.success("A GitHub Repository is now under your account ".concat(t.account.login),{description:s.new_repo_url,action:(0,a.jsx)(h.$,{size:"sm",asChild:!0,children:(0,a.jsx)("a",{target:"_blank",href:s.new_repo_url,children:"View"})}),duration:2e4}),null==e||e()},onError:e=>{(0,eF.Ni)(e)}});return{transferProject:t,isTransferProjectLoading:r}})(()=>{l(!1)}),g=e=>{u(e),c(!0)},{installations:j}=(0,sA.O)({enabled:null!=t&&t}),{installations:f}=sD(n.id);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s0,{isTransferProjectLoading:p,workspaceInstallations:null!=f?f:[],onTransfer:g,isWorkspaceAdmin:t,setShowConnectDialog:l}),(0,a.jsx)(sJ,{installations:j,isTransferProjectLoading:p,isWorkspaceAdmin:t,onTransfer:g,setShowConnectDialog:l,showConnectDialog:i,workspace:n}),(0,a.jsx)(eK.lG,{open:o,onOpenChange:c,children:(0,a.jsxs)(eK.Cf,{size:"lg",className:"max-w-md",children:[(0,a.jsxs)(eK.c7,{children:[(0,a.jsx)(eK.L3,{children:"Confirm Transfer to Set Up 2-Way Sync"}),(0,a.jsxs)(eK.rr,{children:["You're moving the only instance of this project to your GitHub organization",(null==d||null==(s=d.account)?void 0:s.login)?(0,a.jsxs)("span",{className:"font-medium",children:[" (",d.account.login,")"]}):"",". This means the project will now live in your GitHub, and must remain there to keep syncing with Lovable.",(0,a.jsx)("br",{}),"You can continue editing your project in Lovable as long as access to the GitHub repository remains.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"This is currently not reversible, do you want to continue?"]})]}),(0,a.jsxs)(eK.Es,{children:[(0,a.jsx)(h.$,{variant:"outline",onClick:()=>{c(!1),u(null)},disabled:p,children:"Cancel"}),(0,a.jsx)(h.$,{variant:"destructive",onClick:()=>{d&&x(d,{onSuccess:()=>{c(!1),u(null)}})},loading:p,children:"Transfer anyway"})]})]})})]})};var s9=t(66398);let s4=e=>{let{githubRepoName:s,workspace:t,isWorkspaceAdmin:r,showConnectDialog:n,setShowConnectDialog:i}=e;return s?(0,a.jsx)(ee.m,{label:"Project",description:"Connect your project to your GitHub organization in a 2-way sync.",justify:"end",customBadge:(0,a.jsx)(s9.Q,{status:"connected"}),children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(h.$,{asChild:!0,variant:"outline",size:"sm",children:(0,a.jsxs)(q(),{href:"https://github.com/".concat(s),target:"_blank",rel:"noopener noreferrer",children:["View on GitHub",(0,a.jsx)(p.A,{size:"small",name:"arrow_outward",className:"ml-auto"})]})})})}):(0,a.jsx)(ee.m,{label:"Connect Project",description:"Connect your project to your GitHub organization in a 2-way sync.",justify:"end",customBadge:(0,a.jsx)(s9.Q,{status:"not-connected"}),children:(0,a.jsx)(s5,{isWorkspaceAdmin:r,workspace:t,showConnectDialog:n,setShowConnectDialog:i})})},s3=e=>{let{workspace:s,isInsideEditor:t,myWorkspaceRole:n}=e,[i,l]=(0,r.useState)(!1);return(0,a.jsxs)(c.Pt,{value:"github",title:"GitHub",description:"Sync your project 2-way with GitHub to collaborate at source.",docsLink:"https://docs.lovable.dev/integrations/git-integration",children:[t&&(0,a.jsx)(s7,{workspace:s,myWorkspaceRole:n,showConnectDialog:i,setShowConnectDialog:l}),(0,a.jsx)(s6,{myWorkspaceRole:n,setShowConnectDialog:l,isInsideEditor:t})]})},s6=e=>{var s,t;let{myWorkspaceRole:r,setShowConnectDialog:n,isInsideEditor:i}=e,l="admin"===r||"owner"===r,{hasValidAccessToken:o,isLoading:c}=(0,sA.O)({enabled:null!=l&&l}),{userData:d}=(0,e8.ur)();return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(sL,{isLoading:c||!d,hasAccessToken:!!(null==d||null==(s=d.github)?void 0:s.new_encrypted_access_token),githubUsername:null==d||null==(t=d.github)?void 0:t.username,hasValidAccessToken:null!=o&&o,onGithubConnected:()=>{i&&n(!0)},isWorkspaceAdmin:l})})};function s7(e){var s,t,r,n;let{workspace:i,myWorkspaceRole:l,showConnectDialog:o,setShowConnectDialog:c}=e,d=(0,ep.Iw)(e=>e.project),{installations:u}=sD(i.id),{userData:m}=(0,e8.ur)(),h=null==(s=(0,e3.l)().features)?void 0:s.git_branch_switching;if(!d)return null;let x=(0,sE.oX)(d),p=(null==m||null==(t=m.github)?void 0:t.new_encrypted_access_token)!==null&&(null==m||null==(r=m.github)?void 0:r.new_encrypted_access_token)!==void 0;return(0,a.jsxs)(a.Fragment,{children:[(p||u&&(null==u?void 0:u.length)>0)&&(0,a.jsx)(s4,{isWorkspaceAdmin:"admin"===l||"owner"===l,workspace:i,githubRepoName:x&&(null==d?void 0:d.github_repo_name)&&(null==(n=d.github_owner)?void 0:n.name)?"".concat(d.github_owner.name,"/").concat(d.github_repo_name):void 0,showConnectDialog:o,setShowConnectDialog:c}),x&&(0,a.jsx)(sG,{project:d}),x&&h&&(0,a.jsx)(sM,{mainBranch:d.main_branch||"main",projectId:d.id})]})}var s8=t(245),te=t(24655),ts=t(2418);function tt(e){let{id:s,title:t,description:n,icon:i,serverUrl:l,workspaceId:o}=e,{handleConnect:c,isConnecting:d}=(0,te.jj)(o),{isConnected:x,disconnect:p}=(e=>{var s;let{workspaceId:t,integrationName:a}=e,n=(0,ef.jE)(),{data:i,isLoading:l}=(0,u.I)(sP.y.integrationOAuthStatus({workspaceId:t,integrationName:a})),o=(0,r.useCallback)(async()=>{await n.invalidateQueries({queryKey:eP.workspaceKeys.integrationOAuthStatus(t,a)})},[a,t,n]);(0,r.useEffect)(()=>{let e=async e=>{var s;e.origin===window.location.origin&&(null==(s=e.data)?void 0:s.type)==="integrationAuth"&&e.data.success&&e.data.integrationName===a&&o()};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[n,t,o,a]);let c=(0,eO.n)({mutationFn:async()=>{let e=(0,m.P)();await e.delete("/workspaces/".concat(t,"/integrations/").concat(a,"/oauth"))},onSuccess:()=>{o()}}),d=(0,r.useCallback)(async()=>{await c.mutateAsync()},[c]);return{isConnected:null!=(s=null==i?void 0:i.is_connected)&&s,isLoading:l,disconnect:d}})({workspaceId:o,integrationName:s});return(0,a.jsx)("div",{className:"flex w-full",children:(0,a.jsxs)("div",{className:"flex h-[92px] w-[300px] max-w-full flex-1 items-center justify-start gap-3 rounded-2xl bg-muted pl-5 pr-5",children:[(0,a.jsx)("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center overflow-hidden rounded-xl bg-[#F7F4ED] md:h-14 md:w-14",children:i&&(0,a.jsx)(ts.default,{src:i,alt:t,width:32,height:32,className:"h-8 w-8 rounded-lg object-contain md:h-10 md:w-10"})}),(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,a.jsx)("h3",{className:"truncate text-lg font-medium",children:t}),(0,a.jsx)("p",{className:"line-clamp-2 max-w-[160px] text-sm text-muted-foreground md:max-w-[200px]",children:n})]}),(0,a.jsx)("div",{className:"ml-auto flex flex-shrink-0 gap-2",children:(0,a.jsx)(h.$,{onClick:()=>{x?p():l&&c(s,l)},disabled:!l||d,className:(0,ex.cn)("h-9 rounded-full px-3 text-xs font-medium transition-colors",x?"border border-input bg-muted text-foreground hover:border-muted-foreground/20 hover:bg-input":l?"border border-input bg-input text-foreground hover:border-foreground/20 hover:bg-muted":"border border-input bg-muted text-muted-foreground"),children:d?"Connecting...":x?"Disconnect":l?"Connect":"Soon"})})]})})}var ta=t(33063);function tr(){let{project_id:e}=(0,st.useParams)(),{store:s}=(0,ta.O)(),[t,n]=(0,r.useState)(""),[i,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(!1),d=a=>{let r=a||t;if(!r.trim())return;l(!0);let i=r.trim().toLowerCase(),o=r.trim(),{projectWorkspaceId:c,currentWorkspaceId:d}=s.getState();V.Ay.capture("mcp_custom_integration_request",{integration_name:i,raw_input:o,project_id:e,workspace_id:c||d});try{let e=localStorage.getItem("mcp_custom_requests"),s=[...e?JSON.parse(e):[],o];localStorage.setItem("mcp_custom_requests",JSON.stringify(s))}catch(e){}n(""),l(!1),H.toast.success("Request submitted!",{description:"We'll notify you when ".concat(o," integration is available.")})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsxs)("div",{className:"flex w-full items-center rounded-lg border border-muted bg-background p-3",children:[(0,a.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,a.jsxs)("h3",{className:"mb-2 flex items-center gap-2 text-lg font-medium",children:[(0,a.jsx)("div",{className:"mr-2 h-2 w-2 rounded-full bg-green-500"}),"Missing an integration?"]}),(0,a.jsx)("span",{className:"ml-6 text-sm text-muted-foreground",children:"Request new integrations or support the ones you care about."})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(h.$,{size:"sm",onClick:()=>c(!0),className:"ml-4 bg-muted p-5 text-sm text-secondary-foreground hover:bg-muted",children:"Request"})})]})}),(0,a.jsx)(eK.lG,{open:o,onOpenChange:c,children:(0,a.jsxs)(eK.Cf,{size:"sm",children:[(0,a.jsxs)(eK.c7,{children:[(0,a.jsx)(eK.L3,{children:"Request an integration"}),(0,a.jsx)(eK.rr,{children:"Tell us what integration you'd like to see added to Lovable."})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)(sl.p,{placeholder:"e.g. Slack, Stripe, Figma...",value:t,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"===e.key&&t.trim()&&(d(t),c(!1),n(""))},disabled:i,autoFocus:!0})}),(0,a.jsxs)(eK.Es,{children:[(0,a.jsx)(h.$,{variant:"outline",onClick:()=>{c(!1),n("")},children:"Cancel"}),(0,a.jsx)(h.$,{onClick:()=>{t.trim()&&(d(t),c(!1),n(""))},disabled:!t.trim()||i,children:"Submit"})]})]})})]})}function tn(e){let{workspaceId:s}=e,[t,n]=(0,r.useState)("all"),[i,l]=(0,r.useState)(""),o=Array.from(new Set(s8.i.map(e=>e.category))),c=s8.i.filter(e=>{let s="all"===t||e.category===t,a=""===i||e.title.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase());return s&&a});return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Connections"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Connect powerful third-party apps to make your Lovable app more powerful."})]}),(0,a.jsxs)("a",{href:"https://docs.lovable.dev/integrations/mcp",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm text-muted-foreground duration-150 ease-in-out hover:text-muted-foreground/80",children:[(0,a.jsx)(p.A,{name:"help",size:"small"}),"Docs"]})]})}),(0,a.jsxs)("div",{className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)(sU.tU,{value:t,onValueChange:n,children:(0,a.jsxs)(sU.j7,{className:"w-full bg-muted sm:w-auto",children:[(0,a.jsx)(sU.Xi,{value:"all",children:"All"}),o.map(e=>(0,a.jsx)(sU.Xi,{value:e,children:e},e))]})}),(0,a.jsxs)("div",{className:"relative w-full sm:w-60 md:w-72",children:[(0,a.jsx)(sl.p,{value:i,onChange:e=>l(e.target.value),placeholder:"Search connections...",className:"pl-8"}),(0,a.jsx)("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 transform",children:(0,a.jsx)(p.A,{name:"search",size:"small",className:"text-muted-foreground"})})]})]}),(0,a.jsx)("div",{className:"grid gap-5 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:c.map(e=>(0,a.jsx)(tt,{id:e.id,title:e.title,description:e.description,icon:e.icon,serverUrl:e.serverUrl,workspaceId:s},e.id))}),(0,a.jsx)(tr,{})]})}let ti=e=>{let{workspace:s,open:t,onOpenChange:n}=e,[i,l]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[x,g]=(0,r.useState)(""),j=(0,ef.jE)(),{handleConnect:f}=(0,te.jj)(s.id,{testConnection:!0}),v=(0,eO.n)({mutationFn:async()=>{let e="mcp_".concat(i.toLowerCase().replace(" ","_"));try{let t=(0,m.P)();await t.post("/workspaces/".concat(s.id,"/integrations/mcp"),{name:e,url:o,...x.trim()&&{token:x}});return}catch(s){if(!(await (0,te.Ge)(o)).authMetadata)throw Error("Server connection failed. Please provide a bearer token or use a server that supports OAuth.",{cause:s});await f(e,o)}},onSuccess:()=>{j.invalidateQueries({queryKey:["mcp-servers",s.id]}),H.toast.success("MCP server added successfully"),n(!1),l(""),c(""),g(""),u(!1)},onError:e=>{var s,t;H.toast.error((null==(t=e.response)||null==(s=t.data)?void 0:s.error)||"Failed to add MCP server")}}),y=()=>{n(!1),setTimeout(()=>{l(""),c(""),g(""),u(!1)},200)};return(0,a.jsx)(eK.lG,{open:t,onOpenChange:y,children:(0,a.jsx)(eK.Cf,{className:"sm:max-w-[525px]",children:(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!i.trim()||!o.trim())return void H.toast.error("Please fill in all fields");v.mutate()},children:[(0,a.jsxs)(eK.c7,{children:[(0,a.jsx)(eK.L3,{children:"Add MCP Server"}),(0,a.jsx)(eK.rr,{children:"Connect to a remote MCP server to extend the AI's capabilities."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(sC.Label,{htmlFor:"name",children:"Server Name"}),(0,a.jsx)(sl.p,{id:"name",placeholder:"My MCP Server",value:i,onChange:e=>l(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(sC.Label,{htmlFor:"url",children:"Server URL"}),(0,a.jsx)(sl.p,{id:"url",type:"url",placeholder:"https://mcp.example.com",value:o,onChange:e=>c(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(h.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(!d),className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground",children:[(0,a.jsx)(p.A,{name:d?"keyboard_arrow_up":"keyboard_arrow_down",className:"h-4 w-4"}),"Advanced Settings"]}),d&&(0,a.jsx)("div",{className:"grid gap-2 pl-6",children:(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(sC.Label,{htmlFor:"manual-token",children:"Bearer Token (Optional)"}),(0,a.jsx)(sl.p,{id:"manual-token",type:"password",placeholder:"Enter Bearer token or API key",value:x,onChange:e=>g(e.target.value)}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Some MCP servers use API keys as Bearer tokens instead of OAuth. If your server requires a token, enter it here."})]})})]})]}),(0,a.jsxs)(eK.Es,{children:[(0,a.jsx)(h.$,{type:"button",variant:"outline",onClick:y,children:"Cancel"}),(0,a.jsx)(h.$,{type:"submit",disabled:v.isPending,children:v.isPending?"Adding...":"Add Server"})]})]})})})},tl=e=>{let{workspace:s,isWorkspaceAdmin:t}=e,n=(0,ef.jE)(),[i,l]=(0,r.useState)(new Set),{data:o,isLoading:c}=(0,u.I)({queryKey:["mcp-servers",s.id],queryFn:async()=>{let e=(0,m.P)();return(await e.get("/workspaces/".concat(s.id,"/integrations/mcp"))).servers||[]}}),d=(0,eO.n)({mutationFn:async e=>{let t=(0,m.P)();await t.delete("/workspaces/".concat(s.id,"/integrations/mcp/").concat(e))},onSuccess:()=>{n.invalidateQueries({queryKey:["mcp-servers",s.id]}),H.toast.success("Connection removed successfully")},onError:()=>{H.toast.error("Failed to remove connection")}});return c?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(sO.I,{text:"Loading connections..."})}):o&&0!==o.length?(0,a.jsx)("div",{className:"space-y-4",children:o.map(e=>{let s=i.has(e.name),r=e.tools&&e.tools.length>0;return(0,a.jsxs)("div",{className:"overflow-hidden rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"flex flex-1 items-center gap-3",children:[(0,a.jsx)(p.A,{name:"cloud",className:"h-5 w-5 flex-shrink-0 text-muted-foreground"}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name.replace("mcp_","")}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)("span",{className:"truncate",children:e.url}),r&&(0,a.jsxs)("span",{className:"flex-shrink-0",children:["• ",e.tools.length," tools"]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,a.jsx)(h.$,{variant:"ghost",size:"sm",onClick:()=>(e=>{let s=new Set(i);s.has(e)?s.delete(e):s.add(e),l(s)})(e.name),children:(0,a.jsx)(p.A,{name:s?"keyboard_arrow_up":"keyboard_arrow_down",className:"h-4 w-4"})}),t&&(0,a.jsx)(h.$,{variant:"ghost",size:"sm",onClick:()=>d.mutate(e.name),disabled:d.isPending,children:(0,a.jsx)(p.A,{name:"delete"})})]})]}),s&&r&&(0,a.jsx)("div",{className:"border-t bg-muted/30 px-4 py-3",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h5",{className:"mb-2 text-sm font-medium",children:"Available Tools"}),(0,a.jsx)("div",{className:"space-y-1",children:e.tools.map((e,s)=>(0,a.jsxs)("div",{className:"border-l-2 border-muted py-1 pl-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]},s))})]})})]},e.name)})}):(0,a.jsxs)("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[(0,a.jsx)(p.A,{name:"cloud",className:"mx-auto h-12 w-12 text-muted-foreground/50"}),(0,a.jsx)("h3",{className:"mt-4 text-base font-medium",children:"No connections connected"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:t?"Get started by adding your first connections.":"Ask your workspace admin to add first connections."})]})},to=e=>{let{workspace:s,myWorkspaceRole:t}=e,[n,i]=(0,r.useState)(!1),l=(0,e5.j$)(),o=(0,e5.J6)(),d="admin"===t||"owner"===t;return(0,a.jsxs)(c.Pt,{value:"mcp",children:[(0,a.jsx)(ti,{workspace:s,open:n,onOpenChange:i}),(0,a.jsxs)("div",{className:"space-y-6",children:[o&&d&&(0,a.jsx)("div",{className:"rounded-lg border p-6",children:(0,a.jsx)(tn,{workspaceId:s.id})}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"rounded-lg border p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Connections"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Add connections to extend the AI's capabilities with custom tools."})]}),d&&(0,a.jsx)(h.$,{onClick:()=>i(!0),className:"w-full sm:w-auto",children:"Add MCP Server"})]})}),(0,a.jsx)(tl,{workspace:s,isWorkspaceAdmin:d})]})]})]})},tc=e=>{let{workspace:s,isInsideEditor:t,myWorkspaceRole:n,project:i}=e,[l,o]=(0,r.useState)([]),[d,u]=(0,r.useState)(!1),x=(0,eD.R)(),[g,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[y,b]=(0,r.useState)({}),[w,N]=(0,r.useState)(""),[C,k]=(0,r.useState)("");(0,r.useEffect)(()=>{(null==i?void 0:i.id)&&_()},[null==i?void 0:i.id]);let _=async()=>{if(null==i?void 0:i.id){u(!0);try{let e=(0,m.P)(),s=(await e.get("/projects/".concat(i.id,"/integrations/memory"))||[]).sort((e,s)=>new Date(s.updated_at).getTime()-new Date(e.updated_at).getTime());o(s)}catch(e){H.toast.error("Failed to load memories")}finally{u(!1)}}},S=async e=>{if(null==i?void 0:i.id)try{let s=(0,m.P)();await s.post("/projects/".concat(i.id,"/integrations/memory"),e);let t=e.sort((e,s)=>new Date(s.updated_at).getTime()-new Date(e.updated_at).getTime());o(t),H.toast.success("Memories updated successfully")}catch(e){throw H.toast.error("Failed to save memories"),e}},I=async()=>{if(!w||!C)return void H.toast.error("Path and content are required");if(l.some(e=>e.path===w))return void H.toast.error("A memory with this path already exists");let e={path:w,content:C,updated_at:new Date().toISOString()};try{await S([...l,e]),N(""),k("")}catch(e){}},E=e=>{b({[e.path]:{path:e.path,content:e.content,originalPath:e.path,originalContent:e.content}})},A=async e=>{let s=y[e];if(s){if(s.path!==e&&l.some(e=>e.path===s.path))return void H.toast.error("A memory with this path already exists");try{let t=l.map(t=>t.path===e?{path:s.path,content:s.content,updated_at:new Date().toISOString()}:t);await S(t);let a={...y};delete a[e],b(a)}catch(e){}}},P=async()=>{if(f)try{let e=l.filter(e=>e.path!==f);await S(e),v(null),j(!1)}catch(e){}};return(0,a.jsx)(sb.Bc,{children:(0,a.jsx)(c.Pt,{value:"memory",title:"Memory",description:"Manage memory files that help Lovable remember important context about your project.",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)("div",{className:"flex w-full flex-col gap-0",children:[(0,a.jsx)(sl.p,{placeholder:"Untitled Memory",value:w,onChange:e=>N(e.target.value),disabled:x,className:"h-10 rounded-b-none border-border font-medium placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0"}),(0,a.jsx)(em.T,{placeholder:"Remember that...",className:"min-h-40 resize-none rounded-b-lg rounded-t-none border border-t-0 border-border bg-background p-3 font-mono text-[13px] placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0",value:C,onChange:e=>k(e.target.value),disabled:x})]}),(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)("span",{className:"cursor-not-allowed",children:(0,a.jsx)(h.$,{size:"icon-sm",variant:"ghost",disabled:x||!w||!C,onClick:I,children:(0,a.jsx)(p.A,{name:"add_2",size:"default"})})})}),(0,a.jsx)(sb.ZI,{children:x?"Wait for Lovable to finish working":"Add a title and content to save the memory"})]})]}),d?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(p.A,{name:"progress_activity",className:"h-6 w-6 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading memories..."})]}):(0,a.jsx)(a.Fragment,{children:l.map(e=>{var s,t;let r=y[e.path],n=null!=(s=null==r?void 0:r.path)?s:e.path,i=null!=(t=null==r?void 0:r.content)?t:e.content;return(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)("div",{className:"flex w-full flex-col gap-0",children:[(0,a.jsx)(sl.p,{value:n,onChange:r?s=>b({...y,[e.path]:{...y[e.path],path:s.target.value}}):void 0,className:"h-10 rounded-b-none border-border font-medium placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0 ".concat(r?"":"cursor-text"),disabled:x,readOnly:!r,onClick:()=>!x&&!r&&E(e)}),(0,a.jsx)(em.T,{value:i,onChange:r?s=>b({...y,[e.path]:{...y[e.path],content:s.target.value}}):void 0,className:"min-h-40 resize-none rounded-b-lg rounded-t-none border border-t-0 border-border bg-background p-3 font-mono text-[13px] placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0 ".concat(r?"":"cursor-text"),disabled:x,readOnly:!r,onClick:()=>!x&&!r&&E(e)})]}),r&&(e=>{let s=y[e];return!!s&&(s.path!==s.originalPath||s.content!==s.originalContent)})(e.path)?(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"ghost",size:"icon-sm",onClick:()=>A(e.path),disabled:x,children:(0,a.jsx)(p.A,{name:"check",size:"default"})})}),(0,a.jsx)(sb.ZI,{children:x?"Wait for Lovable to finish working":"Save changes"})]}),(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"ghost",size:"icon-sm",onClick:()=>(e=>{let s={...y};delete s[e],b(s)})(e.path),disabled:x,children:(0,a.jsx)(p.A,{name:"close",size:"default"})})}),(0,a.jsx)(sb.ZI,{children:x?"Wait for Lovable to finish working":"Discard changes"})]})]}):(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"ghost",size:"icon-sm",onClick:()=>{v(e.path),j(!0)},disabled:x,children:(0,a.jsx)(p.A,{name:"delete",size:"default"})})}),(0,a.jsx)(sb.ZI,{children:x?"Can't delete memories while Lovable is working":"Delete memory"})]})]},e.path)})}),(0,a.jsx)(eK.lG,{open:g,onOpenChange:j,children:(0,a.jsxs)(eK.Cf,{children:[(0,a.jsxs)(eK.c7,{children:[(0,a.jsx)(eK.L3,{children:"Delete Memory"}),(0,a.jsxs)(eK.rr,{children:['Are you sure you want to delete "',f,'"? This action cannot be undone.']})]}),(0,a.jsxs)(eK.Es,{children:[(0,a.jsx)(h.$,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),(0,a.jsx)(h.$,{variant:"destructive",onClick:P,children:"Delete"})]})]})})]})})})};var td=t(69201),tu=t(14090),tm=t(2904),th=t(54225),tx=t(58873);let tp=e=>{let{projectId:s}=e,t=(0,th.wV)(e=>e.isSendChatMessageMutationPending);return(0,a.jsx)(ee.m,{label:"Disconnect Project",description:"Remove the Supabase project from this Lovable project.",justify:"end",children:(0,a.jsx)(tx.s,{projectId:s,disabled:t})})};var tg=t(88467),tj=t(52983);let tf=e=>{let{isConnectedToSupabase:s}=e,[t,n]=(0,tj.V)("supabase-explainer",{defaultValue:!0}),[i,l]=(0,r.useState)(!1);return s||!t?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"rounded-md border border-border/50 bg-muted/20 p-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,a.jsx)(p.A,{name:"info",size:"small",className:"text-muted-foreground"}),(0,a.jsx)("h3",{className:"text-sm font-medium",children:"What is Supabase?"}),(0,a.jsx)(h.$,{variant:"ghost",className:"ml-auto hover:bg-transparent",size:"icon-sm",onClick:()=>n(!1),children:(0,a.jsx)(p.A,{name:"close",size:"small",className:"text-muted-foreground"})})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supabase is a complete platform for building apps with user authentication, data storage, and other backend capabilities. Connecting it to your Lovable project will enable you to build more advanced apps and support things such as AI features and payments."}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 pt-2",children:[(0,a.jsxs)("a",{href:"https://docs.lovable.dev/integrations/supabase",target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 rounded-md bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20",children:[(0,a.jsx)(p.A,{name:"menu_book",size:"small"}),"See docs"]}),(0,a.jsxs)("button",{onClick:()=>l(!0),className:"inline-flex items-center gap-1.5 rounded-md bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20",children:[(0,a.jsx)(p.A,{name:"play_circle",size:"small"}),"Watch tutorial"]})]})]})}),(0,a.jsx)(eK.lG,{open:i,onOpenChange:l,children:(0,a.jsx)(eK.Cf,{className:"max-w-4xl p-0",children:(0,a.jsx)("div",{className:"aspect-video w-full",children:(0,a.jsx)("iframe",{src:"https://www.youtube.com/embed/eVHg4wipRrU",title:"Supabase Tutorial",className:"h-full w-full rounded-lg",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})]})},tv=e=>{var s,t;let{workspace:r,myWorkspaceRole:n,setShowConnectDialog:i}=e,l=(0,ep.Iw)(e=>e.project),o=null==l?void 0:l.supabase_project_config,c=!!(null==l?void 0:l.is_supabase_enabled),d=(0,tm.G)({workspaceId:r.id}),u=null==o?void 0:o.supabase_project_id,x=null==l?void 0:l.id,p=(0,eO.n)({mutationFn:()=>(0,m.P)().post("/projects/".concat(x,"/supabase/disconnect")),onSuccess:()=>{(0,H.toast)("Supabase disconnected",{description:"You can connect to a new Supabase project later."})},onError:e=>{H.toast.error("Error",{description:e.message})}}),g=null==(s=d.supabaseOrganizations)?void 0:s.find(e=>e.id===(null==o?void 0:o.supabase_organization_id));if(!l)return null;if(c)return(0,a.jsx)("div",{className:"text-sm",children:"Unfortunately, your project is not able to use Supabase."});let j=d.noOrganizations;return d.isLoading?(0,a.jsx)(sO.I,{text:"Loading Supabase..."}):(0,a.jsxs)(a.Fragment,{children:[!g&&!!(null==o?void 0:o.supabase_organization_id)&&(0,a.jsxs)(tu.Fc,{variant:"destructive",children:[(0,a.jsx)(tu.XL,{children:"Problem with your Supabase connection"}),(0,a.jsxs)(tu.TN,{children:[(0,a.jsxs)("p",{children:["This project is connected to Supabase organization"," ",(0,a.jsx)("span",{className:"rounded-md bg-muted px-1 py-0.5 font-mono font-medium text-muted-foreground",children:null==o?void 0:o.supabase_organization_id}),", but this workspace is not connected to that organization. Disconnect the project or add the organization again."]}),(0,a.jsx)("div",{className:"mt-4 flex",children:(0,a.jsx)(h.$,{variant:"destructive",onClick:()=>p.mutate(),disabled:p.isPending,size:"sm",children:"Disconnect"})})]})]}),(0,a.jsx)(tf,{isConnectedToSupabase:!d.noOrganizations}),!j&&(0,a.jsx)(tg.X,{workspaceId:r.id,supabaseOrganizations:null!=(t=d.supabaseOrganizations)?t:[],supabaseConfig:null!=o?o:null,setShowConnectDialog:i,isWorkspaceAdmin:"admin"===n||"owner"===n}),u&&(0,a.jsx)(tp,{projectId:null==l?void 0:l.id})]})};var ty=t(31196);let tb=e=>{var s;let{workspace:t,myWorkspaceRole:r,setShowConnectDialog:n}=e,{isLoading:i,noOrganizations:l}=(0,tm.G)({workspaceId:t.id}),{handleConnect:o,isConnecting:c}=(0,ty.UO)(null!=(s=null==t?void 0:t.id)?s:""),d="admin"===r||"owner"===r;return(0,a.jsx)(ee.m,{label:"Organizations",description:"Connected Supabase organizations will be accessible to all members in this workspace.",justify:"end",badges:["admin"],children:i?(0,a.jsx)(F.E,{className:"h-7 w-40"}):l?(0,a.jsxs)(h.$,{disabled:c||!d,onClick:()=>o(),size:"sm",loading:c,children:[(0,a.jsx)(e4.Xy.Supabase,{className:"h-4 w-4"}),"Connect Supabase"]}):(0,a.jsx)(h.$,{disabled:c||!d,onClick:()=>n(!0),size:"sm",variant:"outline",children:"Manage Connected Organizations"})})},tw=e=>{let{workspace:s,myWorkspaceRole:t,isInsideEditor:r,showConnectDialog:n,setShowConnectDialog:i}=e;return(0,a.jsx)(tb,{workspace:s,myWorkspaceRole:t,isInsideEditor:r,showConnectDialog:n,setShowConnectDialog:i})};var tN=t(43724),tC=t(91253);let tk=e=>{let{workspace:s,project:t,isInsideEditor:n,myWorkspaceRole:i}=e,[l,o]=(0,r.useState)(!1),d=(0,td.D)(t),u=(0,r.useCallback)(()=>{n&&o(!0)},[n]);(0,tm.f)({workspaceId:s.id,onConnectSuccess:u});let m=(0,eA.WW)()||"admin"===i||"owner"===i;return(0,a.jsx)(c.Pt,{value:"supabase",title:"Supabase",description:"Integrate user authentication, data storage, and backend capabilities.",docsLink:"https://docs.lovable.dev/integrations/supabase",children:(0,a.jsxs)(a.Fragment,{children:[t&&!d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tN.A,{workspace:s,showConnectDialog:l,setShowConnectDialog:o}),(0,a.jsx)(tv,{workspace:s,myWorkspaceRole:i,setShowConnectDialog:o})]}),(0,a.jsx)(tC.J,{workspace:s,showConnectDialog:l,setShowConnectDialog:o,isAdmin:m}),(0,a.jsx)(tw,{workspace:s,myWorkspaceRole:i,isInsideEditor:n,showConnectDialog:l,setShowConnectDialog:o})]})})};var t_=t(4745),tS=t(42007);let tI=tS.bL;tS.l9;let tE=tS.ZL,tA=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(tS.hJ,{className:(0,ex.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:s})});tA.displayName=tS.hJ.displayName;let tP=r.forwardRef((e,s)=>{let{className:t,overlayClassName:r,...n}=e;return(0,a.jsxs)(tE,{children:[(0,a.jsx)(tA,{className:r}),(0,a.jsx)(tS.UC,{ref:s,className:(0,ex.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n})]})});tP.displayName=tS.UC.displayName;let tD=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,ex.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};tD.displayName="AlertDialogHeader";let tT=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,ex.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};tT.displayName="AlertDialogFooter";let tL=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(tS.hE,{ref:s,className:(0,ex.cn)("text-lg font-medium",t),...r})});tL.displayName=tS.hE.displayName;let tz=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(tS.VY,{ref:s,className:(0,ex.cn)("text-sm text-muted-foreground",t),...r})});tz.displayName=tS.VY.displayName;let tR=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(tS.rc,{ref:s,className:(0,ex.cn)((0,h.r)(),t),...r})});tR.displayName=tS.rc.displayName;let tO=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(tS.ZD,{ref:s,className:(0,ex.cn)((0,h.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...r})});tO.displayName=tS.ZD.displayName;var tF=t(20234);let tM=e=>{let{workspace:s,domain:t,setDomain:r,verified:n,verificationError:i,isVerifying:l,onVerify:o,onCancel:c,onContinue:d}=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"domain",children:"Domain"}),(0,a.jsx)(sl.p,{id:"domain",value:t,onChange:e=>r(e.target.value),placeholder:"yourdomain.com",disabled:n,className:"mt-1"})]}),!n&&(0,a.jsxs)(tu.Fc,{children:[(0,a.jsx)(p.A,{name:"info",size:"small"}),(0,a.jsx)(tu.XL,{children:"Domain Verification Required"}),(0,a.jsxs)(tu.TN,{children:["To verify your domain, add the following TXT record to your DNS provider:",(0,a.jsxs)("div",{className:"mt-2 flex gap-2 rounded bg-muted p-2 font-mono text-sm text-foreground",children:[(0,a.jsx)("div",{children:"TXT"}),(0,a.jsx)("div",{children:"@"}),(0,a.jsxs)("div",{className:"break-all",children:["lovable_verification=",s.id]})]}),(0,a.jsx)("p",{className:"mt-2 text-xs",children:"DNS changes may take a few minutes to propagate."})]})]}),i&&(0,a.jsxs)(tu.Fc,{variant:"destructive",children:[(0,a.jsx)(p.A,{name:"info",size:"small"}),(0,a.jsx)(tu.XL,{children:"Verification Failed"}),(0,a.jsx)(tu.TN,{children:i})]}),n&&(0,a.jsxs)(tu.Fc,{variant:"success",children:[(0,a.jsx)(p.A,{name:"check"}),(0,a.jsx)(tu.XL,{children:"Domain Verified!"}),(0,a.jsx)(tu.TN,{children:"Your domain has been successfully verified."})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(h.$,{variant:"outline",onClick:c,children:"Cancel"}),(0,a.jsxs)("div",{className:"space-x-2",children:[!n&&(0,a.jsx)(h.$,{onClick:o,disabled:l||!t,loading:l,children:l?"Verifying...":"Verify Domain"}),n&&(0,a.jsx)(h.$,{onClick:d,children:"Continue"})]})]})]})},tU=e=>{let{form:s,onSubmit:t,onTestIssuer:r,isTestingIssuer:n,onBack:i,showTestButton:l=!0,submitButtonText:o="Configure Provider",submitButtonDisabled:c=!1}=e,{register:d,handleSubmit:u,formState:{errors:m,isSubmitting:x},watch:g}=s,j=g("issuer"),f=g("clientId"),v=g("clientSecret"),y=!!(j&&f&&v);return(0,a.jsxs)("form",{className:"space-y-4",onSubmit:u(t),noValidate:!0,children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-xl font-medium",children:"Enter OIDC Configuration"}),(0,a.jsx)("p",{className:"text-sm",children:"Copy these values from your identity provider's OAuth/OIDC application settings."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"issuer",children:"OIDC Issuer URL / Discovery Endpoint*"}),(0,a.jsx)(sl.p,{id:"issuer",...d("issuer",{required:"Issuer URL is required",pattern:{value:/^https:\/\/.+/,message:"URL must start with https://"},validate:e=>{try{return new URL(e),!0}catch(e){return"Please enter a valid URL."}}}),placeholder:"https://idp.example.com",className:"mt-1"}),m.issuer&&(0,a.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:m.issuer.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"clientId",children:"OAuth Client ID / Application ID*"}),(0,a.jsx)(sl.p,{id:"clientId",...d("clientId",{required:"Client ID is required"}),placeholder:"1234567890.apps.provider.com",className:"mt-1"}),m.clientId&&(0,a.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:m.clientId.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"clientSecret",children:"OAuth Client Secret*"}),(0,a.jsx)(sl.p,{id:"clientSecret",type:"password",...d("clientSecret",{required:"Client Secret is required"}),placeholder:"Enter your client secret",className:"mt-1"}),m.clientSecret&&(0,a.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:m.clientSecret.message})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,a.jsxs)(h.$,{variant:"outline",onClick:i,type:"button",children:[(0,a.jsx)(p.A,{name:"arrow_left_alt",size:"small"}),"Back"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[l&&(0,a.jsxs)(sb.m_,{children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)("span",{children:(0,a.jsxs)(h.$,{type:"button",variant:"secondary",onClick:r,disabled:!y||n,loading:n,children:[(0,a.jsx)(p.A,{name:"science",size:"small"}),n?"Testing...":"Test Configuration"]})})}),!y&&(0,a.jsx)(sb.ZI,{children:"Please fill in all required fields (Issuer, Client ID, and Client Secret)"})]}),(0,a.jsxs)(h.$,{type:"submit",disabled:x||c,variant:c?"outline":"default",children:[c&&!x&&(0,a.jsx)(p.A,{name:"lock",size:"small"}),o]})]})]})]})},tB=e=>{let{authRedirectUrl:s,onNext:t,onBack:n}=e,[i,l]=(0,r.useState)(1),o=async(e,s)=>{await navigator.clipboard.writeText(e),H.toast.success("".concat(s," copied to clipboard"))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)("h3",{className:"text-xl font-medium",children:"Set up OIDC in your identity provider before proceeding."})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-2 flex-1 rounded-full ".concat(e<=i?"bg-primary":"bg-muted")},e))}),1===i&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-base",children:"Create New Application"})}),(0,a.jsx)(tF.Wu,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Create a new application with these settings:"}),(0,a.jsxs)("div",{className:"grid max-w-md grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:[(0,a.jsx)("span",{className:"text-sm",children:"Application Type"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(sY.E,{variant:"secondary",className:"text-sm",children:"Web Application"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"or"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"text-sm",children:"Server-side Application"})]}),(0,a.jsx)("span",{className:"text-sm",children:"Grant Type"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"w-fit text-sm",children:"Authorization Code"}),(0,a.jsx)("span",{className:"text-sm",children:"Token Method"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(sY.E,{variant:"secondary",className:"text-sm",children:"POST"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(if configurable)"})]})]})]})})]}),2===i&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-base",children:"Add Redirect URI"})}),(0,a.jsx)(tF.Wu,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"space-y-2 rounded-md border p-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Copy this URL to your application's redirect/callback settings:"}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-md bg-muted/50 p-2",children:[(0,a.jsx)("code",{className:"text-sm",children:s}),(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(s,"Redirect URI"),children:(0,a.jsx)(p.A,{name:"content_copy",size:"small"})})]}),(0,a.jsx)("p",{className:"text-xs",children:"The URL must match exactly, including the protocol (https://)."})]})})]}),3===i&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-base",children:"Enable OAuth Scopes"})}),(0,a.jsxs)(tF.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Enable these OAuth scopes:"}),(0,a.jsxs)("div",{className:"grid max-w-xs grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:[(0,a.jsx)("code",{className:"text-sm font-medium",children:"openid"}),(0,a.jsx)(sY.E,{variant:"default",className:"w-fit text-xs",children:"Required"}),(0,a.jsx)("code",{className:"text-sm font-medium",children:"email"}),(0,a.jsx)(sY.E,{variant:"default",className:"w-fit text-xs",children:"Required"}),(0,a.jsx)("code",{className:"text-sm font-medium",children:"profile"}),(0,a.jsx)(sY.E,{variant:"outline",className:"w-fit text-xs",children:"Recommended"})]})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,a.jsx)("strong",{children:"Note:"})," The profile scope enables user names and profile pictures to display correctly."]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,a.jsxs)(h.$,{variant:"outline",onClick:()=>{i>1?l(i-1):n()},children:[(0,a.jsx)(p.A,{name:"arrow_left_alt",size:"small"}),"Back"]}),(0,a.jsxs)(h.$,{onClick:()=>{i<3?l(i+1):t()},children:[i<3?"Next":"I've Configured My IdP",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})]})]})},t$=e=>{let{onSelectType:s,onBack:t}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-xl font-medium",children:"Choose SSO Protocol"}),(0,a.jsx)("p",{className:"text-sm",children:"Select the Single Sign-On protocol that your identity provider supports."}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Both protocols are supported by Okta, Entra ID, Google Workspace, Auth0, Keycloak, and all modern identity providers."})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)(tF.Zp,{className:"relative cursor-pointer border-2 transition-all hover:border-primary/50 hover:bg-accent/50",children:[(0,a.jsx)("div",{className:"absolute right-3 top-3",children:(0,a.jsx)(sY.E,{variant:"default",className:"text-sm font-medium",children:"Recommended"})}),(0,a.jsx)(tF.aR,{className:"pb-3",children:(0,a.jsxs)(tF.ZB,{className:"flex items-center gap-2 text-base",children:[(0,a.jsx)("div",{className:"rounded-md bg-blue-100 p-2 dark:bg-blue-900/20",children:(0,a.jsx)(p.A,{name:"security",className:"text-blue-600 dark:text-blue-400"})}),"OpenID Connect (OIDC)"]})}),(0,a.jsxs)(tF.Wu,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"Modern OAuth 2.0-based protocol with built-in identity layer."}),(0,a.jsxs)(h.$,{className:"w-full",onClick:()=>s("oidc"),children:["Configure OIDC",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})]})]}),(0,a.jsxs)(tF.Zp,{className:"cursor-pointer border-2 transition-all hover:border-primary/50 hover:bg-accent/50",children:[(0,a.jsx)(tF.aR,{className:"pb-3",children:(0,a.jsxs)(tF.ZB,{className:"flex items-center gap-2 text-base",children:[(0,a.jsx)("div",{className:"rounded-md bg-orange-100 p-2 dark:bg-orange-900/20",children:(0,a.jsx)(p.A,{name:"shield",className:"text-orange-600 dark:text-orange-400"})}),"SAML 2.0"]})}),(0,a.jsxs)(tF.Wu,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"XML-based protocol for single sign-on."}),(0,a.jsxs)(h.$,{variant:"outline",className:"w-full",onClick:()=>s("saml"),children:["Configure SAML",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})]})]})]}),(0,a.jsx)("div",{className:"flex justify-start pt-4",children:(0,a.jsxs)(h.$,{variant:"outline",onClick:t,children:[(0,a.jsx)(p.A,{name:"arrow_left_alt",size:"small"}),"Back"]})})]})},tW=e=>{let{form:s,onSubmit:t,onBack:r,authRedirectUrl:n}=e,{register:i,handleSubmit:l,formState:{errors:o,isSubmitting:c}}=s;return(0,a.jsxs)("form",{className:"space-y-4",onSubmit:l(t),noValidate:!0,children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-xl font-medium",children:"Enter SAML Configuration"}),(0,a.jsx)("p",{className:"text-sm",children:"Copy these values from your identity provider's SAML application settings."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"signOnUrl",children:"SAML SSO Sign-on URL (from your IdP)*"}),(0,a.jsx)(sl.p,{id:"signOnUrl",...i("signOnUrl",{required:"SSO Sign-on URL is required",pattern:{value:/^https:\/\/.+/,message:"URL must start with https://"},validate:e=>{try{return new URL(e),!0}catch(e){return"Please enter a valid URL."}}}),placeholder:"https://idp.example.com/saml/sso",className:"mt-1"}),o.signOnUrl&&(0,a.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:o.signOnUrl.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"entityId",children:"Identity Provider Entity ID / Issuer*"}),(0,a.jsx)(sl.p,{id:"entityId",...i("entityId",{required:"Identity Provider Entity ID is required"}),placeholder:"https://idp.example.com/metadata or urn:example:saml:idp",className:"mt-1"}),o.entityId&&(0,a.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:o.entityId.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(sC.Label,{htmlFor:"x509Certificate",children:"X.509 Signing Certificate (public key)*"}),(0,a.jsx)(em.T,{id:"x509Certificate",...i("x509Certificate",{required:"X.509 Certificate is required",validate:e=>{let s=e.trim();return!!s.includes("BEGIN CERTIFICATE")&&!!s.includes("END CERTIFICATE")||"Please provide a valid X.509 certificate in PEM format"}}),placeholder:"-----BEGIN CERTIFICATE-----\nMIIDEzCCAfugAwIBAgIQKiw9f...\n-----END CERTIFICATE-----",className:"mt-1 h-32 font-mono text-xs",rows:8}),o.x509Certificate&&(0,a.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:o.x509Certificate.message})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,a.jsxs)(h.$,{variant:"outline",onClick:r,type:"button",children:[(0,a.jsx)(p.A,{name:"arrow_left_alt",size:"small"}),"Back"]}),(0,a.jsx)(h.$,{type:"submit",disabled:c,loading:c,children:c?"Configuring...":"Configure SAML Provider"})]})]})},tG=e=>{let{authRedirectUrl:s,onNext:t,onBack:n}=e,[i,l]=(0,r.useState)(1),o=async(e,s)=>{await navigator.clipboard.writeText(e),H.toast.success("".concat(s," copied to clipboard"))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)("h3",{className:"text-xl font-medium",children:"Set up SAML in your identity provider."})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-2 flex-1 rounded-full ".concat(e<=i?"bg-primary":"bg-muted")},e))}),1===i&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-base",children:"Configure Service Provider Settings"})}),(0,a.jsxs)(tF.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"text-sm font-medium",children:"ACS URL (Assertion Consumer Service):"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-md border bg-muted/50 p-2",children:[(0,a.jsx)("code",{className:"text-sm",children:s}),(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(s,"ACS URL"),children:(0,a.jsx)(p.A,{name:"content_copy",size:"small"})})]}),(0,a.jsx)("p",{className:"text-xs",children:"Also known as: Reply URL, SSO URL, or Recipient URL"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"text-sm font-medium",children:"SP Entity ID / Audience URI:"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-md border bg-muted/50 p-2",children:[(0,a.jsx)("code",{className:"text-sm",children:s}),(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(s,"Entity ID"),children:(0,a.jsx)(p.A,{name:"content_copy",size:"small"})})]}),(0,a.jsx)("p",{className:"text-xs",children:"Also known as: Audience, Identifier, or SP Entity ID"})]}),(0,a.jsxs)("p",{className:"text-xs",children:[(0,a.jsx)("strong",{children:"Note:"})," Both ACS URL and Entity ID use the same value for Lovable."]})]})]}),2===i&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-base",children:"Configure Attribute Mappings"})}),(0,a.jsxs)(tF.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Add these attributes in your SAML application:"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:"Email"}),(0,a.jsx)(sY.E,{variant:"default",className:"text-xs",children:"Required"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("span",{children:"Already handled via Name ID - ensure format is set to"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"font-mono text-sm",children:"EmailAddress"})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(sY.E,{variant:"secondary",className:"font-mono text-sm",children:"displayName"}),(0,a.jsx)(sY.E,{variant:"outline",className:"text-xs",children:"Recommended"})]}),(0,a.jsx)("p",{className:"text-xs",children:"Map to user's full name (e.g., user.displayName)"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(sY.E,{variant:"secondary",className:"font-mono text-sm",children:"photoURL"}),(0,a.jsx)(sY.E,{variant:"outline",className:"text-xs",children:"Recommended"})]}),(0,a.jsx)("p",{className:"text-xs",children:"Map to user's profile picture URL"})]})]})]}),(0,a.jsxs)("p",{className:"text-xs",children:[(0,a.jsx)("strong",{children:"Note:"})," Use exact attribute names as shown above for proper integration."]})]})]}),3===i&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-base",children:"Protocol Settings"})}),(0,a.jsx)(tF.Wu,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Use these standard settings:"}),(0,a.jsxs)("div",{className:"grid max-w-sm grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:[(0,a.jsx)("span",{className:"text-sm",children:"Name ID Format"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"w-fit font-mono text-sm",children:"EmailAddress"}),(0,a.jsx)("span",{className:"text-sm",children:"Signature Algorithm"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"w-fit font-mono text-sm",children:"RSA-SHA256"}),(0,a.jsx)("span",{className:"text-sm",children:"SAML Binding"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"w-fit font-mono text-sm",children:"HTTP-POST"}),(0,a.jsx)("span",{className:"text-sm",children:"Response Signed"}),(0,a.jsx)(sY.E,{variant:"secondary",className:"w-fit text-xs",children:"Yes"})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,a.jsx)("strong",{children:"Note:"})," For Name ID Format, if asked for details use:"," ",(0,a.jsx)("code",{className:"text-xs",children:"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,a.jsxs)(h.$,{variant:"outline",onClick:()=>{i>1?l(i-1):n()},children:[(0,a.jsx)(p.A,{name:"arrow_left_alt",size:"small"}),"Back"]}),(0,a.jsxs)(h.$,{onClick:()=>{i<3?l(i+1):t()},children:[i<3?"Next":"I've Configured My IdP",(0,a.jsx)(p.A,{name:"arrow_outward",size:"small"})]})]})]})},tK=e=>{let{validationResult:s,verifiedDomains:t,providerType:r,displayName:n,onConfirm:i,onBack:l,isConfirming:o}=e,c="saml"===r||(null==s?void 0:s.auth_flow_ready)&&(null==s?void 0:s.client_secret_validation_status)==="validated"&&(null==s?void 0:s.required_scopes_available)!==!1&&(null==s?void 0:s.required_claims_available)!==!1,d="saml"!==r&&((null==s?void 0:s.required_scopes_available)===!1||(null==s?void 0:s.required_claims_available)===!1);return(0,a.jsxs)("div",{className:"space-y-6",children:[(s||"saml"===r)&&(0,a.jsxs)(tu.Fc,{variant:c?"default":d?"destructive":"warning",children:[(0,a.jsx)(p.A,{name:c?"check_circle":d?"error":"info",size:"small"}),(0,a.jsx)(tu.TN,{children:"saml"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"SAML Configuration Ready:"})," SAML authentication will be validated on first user login. Ensure your identity provider is properly configured with the provided ACS URL and Entity ID."]}):c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"OIDC Configuration Validated:"})," Your OIDC configuration has been successfully tested and verified."]}):(0,a.jsx)(a.Fragment,{children:(null==s?void 0:s.auth_flow_ready)?(null==s?void 0:s.client_secret_validation_status)==="invalid"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Invalid Client Secret:"})," The client secret appears to be invalid. Please verify it's correct before proceeding."]}):(null==s?void 0:s.required_scopes_available)===!1?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Missing Required Scopes:"})," Your provider doesn't support the required 'openid' and 'email' scopes. Authentication will not work without these scopes."]}):(null==s?void 0:s.required_claims_available)===!1?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Missing Required Claims:"})," Your provider doesn't support the required 'email' claim. Users won't be able to sign in without this claim."]}):(null==s?void 0:s.client_secret_validation_status)==="unavailable"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Configuration Ready:"})," Your configuration looks good! Your provider doesn't support pre-validation of the client secret (this is common). The credentials will be verified on first login. If you're confident your client secret is correct, you can proceed."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Configuration Notice:"})," Some aspects of the configuration couldn't be validated. If you believe your configuration is correct, you can proceed."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Configuration Issue:"})," The authorization flow couldn't be verified. Please ensure your Client ID and Redirect URI are correctly configured in your IdP."]})})})]}),(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsxs)(tF.ZB,{className:"flex items-center text-sm",children:[(0,a.jsx)(p.A,{name:"lock"}),"SSO Enforcement (Optional)"]})}),(0,a.jsxs)(tF.Wu,{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["After configuration is complete, you'll be able to ",(0,a.jsx)("strong",{children:"enforce SSO"})," as the only authentication method for this workspace."]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"When SSO enforcement is enabled:"}),(0,a.jsxs)("ul",{className:"ml-2 list-inside list-disc space-y-1 text-sm text-muted-foreground",children:[(0,a.jsx)("li",{children:"Email/password and other login methods will be disabled for this workspace"}),(0,a.jsx)("li",{children:"Users can link their existing Lovable accounts by signing in with SSO"})]})]})]}),(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsxs)(tF.ZB,{className:"flex items-center text-sm",children:[(0,a.jsx)(p.A,{name:"person_add"}),"Automatic User Provisioning (JIT)"]})}),(0,a.jsxs)(tF.Wu,{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,a.jsx)("strong",{children:"Just-In-Time provisioning is enabled by default."})," Users authenticating via SSO with verified domain emails will be automatically added to this workspace with default member permissions on their first login. Users with other domains will require manual invitation."]}),t.length>0&&(0,a.jsxs)("div",{className:"rounded bg-muted p-2 text-xs",children:[(0,a.jsx)("span",{className:"font-medium",children:"Auto-provision for: "}),t.map(e=>(0,a.jsxs)(sY.E,{variant:"secondary",className:"ml-1 text-xs",children:["@",e]},e))]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-1",children:[(0,a.jsx)(h.$,{variant:"outline",onClick:l,disabled:o,children:"Back"}),(0,a.jsx)(h.$,{onClick:i,disabled:o,loading:o,children:o?"Configuring...":"Confirm & Enable SSO"})]})]})},tq=e=>{let{validationResult:s,authRedirectUrl:t,isLocalhost:r}=e;return s.auth_flow_ready||!s.message?null:(0,a.jsxs)(tu.Fc,{variant:"warning",children:[(0,a.jsx)(p.A,{name:"info",size:"small"}),(0,a.jsx)(tu.XL,{className:"text-sm",children:(()=>{switch(s.auth_flow_error_type){case"redirect_uri":return"Client ID or Redirect URI Issue";case"client_id":return"Client ID Not Recognized";case"client_secret":return"Invalid Client Secret";case"access_denied":return"Access Denied";case"invalid_request":return"Invalid Request";default:return"Configuration Issue"}})()}),(0,a.jsxs)(tu.TN,{className:"space-y-2 text-sm",children:[(0,a.jsx)("div",{children:(()=>{switch(s.auth_flow_error_type){case"redirect_uri":return"The identity provider rejected the request. This typically means either the Client ID is incorrect or the Redirect URI is not configured in your IdP.";case"client_id":return"The Client ID wasn't recognized by the identity provider. Please verify it matches your IdP application.";case"client_secret":return"The client secret validation failed. Please check your credentials.";case"access_denied":return"The requested scopes were denied by the identity provider.";case"invalid_request":return"Missing required parameters in the authorization request.";default:return"Authorization check failed: ".concat(s.message)}})()}),"redirect_uri"===s.auth_flow_error_type&&(0,a.jsxs)("div",{className:"mt-2 space-y-2 rounded bg-background p-2",children:[(0,a.jsx)("div",{className:"font-medium",children:"Check these two settings in your IdP:"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-xs font-medium",children:"1. Client ID"}),(0,a.jsx)("div",{className:"ml-3 text-sm",children:"Verify that the Client ID exactly matches what's configured in your IdP application."})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"2. Redirect URI"}),(0,a.jsx)("code",{className:"ml-3 block break-all rounded bg-muted p-1 text-xs",children:t}),(0,a.jsx)("div",{className:"ml-3 text-sm",children:"Make sure this exact URI is added to your IdP's allowed redirect/callback URIs."})]}),(0,a.jsx)("div",{className:"mt-2 space-y-1 text-sm",children:r?(0,a.jsx)("div",{children:"⚠️ You're testing locally. Make sure your IdP is configured for the development redirect URI."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"font-medium",children:"Quick fix steps:"}),(0,a.jsxs)("ol",{className:"ml-4 list-decimal",children:[(0,a.jsx)("li",{children:"Double-check your Client ID is copied correctly"}),(0,a.jsx)("li",{children:"Go to your IdP application settings"}),(0,a.jsx)("li",{children:"Find the redirect/callback URI section"}),(0,a.jsx)("li",{children:"Add the exact URI shown above if missing"}),(0,a.jsx)("li",{children:"Save and test again"})]})]})})]})]})]})},tV=e=>{let{validationResult:s}=e,{authorization_endpoint:t,token_endpoint:r,userinfo_endpoint:n,client_secret_validation_status:i,auth_flow_ready:l,auth_flow_error_type:o,supported_scopes:c,supported_claims:d,required_scopes_available:u,required_claims_available:m,warnings:h}=s,x="unavailable"===i,g=l&&"validated"===i&&!1!==u&&!1!==m;return(0,a.jsxs)(tF.Zp,{className:"ring-2 ring-primary/20 duration-300 animate-in fade-in-0",children:[(0,a.jsx)(tF.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(tF.ZB,{className:"text-sm",children:"Test Results"}),l?"invalid"===i?(0,a.jsx)(sY.E,{variant:"destructive",className:"text-sm",children:"Invalid Secret"}):!1===u?(0,a.jsx)(sY.E,{variant:"destructive",className:"text-sm",children:"Missing Required Scopes"}):!1===m?(0,a.jsx)(sY.E,{variant:"destructive",className:"text-sm",children:"Missing Required Claims"}):"validated"===i?(0,a.jsx)(sY.E,{variant:"affirmative",className:"text-sm",children:"Fully Validated"}):x?(0,a.jsx)(sY.E,{variant:"secondary",className:"text-sm",children:"Ready to Configure"}):(0,a.jsx)(sY.E,{variant:"affirmative",className:"text-sm",children:"Discovery OK"}):"redirect_uri"===o?(0,a.jsx)(sY.E,{variant:"warning",className:"text-sm",children:"Config Mismatch"}):"client_id"===o?(0,a.jsx)(sY.E,{variant:"destructive",className:"text-sm",children:"Invalid Client ID"}):(0,a.jsx)(sY.E,{variant:"destructive",className:"text-sm",children:"Not Ready"})]})}),(0,a.jsxs)(tF.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Discovery Endpoints"}),(0,a.jsxs)("div",{className:"space-y-1",children:[t&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{name:"check",size:"small",className:"text-green-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Authorization endpoint found"})]}),r&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{name:"check",size:"small",className:"text-green-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Token endpoint found"})]}),n&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{name:"check",size:"small",className:"text-green-500"}),(0,a.jsx)("span",{className:"text-sm",children:"UserInfo endpoint found"})]})]})]}),i&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Client Credentials"}),(0,a.jsxs)("div",{className:"space-y-1",children:["validated"===i&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{name:"check",size:"small",className:"text-green-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Client secret validated"})]}),"invalid"===i&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{name:"close",size:"small",className:"text-red-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Invalid client secret"})]}),"unavailable"===i&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{name:"info",size:"small",className:"text-blue-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Provider doesn't support pre-validation (common) - will validate on first login"})]})]})]}),c&&c.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:g?"Validated Scopes":x||l&&"invalid"!==i?"Provider Capabilities":"Provider Capabilities (Not Yet Accessible)"}),!g&&(0,a.jsxs)(tu.Fc,{variant:"warning",className:"text-sm",children:[(0,a.jsx)(p.A,{name:"info",size:"small"}),(0,a.jsx)(tu.TN,{children:x?"Your provider advertises these capabilities. Since many providers don't support client credential validation, actual access will be confirmed on first login.":l||"redirect_uri"!==o?l||"client_id"!==o?"invalid"===i&&!1!==l?"These capabilities cannot be accessed with an invalid client secret.":l?"Configuration validation in progress.":"These capabilities are not yet accessible due to configuration issues.":"These capabilities cannot be accessed with an invalid Client ID.":"These capabilities will be accessible once the redirect URI or Client ID is correctly configured in your IdP."})]}),(0,a.jsxs)("div",{className:g?"":"opacity-50",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:c.map(e=>(0,a.jsx)(sY.E,{variant:g?"secondary":"outline",className:"text-xs",children:e},e))}),!1===u&&(0,a.jsx)(tu.Fc,{variant:"destructive",className:"mt-2",children:(0,a.jsx)(tu.TN,{className:"text-sm",children:"⚠️ Required scopes (openid, email) are not available. Authentication will not work."})})]})]}),d&&d.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:g?"Validated Claims":x||l&&"invalid"!==i?"Provider Claims":"Provider Claims (Not Yet Accessible)"}),(0,a.jsxs)("div",{className:g?"":"opacity-50",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:["email","name","picture","sub"].map(e=>{let s=d.includes(e)||"name"===e&&(d.includes("given_name")||d.includes("family_name")||d.includes("preferred_username")),t="email"===e;return(0,a.jsxs)(sY.E,{variant:g?s?"affirmative":t?"destructive":"secondary":"outline",className:"text-xs",children:[e,t&&" (required)",g&&(s?" ✓":" ✗")]},e)})}),!1===m&&(0,a.jsx)(tu.Fc,{variant:"destructive",className:"mt-2",children:(0,a.jsx)(tu.TN,{className:"text-sm",children:"⚠️ The 'email' claim is not available. This is required for users to sign in. Authentication will fail."})})]})]}),h&&h.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-warning-foreground",children:"Warnings"}),(0,a.jsx)("ul",{className:"list-inside list-disc space-y-1",children:h.map((e,s)=>(0,a.jsx)("li",{className:"text-sm text-muted-foreground",children:e},s))})]})]})]})},tH=(e,s,t)=>{let a={duration:tY,dismissible:!0,...t};return H.toast[e](s,a)},tY=8e3,tQ=e=>{let{workspace:s,onSuccess:t,onCancel:n,initialData:i,domainOnly:l=!1,verifiedDomains:o=[]}=e,[c,d]=(0,r.useState)(!l&&o.length>0?"provider_type":"domain"),[u,x]=(0,r.useState)((null==i?void 0:i.domain)||""),[g,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)(""),[y,b]=(0,r.useState)(null),[w,N]=(0,r.useState)(""),[C,k]=(0,r.useState)(!1),[_,S]=(0,r.useState)(null),[I,E]=(0,r.useState)(!1),A=(0,sd.mN)({defaultValues:{clientId:(null==i?void 0:i.clientId)||"",clientSecret:(null==i?void 0:i.clientSecret)||"",issuer:(null==i?void 0:i.issuer)||""},mode:"onBlur"}),P=(0,sd.mN)({defaultValues:{signOnUrl:"",x509Certificate:"",entityId:""},mode:"onBlur"}),D=(0,r.useMemo)(()=>"localhost"===window.location.hostname?"https://gpt-engineer-dev.firebaseapp.com/__/auth/handler":"https://auth.lovable.dev/__/auth/handler",[]),T="localhost"===window.location.hostname,L=(0,r.useRef)(null),z=A.watch("clientId"),R=A.watch("clientSecret"),O=A.watch("issuer");(0,r.useEffect)(()=>{"oidc"===y&&(E(!1),S(null))},[z,R,O,y]);let{mutateAsync:F,isPending:M}=(0,eO.n)({mutationFn:async()=>{let e=(0,m.P)();return await e.post("/workspaces/".concat(s.id,"/identity/verify-domain"),{domain:u}),j(!0),v(""),!0},onError:e=>{let s=e instanceof Error?e.message:"Domain verification failed";v(s),tH("error","Verification failed",{description:s})}}),{mutateAsync:U,isPending:B}=(0,eO.n)({mutationFn:async e=>{let t=(0,m.P)();return await t.post("/workspaces/".concat(s.id,"/identity/add-sso-provider"),{type:"oidc",oidc:{clientId:e.clientId,clientSecret:e.clientSecret,issuer:e.issuer},displayName:w}),!0},onSuccess:()=>{tH("success","SSO provider configured successfully!"),d("complete"),null==t||t()},onError:e=>{tH("error","Failed to configure SSO provider",{description:e instanceof Error?e.message:"Unknown error occurred"})}}),{mutateAsync:$,isPending:W}=(0,eO.n)({mutationFn:async e=>{let t=(0,m.P)();return await t.post("/workspaces/".concat(s.id,"/identity/add-sso-provider"),{type:"saml",saml:{signOnUrl:e.signOnUrl,x509Certificate:e.x509Certificate,entityId:e.entityId},displayName:w}),!0},onSuccess:()=>{tH("success","SAML provider configured successfully!"),d("complete"),null==t||t()},onError:e=>{tH("error","Failed to configure SAML provider",{description:e instanceof Error?e.message:"Unknown error occurred"})}}),G=async()=>{k(!0);let e=A.getValues();try{let t=(0,m.P)(),a=await t.post("/workspaces/".concat(s.id,"/identity/validate-sso-provider"),{type:"oidc",issuer:e.issuer,clientId:e.clientId,clientSecret:e.clientSecret,redirectUri:D,scope:"openid email profile"});if(S(a),E(!0),setTimeout(()=>{var e;null==(e=L.current)||e.scrollIntoView({behavior:"smooth",block:"start"})},100),a.discovery_ok)if(a.auth_flow_ready)"invalid"===a.client_secret_validation_status?tH("error","Invalid client secret",{description:"The client secret validation failed. Please check your credentials."}):"validated"===a.client_secret_validation_status?tH("success","Configuration validated successfully!",{description:"Client credentials are valid and authorization flow is ready."}):tH("success","Configuration is partially validated.",{description:"Your provider doesn't support pre-validation of the client secret, which is normal. It will be validated on first login."});else switch(a.auth_flow_error_type){case"redirect_uri":tH("warning","Configuration mismatch detected",{description:T?"You're testing locally - ensure your IdP includes the development redirect URI":"The redirect URI needs to be added to your identity provider's application settings."});break;case"client_id":tH("error","Client ID not recognized",{description:a.message||"The Client ID may not be valid or recognized by the provider."});break;case"client_secret":tH("error","Invalid client secret",{description:"The client secret validation failed. Please check your credentials."});break;default:tH("error","Authorization flow error",{description:a.message||"The authorization flow is not working properly."})}else tH("error","OIDC discovery failed",{description:a.message})}catch(e){tH("error","Issuer verification failed",{description:e instanceof Error?e.message:"Unknown error occurred"})}finally{k(!1)}},K=()=>{"provider_type"===c?0===o.length||l?d("domain"):null==n||n():"oidc_preparation"===c||"saml_preparation"===c?d("provider_type"):"oidc"===c?d("oidc_preparation"):"saml"===c&&d("saml_preparation")},q=e=>{let s=u||o[0]||"";if(!s)return e;let t=s.split(".")[0];return t.charAt(0).toUpperCase()+t.slice(1)},V=async e=>{N(q("OIDC Provider")),d("confirmation")},H=async e=>{N(q("SAML Provider")),d("confirmation")},Y=async()=>{if(y){if("oidc"===y){let e=A.getValues();await U(e)}else if("saml"===y){let e=P.getValues();await $(e)}}};return"confirmation"===c?(0,a.jsx)(tK,{validationResult:_,verifiedDomains:o,providerType:y,displayName:w,onConfirm:Y,onBack:()=>d(y),isConfirming:B||W}):"complete"===c?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-affirmative/10",children:(0,a.jsx)(p.A,{name:"check",className:"h-8 w-8 text-affirmative"})}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:l?"Domain Verified!":"SSO Provider Configured!"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:l?"Your domain has been successfully verified.":"Your SSO provider has been successfully configured."})]}),!l&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-sm",children:"Configuration Summary"})}),(0,a.jsxs)(tF.Wu,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Provider Type:"}),(0,a.jsx)(sY.E,{variant:"outline",children:"OIDC"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Status:"}),(0,a.jsx)(sY.E,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(h.$,{variant:"outline",onClick:null!=n?n:()=>{},children:"Close"}),!l&&(0,a.jsx)(h.$,{onClick:()=>d("domain"),children:"Add Another Provider"})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:["domain"===c&&(0,a.jsx)(tM,{workspace:s,domain:u,setDomain:x,verified:g,verificationError:f,isVerifying:M,onVerify:()=>F().then(()=>{}),onCancel:null!=n?n:()=>{},onContinue:()=>{"domain"===c&&g&&(l?(d("complete"),null==t||t()):d("provider_type"))}}),"provider_type"===c&&(0,a.jsx)(t$,{onSelectType:e=>{b(e),d("oidc"===e?"oidc_preparation":"saml_preparation")},onBack:K}),"oidc_preparation"===c&&(0,a.jsx)(tB,{authRedirectUrl:D,onNext:()=>d("oidc"),onBack:K}),"oidc"===c&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(tU,{form:A,onSubmit:V,onTestIssuer:G,isTestingIssuer:C,onBack:K,showTestButton:!0,submitButtonText:I?"Configure Provider":"Test Required First",submitButtonDisabled:!I||(null==_?void 0:_.client_secret_validation_status)==="invalid"&&(null==_?void 0:_.auth_flow_ready)!==!1}),_&&(0,a.jsxs)("div",{ref:L,className:"scroll-mt-4 space-y-4 duration-500 animate-in fade-in slide-in-from-bottom-2",children:[(0,a.jsx)(tq,{validationResult:_,authRedirectUrl:D,isLocalhost:T}),(0,a.jsx)(tV,{validationResult:_}),_.auth_flow_ready&&"invalid"!==_.client_secret_validation_status&&(0,a.jsxs)(tF.Zp,{children:[(0,a.jsx)(tF.aR,{children:(0,a.jsx)(tF.ZB,{className:"text-sm",children:"Common Setup Issues"})}),(0,a.jsx)(tF.Wu,{className:"text-xs text-muted-foreground",children:(0,a.jsxs)("ul",{className:"list-inside list-disc space-y-2",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Redirect URI mismatch:"})," Make sure the exact redirect URI is added to your IdP"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Client secret expired:"})," Some providers rotate secrets periodically"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Missing scopes:"})," Ensure your app has permission for openid and email scopes (required), plus profile scope (optional for user display names)"]})]})})]})]})]}),"saml_preparation"===c&&(0,a.jsx)(tG,{authRedirectUrl:D,onNext:()=>d("saml"),onBack:K}),"saml"===c&&(0,a.jsx)(tW,{form:P,authRedirectUrl:D,onSubmit:H,onBack:K})]})},tZ=e=>{let{workspace:s}=e,[t,n]=(0,r.useState)([{type:"list",title:"Identity & Access"}]),[i,l]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[x,g]=(0,r.useState)(!!s.enforce_sso),j=(0,ef.jE)(),f=(0,m.P)(),{data:v=[],isLoading:y,error:b}=(0,u.I)({queryKey:["sso-providers",s.id],queryFn:async()=>await f.get("/workspaces/".concat(s.id,"/identity/sso-providers"))}),{data:w=[],isLoading:N,error:C}=(0,u.I)({queryKey:["verified-domains",s.id],queryFn:async()=>(await f.get("/workspaces/".concat(s.id,"/identity/verified-domains"))).domains}),k=(0,eO.n)({mutationFn:async e=>{await f.delete("/workspaces/".concat(s.id,"/identity/sso-providers/").concat(e))},onSuccess:()=>{j.invalidateQueries({queryKey:["sso-providers",s.id]}),l(null),H.toast.success("SSO provider deleted successfully")},onError:e=>{l(null),H.toast.error(e.message||"Failed to delete SSO provider")}}),_=(0,eO.n)({mutationFn:async e=>{await f.delete("/workspaces/".concat(s.id,"/identity/verified-domains/").concat(e))},onSuccess:()=>{j.invalidateQueries({queryKey:["verified-domains",s.id]}),d(null),H.toast.success("Domain deleted successfully")},onError:e=>{H.toast.error(e.message||"Failed to delete domain"),d(null)}}),S=(0,eO.n)({mutationFn:async e=>await f.put("/user/workspaces/".concat(s.id),{enforce_sso:e}),onSuccess:e=>{g(!!e.enforce_sso),j.invalidateQueries({queryKey:sP.y.detail({workspaceId:s.id,projectId:void 0}).queryKey}),H.toast.success("Updated",{description:"Enforce SSO updated"})},onError:e=>{H.toast.error(e.message||"Failed to update Enforce SSO"),g(!!s.enforce_sso)}}),I=t[t.length-1],E=()=>{if(!L)return void T();l(null),d(null),n(e=>[...e,{type:"add-provider",title:"Add SSO Provider"}])},A=()=>{l(null),d(null),n(e=>e.slice(0,-1))},P=()=>{l(null),d(null),n([{type:"list",title:"Identity & Access"}])},D=(0,X.BK)(),T=()=>{D(X.KU.BIZ_SSO)},{isBizOrEnterprisePlan:L}=(0,er.cb)(null==s?void 0:s.plan);return b?(0,a.jsx)(c.Pt,{value:"identity",title:"Identity",description:"Manage your workspace identity and SSO.",children:(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)(tF.Zp,{children:(0,a.jsx)(tF.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"text-center text-destructive-primary",children:["Error loading SSO providers: ",b.message]})})})})}):(0,a.jsxs)(c.Pt,{value:"identity",title:"Identity",description:"Manage your workspace identity and SSO.",customBadge:(0,a.jsx)(Z.M,{workspace:s,requiredPlanCategory:"biz"}),children:[t.length<=1?null:(0,a.jsx)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:t.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[s>0&&(0,a.jsx)(p.A,{name:"chevron_right",size:"small"}),s===t.length-1?(0,a.jsx)("span",{className:"font-medium text-foreground",children:e.title}):(0,a.jsx)("button",{onClick:()=>n(e=>e.slice(0,s+1)),className:"transition-colors hover:text-foreground",children:e.title})]},s))}),"list"===I.type&&(0,a.jsx)(sb.Bc,{children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b pb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:"SSO Providers"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Configure single sign-on providers for your workspace"})]}),(0,a.jsx)(eS.Q,{showTooltip:v.length>0,tooltipContent:"Only one SSO provider can be configured at a time. Delete the existing provider to add a new one.",children:(0,a.jsxs)(h.$,{onClick:E,variant:"secondary",disabled:v.length>0,children:[(0,a.jsx)(p.A,{name:"add",size:"small"}),"Add Provider",v.length>0&&(0,a.jsx)(p.A,{name:"info",size:"small"})]})})]}),y?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(p.A,{name:"security",className:"mx-auto h-12 w-12 animate-pulse text-muted-foreground"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"Loading SSO providers..."})]}):0===v.length?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(p.A,{name:"security",className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"No SSO providers configured"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Get started by adding your first SSO provider to enable single sign-on for your workspace."}),(0,a.jsxs)(h.$,{className:"mt-4",onClick:E,disabled:v.length>0,children:[(0,a.jsx)(p.A,{name:"add",size:"small"}),"Add Provider"]})]}):(0,a.jsx)("div",{className:"space-y-4",children:v.map(e=>{let s="https://lovable.dev/sso-login/"+e.provider_id;return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-4 transition-colors hover:bg-muted/50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted",children:(e=>{switch(e){case"oidc":return(0,a.jsx)(p.A,{name:"security"});case"saml":return(0,a.jsx)(p.A,{name:"key"});default:return(0,a.jsx)(p.A,{name:"settings"})}})(e.type)}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium",children:[e.provider_id," "]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("h5",{className:"text-xs text-muted-foreground",children:["Login URL: ",(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:s})]}),(0,a.jsxs)(sb.m_,{delayDuration:0,children:[(0,a.jsx)(sb.k$,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-muted",onClick:async()=>{await navigator.clipboard.writeText(s),H.toast.success("Login URL copied to clipboard")},children:(0,a.jsx)(p.A,{name:"content_copy",size:"small"})})}),(0,a.jsx)(sb.ZI,{children:"Copy Login URL"})]})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center space-x-2",children:[(0,a.jsx)(sY.E,{variant:"affirmative",children:"Active"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(e.created_at).toLocaleDateString()]})]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(h.$,{type:"button",variant:"ghost",size:"sm",className:"hover:bg-destructive-foreground/10 hover:text-destructive-foreground",onClick:s=>{s.stopPropagation(),l(e.id)},children:"Delete"})})]},e.id)})}),(0,a.jsx)(tI,{open:!!i,onOpenChange:e=>{e||l(null)},children:(0,a.jsxs)(tP,{overlayClassName:"z-[11000]",className:"z-[11000]",children:[(0,a.jsxs)(tD,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.A,{name:"delete",className:"text-destructive-foreground"}),(0,a.jsx)(tL,{children:"Delete SSO Provider"})]}),(0,a.jsx)(tz,{children:"Are you sure you want to delete this SSO provider? This action cannot be undone and will disable SSO authentication for this provider."})]}),(0,a.jsxs)(tT,{children:[(0,a.jsx)(tO,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",disabled:k.isPending,children:"Cancel"})}),(0,a.jsx)(tR,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"destructive",size:"sm",onClick:()=>{i&&k.mutate(i)},disabled:k.isPending,children:k.isPending?"Deleting...":"Delete"})})]})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between border-b pb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:"Verified Domains"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Domains that are verified for SSO authentication"})]}),(0,a.jsxs)(h.$,{onClick:()=>{if(!L)return void T();l(null),d(null),n(e=>[...e,{type:"add-domain",title:"Add Verified Domain"}])},variant:"secondary",children:[(0,a.jsx)(p.A,{name:"add",size:"small"}),"Add Domain"]})]}),N?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(p.A,{name:"link",className:"mx-auto h-12 w-12 animate-pulse text-muted-foreground"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"Loading verified domains..."})]}):C?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(p.A,{name:"error",className:"mx-auto h-12 w-12 text-destructive"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium text-destructive",children:"Error loading verified domains"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:C.message})]}):0===w.length?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(p.A,{name:"link",className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"No verified domains"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Add a verified domain to enable SSO authentication for your workspace."})]}):(0,a.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-4 transition-colors hover:bg-muted/50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted",children:(0,a.jsx)(p.A,{name:"link"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:e}),(0,a.jsx)("div",{className:"mt-1 flex items-center space-x-2",children:(0,a.jsx)(sY.E,{variant:"affirmative",children:"Verified"})})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"hover:bg-destructive-foreground/10 hover:text-destructive-foreground",onClick:()=>{d(e)},children:"Delete"})})]},e))}),(0,a.jsx)(tI,{open:!!o,onOpenChange:e=>{e||d(null)},children:(0,a.jsxs)(tP,{overlayClassName:"z-[11000]",className:"z-[11000]",children:[(0,a.jsxs)(tD,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.A,{name:"delete",className:"text-destructive-foreground"}),(0,a.jsx)(tL,{children:"Delete Verified Domain"})]}),(0,a.jsx)(tz,{children:"Are you sure you want to delete this verified domain? This action will disable SSO authentication for this domain."})]}),(0,a.jsxs)(tT,{children:[(0,a.jsx)(tO,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",disabled:_.isPending,children:"Cancel"})}),(0,a.jsx)(tR,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"destructive",size:"sm",onClick:()=>{o&&_.mutate(o)},disabled:_.isPending,children:_.isPending?"Deleting...":"Delete"})})]})]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 border-b pb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:"Security & Access Control"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Features that help you secure your workspace and control access to your projects"})]}),(0,a.jsx)(ee.m,{label:"Enforce SSO",description:"Require all workspace members to use SSO for authentication",justify:"end",children:(0,a.jsx)(eI.d,{checked:x,disabled:S.isPending,onCheckedChange:e=>{if(!L)return void T();g(e),S.mutate(e)}})}),(0,a.jsx)(ee.m,{label:"Just-in-Time Provisioning",description:"Automatically creates user accounts and adds them to company workspace when they sign in via SSO",justify:"end"})]})}),"add-provider"===I.type&&(0,a.jsx)(tQ,{workspace:s,onSuccess:()=>{j.invalidateQueries({queryKey:["sso-providers",s.id]}),P()},onCancel:A,verifiedDomains:w}),"add-domain"===I.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1 border-b pb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:"Add Verified Domain"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add a new domain for SSO authentication"})]}),(0,a.jsx)(tQ,{workspace:s,onSuccess:()=>{j.invalidateQueries({queryKey:["verified-domains",s.id]}),P()},onCancel:A,domainOnly:!0})]})]})};var tJ=t(82360),tX=t(27317),t0=t(7099);let t1=e=>{let{workspace:s}=e,{data:t,isLoading:r}=(0,u.I)(sP.y.templates({workspaceId:s.id})),{isBizOrEnterprisePlan:n}=(0,er.cb)(null==s?void 0:s.plan),{openSettings:i}=(0,e$.t)();return n?(0,a.jsx)(c.Pt,{title:"Templates",value:"templates",description:"Browse and manage team templates, used to start new projects. Publish new templates from settings.",badge:"business",children:(0,a.jsxs)("div",{className:"grid flex-1 grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tX.p,{mainSkeletonClassName:"h-auto"}),(0,a.jsx)(tX.p,{mainSkeletonClassName:"h-auto"}),(0,a.jsx)(tX.p,{mainSkeletonClassName:"h-auto"}),(0,a.jsx)(tX.p,{mainSkeletonClassName:"h-auto"}),(0,a.jsx)(tX.p,{mainSkeletonClassName:"h-auto"}),(0,a.jsx)(tX.p,{mainSkeletonClassName:"h-auto"})]}),!r&&(t&&t.length>0?t.map(e=>(0,a.jsx)(t0.U,{project:e,subtitleType:"created-by",isCommunityProject:!1,positionIndex:0,isTemplate:!0},e.id)):(0,a.jsxs)("div",{className:"col-span-full flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,a.jsx)(p.A,{name:"file_export",size:"large"}),(0,a.jsx)("p",{className:"text-center text-sm",children:"No templates found. Mark projects as templates to get started."})]}))]})}):(0,a.jsx)(c.Pt,{title:"Templates",value:"templates",description:"Browse and manage team templates, used to start new projects. Publish new templates from settings.",customBadge:s&&(0,a.jsx)(Z.M,{workspace:s,requiredPlanCategory:"biz"}),children:(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,a.jsx)(p.A,{name:"file_export",size:"large"}),(0,a.jsx)("p",{className:"text-center text-sm",children:"To start using templates, upgrade to a Business or Enterprise plan."}),(0,a.jsx)(h.$,{onClick:()=>i("billing"),variant:"twilight",className:"mt-2",children:"Upgrade"})]})})};var t2=t(14164);let t5=()=>{let{permitted:e}=(0,o.J)(eo.eZ.EditProject),{permitted:s}=(0,o.J)(eo.eZ.ViewProject),t=(0,ep.Iw)(e=>e.project),{isAuthenticated:r}=(0,i.Z2)(),n=(0,ec.B5)(e=>e.projectWorkspace),l=(0,ec.B5)(e=>e.membership),c=!!l,d=null==l?void 0:l.role;return r&&s?(0,a.jsx)(t9,{project:t,workspace:null!=n?n:void 0,isMemberOfWorkspace:c,myWorkspaceRole:d,canEdit:e}):null},t9=e=>{let{project:s,workspace:t,myWorkspaceRole:l,isMemberOfWorkspace:o,canEdit:d=!0}=e,[u,m]=(0,r.useState)(!0),h=(0,eA.WW)(),x=h?"admin":l,{activeTab:g,openSettings:j,closeSettings:f}=(0,e$.t)();(0,r.useEffect)(()=>{null!==g?m(!0):m(!1)},[g]),(0,n.vC)("mod+.",()=>{null===g?j(s?"project":"account"):f()});let{authUser:v}=(0,i.Z2)(),y=(null==v?void 0:v.displayName)||"Your Account",b=h||o,w=h||"admin"===l||"owner"===l,N=null==t?void 0:t.name,{isBizOrEnterprisePlan:C}=(0,er.cb)(null==t?void 0:t.plan),k=(0,e5.UT)(),_=(0,e5.f$)(),S=(0,e5.j$)(),I=(0,e5.J6)(),E=(0,e5.Li)();return(0,a.jsx)(e0,{open:u,onOpenChange:e=>{e?j():f()},children:(0,a.jsxs)(c.mm,{value:g||"settings",onValueChange:e=>j(e,!0),children:[(0,a.jsxs)(c.WQ,{hasActiveTab:!!g,children:[s&&d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.G1,{title:"Project"}),(0,a.jsxs)(c.Jz,{value:"project",children:[(0,a.jsx)(p.A,{name:"settings"}),(0,a.jsx)("p",{children:"Project Settings"})]}),(0,a.jsxs)(c.Jz,{value:"domains",children:[(0,a.jsx)(p.A,{name:"language"}),(0,a.jsx)("p",{children:"Domains"})]}),!E&&(0,a.jsxs)(c.Jz,{value:"analytics",children:[(0,a.jsx)(p.A,{name:"bid_landscape"}),(0,a.jsx)("p",{children:"Analytics"})]}),!E&&(0,a.jsxs)(c.Jz,{value:"page_speed",children:[(0,a.jsx)(p.A,{name:"trending_up"}),(0,a.jsx)("p",{children:"Page Speed"})]}),(0,a.jsxs)(c.Jz,{value:"knowledge",children:[(0,a.jsx)(p.A,{name:"school"}),(0,a.jsx)("p",{children:"Knowledge"})]}),k&&(0,a.jsxs)(c.Jz,{value:"memory",children:[(0,a.jsx)(p.A,{name:"neurology"}),(0,a.jsx)("p",{children:"Memory"})]}),_&&(0,a.jsxs)(c.Jz,{value:"ai_gateway",children:[(0,a.jsx)(p.A,{name:"smart_toy"}),(0,a.jsx)("p",{children:"AI Gateway"})]}),!E&&(0,a.jsxs)(c.Jz,{value:"security",children:[(0,a.jsx)(p.A,{name:"security"}),(0,a.jsx)("p",{children:"Security Center"})]})]}),s&&!d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.G1,{title:"Project"}),(0,a.jsxs)(c.Jz,{value:"domains",children:[(0,a.jsx)(p.A,{name:"language"}),(0,a.jsx)("p",{children:"Domains"})]})]}),t&&b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.G1,{title:"Workspace"}),(0,a.jsxs)(c.Jz,{value:"workspace",className:"-ml-0.5",children:[(0,a.jsx)(e9.z,{className:(0,ex.cn)("h-6 w-6 !rounded-[6px] md:h-5 md:w-5"),workspace:t}),(0,a.jsx)("p",{className:"-ml-0.5",children:N})]}),(0,a.jsxs)(c.Jz,{value:"people",children:[(0,a.jsx)(p.A,{name:"group"}),(0,a.jsx)("p",{children:"People"})]}),C&&(0,a.jsxs)(c.Jz,{value:"templates",children:[(0,a.jsx)(p.A,{name:"browse"}),(0,a.jsx)("p",{children:"Templates"})]}),(0,a.jsxs)(c.Jz,{value:"billing",children:[(0,a.jsx)(p.A,{name:"credit_card"}),(0,a.jsx)("p",{children:"Plans & Billing"})]}),C&&w&&(0,a.jsxs)(c.Jz,{value:"identity",children:[(0,a.jsx)(p.A,{name:"security"}),(0,a.jsx)("p",{children:"Identity"})]})]}),(0,a.jsx)(c.G1,{title:"Account"}),(0,a.jsxs)(c.Jz,{value:"account",children:[(0,a.jsx)(p.A,{name:"account_circle"}),(0,a.jsx)("p",{children:y})]}),(0,a.jsxs)(c.Jz,{value:"labs",children:[(0,a.jsx)(p.A,{name:"science"}),(0,a.jsx)("p",{children:"Labs"})]}),b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.G1,{title:"Connections"}),(0,a.jsxs)(c.Jz,{value:"supabase",children:[(0,a.jsx)(e4.Xy.Supabase,{className:"h-4 w-4"}),(0,a.jsx)("p",{children:"Supabase"})]}),(s||t)&&(0,a.jsxs)(c.Jz,{value:"github",children:[(0,a.jsx)(e4.Xy.GitHub,{className:"h-4 w-4"}),(0,a.jsx)("p",{children:"GitHub"})]}),(S||I)&&t&&(0,a.jsxs)(c.Jz,{value:"mcp",children:[(0,a.jsx)(p.A,{name:"extension"}),(0,a.jsx)("p",{children:"Connections"})]})]})]}),(0,a.jsxs)("div",{className:(0,ex.cn)("relative h-full w-full flex-1 overflow-x-auto md:w-auto",g?"flex":"hidden md:flex"),children:[s&&d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Pt,{value:"project",title:"Project Settings",description:"Manage your project details, visibility, and preferences.",children:(0,a.jsx)(eU,{project:s})}),(0,a.jsx)(c.Pt,{value:"knowledge",title:"Knowledge",description:"Add custom knowledge to your project.",docsLink:"https://docs.lovable.dev/features/knowledge",children:(0,a.jsx)(eg,{})}),"analytics"===g&&!E&&(0,a.jsx)(B.Q,{project:s}),!E&&"page_speed"===g&&(0,a.jsx)(ej.S,{project:s}),k&&(0,a.jsx)(tc,{workspace:t,isInsideEditor:!!s,myWorkspaceRole:x,project:s}),_&&(0,a.jsx)(U,{project:s}),!E&&(0,a.jsx)(c.Pt,{value:"security",title:"Security Settings",description:"Monitor and manage security settings and issues for your project.",children:(0,a.jsx)(eB.S,{onClose:f})}),(0,a.jsx)(c.Pt,{value:"domains",title:"Domains",description:"Publish your project to custom domains.",docsLink:"https://docs.lovable.dev/features/custom-domain#custom-domain",children:(0,a.jsx)(eu,{project:s})})]}),s&&!d&&(0,a.jsx)(c.Pt,{value:"domains",title:"Domains",description:"View domains connected to this project.",docsLink:"https://docs.lovable.dev/features/custom-domain#custom-domain",children:(0,a.jsx)(eu,{project:s})}),t&&o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t2.N,{workspace:t,myWorkspaceRole:x}),(0,a.jsx)(tJ.$,{workspace:t}),(0,a.jsx)(t_.R,{workspace:t,myWorkspaceRole:l}),C&&(0,a.jsx)(t1,{workspace:t}),C&&w&&(0,a.jsx)(tZ,{workspace:t})]}),(0,a.jsx)(sI,{}),(0,a.jsx)(ss,{}),b&&t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s3,{workspace:t,isInsideEditor:!!s,myWorkspaceRole:x}),(0,a.jsx)(tk,{workspace:t,project:s,isInsideEditor:!!s,myWorkspaceRole:x}),(S||I)&&(0,a.jsx)(to,{workspace:t,myWorkspaceRole:x})]})]})]})})},t4=()=>{let e=(0,ec.tY)(),s=(0,l.j4)(e=>e.currentWorkspace),t=(0,l.j4)(e=>e.membership),r=!!t;if(e)return(0,a.jsx)(t5,{});let n=null==t?void 0:t.role;return(0,a.jsx)(t9,{workspace:null!=s?s:void 0,isMemberOfWorkspace:r,myWorkspaceRole:n,canEdit:!0})}},62593:(e,s,t)=>{t.d(s,{B:()=>l,C:()=>i});var a=t(99289),r=t(11405);let n=(0,r.createContext)({setSelectedProject:()=>{},setOpen:()=>{}}),i=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useSupabaseConnectMenuContext must be used within a SupabaseConnectMenuContext");return e},l=e=>{let{children:s,setSelectedProject:t,setOpen:r}=e;return(0,a.jsx)(n.Provider,{value:{setSelectedProject:t,setOpen:r},children:s})}},65746:(e,s,t)=>{t.d(s,{E:()=>l,m:()=>i});var a=t(99289),r=t(26551),n=t(38948);let i=e=>{let{children:s,label:t,className:i,isLast:l=!1,description:o,badges:c,customBadge:d,mobileLayout:u="vertical",justify:m="start",...h}=e;return(0,a.jsxs)("div",{className:(0,r.cn)("relative grid gap-4 pb-4 last:border-b-0 md:grid md:grid-cols-2",{"border-b-0":l,"border-b":!l,"flex justify-between":"horizontal"===u,"grid-cols-1":"vertical"===u},i),...h,children:[(t||o)&&(0,a.jsxs)("div",{className:"flex-col gap-1 md:flex",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-x-1.5 text-base font-medium",children:[t,null==c?void 0:c.map(e=>(0,a.jsx)(n.x,{badge:e},e)),d]}),o&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:o})]}),s&&(0,a.jsx)("div",{className:(0,r.cn)("flex items-center","end"===m&&"md:justify-end"),children:s})]})},l=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("div",{className:(0,r.cn)("absolute inset-x-0 bottom-0 z-10 flex min-h-8 items-center rounded-b-lg border-t bg-background px-6 py-3 md:px-10",t),...n,children:s})}},66398:(e,s,t)=>{t.d(s,{Q:()=>i});var a=t(99289),r=t(53417),n=t(26551);let i=e=>{let{status:s}=e;return(0,a.jsxs)(r.E,{className:"flex w-auto items-center gap-1.5 bg-secondary text-xs text-foreground shadow-none hover:bg-secondary",children:[(0,a.jsx)("span",{className:(0,n.cn)("h-1.5 w-1.5 rounded-full","connected"===s?"bg-success-primary":"bg-warning-primary")}),"connected"===s?"Connected":"Not connected"]})}},67088:(e,s,t)=>{t.d(s,{c:()=>n});var a=t(34363),r=t(33256);let n=e=>{let{projectId:s,enabled:t=!0}=e;return(0,a.I)({queryKey:["projects",s,"integrations","ai_gateway"],queryFn:async()=>(0,r.P)().get("/projects/".concat(s,"/integrations/ai_gateway")),enabled:t&&!!s})}},71305:(e,s,t)=>{t.d(s,{S:()=>c});var a=t(11405),r=t(70999),n=t(99289),i=t(49944),l=t(6072);let o=e=>{let{onConfirm:s,onClose:t}=e,[r,o]=(0,a.useState)(!1),c=async()=>{o(!0);try{await s()}finally{o(!1)}};return(0,n.jsxs)(l.Cf,{className:"sm:max-w-[425px]",children:[(0,n.jsxs)(l.c7,{children:[(0,n.jsx)(l.L3,{className:"flex items-center gap-2",children:"Unpublish Project"}),(0,n.jsx)(l.rr,{children:"This project will no longer be publicly accessible. Are you sure you want to unpublish?"})]}),(0,n.jsxs)(l.Es,{children:[(0,n.jsx)(i.$,{variant:"outline",onClick:t,disabled:r,children:"Cancel"}),(0,n.jsx)(i.$,{variant:"destructive",onClick:c,disabled:r,loading:r,children:r?"Unpublishing":"Unpublish"})]})]})},c=()=>{let e=(0,r.f)(o),s=(0,a.useCallback)(()=>{e(!1)},[e]);return{showUnpublishDialog:(0,a.useCallback)(t=>{let{onConfirm:a}=t;e({childProps:{onConfirm:a,onClose:s}})},[e,s]),closeDialog:s}}},71459:(e,s,t)=>{t.d(s,{K:()=>a});var a=function(e){return e.ACTIVE_HEALTHY="ACTIVE_HEALTHY",e.ACTIVE_UNHEALTHY="ACTIVE_UNHEALTHY",e.COMING_UP="COMING_UP",e.GOING_DOWN="GOING_DOWN",e.INACTIVE="INACTIVE",e.INIT_FAILED="INIT_FAILED",e.REMOVED="REMOVED",e.RESTARTING="RESTARTING",e.UNKNOWN="UNKNOWN",e.UPGRADING="UPGRADING",e.PAUSING="PAUSING",e.RESTORING="RESTORING",e.RESTORE_FAILED="RESTORE_FAILED",e.PAUSE_FAILED="PAUSE_FAILED",e}({})},71569:(e,s,t)=>{t.d(s,{z:()=>i});var a=t(32044),r=t(33256),n=t(273);let i={domains:e=>{let{projectId:s,enabled:t=!0}=e;return(0,a.j)({queryKey:n.gO.domains(s),queryFn:async()=>(0,r.P)().get("/projects/".concat(s,"/domains")),refetchOnMount:!1,refetchOnWindowFocus:!1,enabled:t&&!!s,staleTime:3e5,retry:!1})}}},72887:(e,s,t)=>{t.d(s,{Ok:()=>n,Vv:()=>i,s5:()=>r});var a=t(40193);let r=e=>{try{let s=e.match(RegExp("^Security Finding:\\s*\\[(\\w+)\\]\\s*([^\\n\\r]+)(?:[\\n\\r]+(.+))?$","s"));if(!s)return null;let[,t,a,r=""]=s,n=t.toLowerCase();if(!["info","warn","error"].includes(n.toLowerCase()))return null;return{id:"parsed-".concat(Date.now()),level:n,name:a.trim(),description:r.trim()}}catch(e){return null}},n=()=>crypto.randomUUID?crypto.randomUUID():"msg_".concat(Date.now(),"_").concat(Math.random()),i=async(e,s,t)=>{let r=n(),i=(e=>"Security Finding: [".concat(e.level.toUpperCase(),"] ").concat(e.name,"\n\nI found a security issue that needs to be analyzed and fixed:\n\nIssue: ").concat(e.name,"\nLevel: ").concat(e.level,"\nDescription: ").concat(e.description,"\n\nPlease analyze this security issue in my project and provide a fix if possible. Make sure the fix doesn't break existing functionality and follows security best practices. If you need to modify files, please do so carefully and explain the changes."))(e);try{await s.mutateAsync({body:{id:r,message:i,intent:a.a.SECURITY_FIX,chat_only:!1}}),null==t||t()}catch(e){}}},76708:(e,s,t)=>{t.d(s,{I:()=>i});var a=t(99289),r=t(26551),n=t(44794);let i=e=>{let{text:s,className:t}=e;return(0,a.jsxs)("div",{className:(0,r.cn)("mt-1 flex items-center gap-2 text-sm opacity-70",t),children:[(0,a.jsx)("div",{className:"my-1",children:(0,a.jsx)(n.y,{size:"small"})}),(0,a.jsx)("div",{children:s})]})}},77809:(e,s,t)=>{t.d(s,{A:()=>x});var a=t(99289),r=t(45431),n=t(11405),i=t(98213),l=t(49944),o=t(6072),c=t(97757),d=t(34936),u=t(33256),m=t(69147),h=t(9563);let x=e=>{let{domain:s,showRemove:t,showIcon:x,refetchDomains:p}=e,[g,j]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),w=(0,h.Iw)(e=>e.project),N=async e=>{b(!0);try{let s=(0,u.P)();await s.delete("/projects/".concat(null==w?void 0:w.id,"/domains/").concat(e)),null==p||p(),b(!1),j(!1),i.toast.success("Domain removed",{description:'Your custom domain "'.concat(e,'" was successfully removed from the project.')})}catch(e){b(!1),(0,d.Ni)(e)}},C=()=>{v(!0),null==p||p(),setTimeout(()=>v(!1),1e3)},k=(e=>{try{return(0,r.Pk)(e)}catch(s){return m.logging.error("Failed to get UTF-8 domain",{domain:e,error:s}),e}})(s.domain);return(0,a.jsxs)("li",{className:"flex h-auto min-h-8 w-full items-center gap-2 text-sm",children:["active"!==s.status?(0,a.jsxs)("span",{className:"flex min-w-0 flex-grow items-center truncate text-muted-foreground",title:"The domain ".concat(k," is still being configured..."),onClick:()=>C(),children:[x&&(0,a.jsx)(c.A,{name:"language",className:"mr-2 inline w-4",size:"small"}),(0,a.jsx)("span",{className:"min-w-0 truncate",children:k}),(0,a.jsxs)("span",{className:"relative ml-2 mr-1 inline-flex size-2",children:[(0,a.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-primary opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex size-2 rounded-full bg-primary"})]})]}):(0,a.jsxs)("a",{href:"https://".concat(s.domain),target:"_blank",rel:"noopener noreferrer",className:"flex-grow truncate underline-offset-4 hover:underline",title:s.domain,children:[x&&(0,a.jsx)(c.A,{name:"language",className:"mr-2 inline w-4",size:"small"}),k]}),t&&(0,a.jsxs)(o.lG,{open:g,onOpenChange:j,children:[(0,a.jsx)(o.zM,{asChild:!0,children:(0,a.jsx)(l.$,{variant:"ghost",size:"icon-sm",type:"button",className:"ml-auto",children:(0,a.jsx)(c.A,{name:"delete",size:"small"})})}),(0,a.jsxs)(o.Cf,{children:[(0,a.jsxs)(o.c7,{children:[(0,a.jsxs)(o.L3,{children:["Remove ",k,"?"]}),(0,a.jsx)(o.rr,{children:"This will disconnect the domain from this project. You will need to reconfigure it if you will want to use it with this project in the future."})]}),(0,a.jsxs)(o.Es,{children:[(0,a.jsx)(l.$,{variant:"outline",size:"sm",onClick:()=>{j(!1)},children:"Cancel"}),(0,a.jsx)(l.$,{variant:"destructive",size:"sm",onClick:()=>N(s.domain),loading:y,children:"Remove"})]})]})]}),"active"!==s.status?(0,a.jsx)("span",{title:"Refresh status",className:"ml-auto cursor-pointer",onClick:()=>C(),children:(0,a.jsx)(c.A,{name:"refresh",size:"small",className:f?"animate-spin":""})}):(0,a.jsx)("a",{href:"https://".concat(s.domain),target:"_blank",title:"Open in a new tab",rel:"noopener noreferrer",className:"ml-auto text-muted-foreground",children:(0,a.jsx)(c.A,{name:"arrow_outward",size:"small"})})]})}},77987:(e,s,t)=>{t.d(s,{L:()=>r});var a=t(71459);let r=e=>e.status===a.K.ACTIVE_HEALTHY},83332:(e,s,t)=>{t.d(s,{B:()=>v});var a=t(99289),r=t(11405),n=t(23594),i=t(66608),l=t(82176),o=t(67017),c=t(26551),d=t(95358),u=t(9070),m=t(9562),h=t(97757),x=t(31126);let p=e=>{let{visibility:s,setVisibility:t,redirectToSubscription:r=!1,workspacePlan:n,workspace:p,className:g,disabled:j,disabledTooltipContent:f,disablePublishForWorkspace:v,textButton:y=!1}=e,b=(0,i.W6)({workspacePlan:n}),w=(0,i.OM)({workspacePlan:n}),{openSettings:N}=(0,u.t)(),C=(0,d.BK)(),k=(0,o.A)("md");return(0,a.jsx)(m.Q,{showTooltip:!!(j&&f),tooltipContent:(0,a.jsx)("p",{children:f}),children:(0,a.jsxs)(l.l6,{value:s,onValueChange:e=>{if("public"!==e||!v)if("private"!==e||w)if("draft"!==e||b)t(e);else{if(!r)return void C(d.KU.BIZ_PERSONAL_PROJECT);N("billing")}else{if(!r)return void C(d.KU.PRO_PRIVATE_PROJECT);N("billing")}},disabled:j,children:[(0,a.jsx)(l.bq,{className:(0,c.cn)("w-[180px] [&_.plan-badge]:hidden",g,y&&"w-auto border-none shadow-none"),children:(0,a.jsx)(l.yv,{placeholder:"Select visibility",className:""})}),(0,a.jsxs)(l.gC,{align:k?"start":"end",children:[(0,a.jsx)(l.eb,{value:"public",disabled:!0===v,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{name:"globe",size:"small"}),(0,a.jsx)("span",{children:"Public"}),v&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Disabled)"})]})}),(0,a.jsx)(l.eb,{value:"private",className:(0,c.cn)("flex items-center justify-between",{"bg-muted":"private"===s}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{name:"workspaces",size:"small"}),(0,a.jsx)("span",{children:"Workspace"}),p&&(0,a.jsx)(x.M,{workspace:p,requiredPlanCategory:"pro",className:"plan-badge"})]})}),(0,a.jsx)(l.eb,{value:"draft",className:(0,c.cn)("flex items-center justify-between",{"bg-muted":"draft"===s}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{name:"draft",size:"small"}),(0,a.jsx)("span",{children:"Personal"}),p&&(0,a.jsx)(x.M,{workspace:p,requiredPlanCategory:"biz",className:"plan-badge"})]})})]})]})})};var g=t(79312),j=t(9563),f=t(73728);let v=e=>{let{className:s,textButton:t=!1}=e,i=(0,f.B5)(e=>e.projectWorkspace),l=(null==i?void 0:i.plan)||null,o=(0,j.Iw)(e=>{var s;return null==(s=e.project)?void 0:s.visibility}),{permitted:c}=(0,n.J)(g.eZ.EditProjectVisibility),{permitted:d}=(0,n.J)(g.eZ.DeployProject),[u,m]=(0,r.useState)(void 0),{setVisibilityMutation:h}=(0,j.Om)(),{disableChangeVisibility:x,disabledTooltipContent:v}=(0,r.useMemo)(()=>c?{disableChangeVisibility:!1,disabledTooltipContent:void 0}:{disableChangeVisibility:!0,disabledTooltipContent:"You need to be an editor to change the visibility of your project."},[c]);return(0,r.useEffect)(()=>{o&&m(o)},[o]),(0,a.jsx)(p,{textButton:t,disabled:x||h.isPending,disabledTooltipContent:v,workspacePlan:l,workspace:i,visibility:u||o||void 0,setVisibility:e=>{m(e),h.mutateAsync(e)},className:s,disablePublishForWorkspace:!d})}},85349:(e,s,t)=>{t.d(s,{A:()=>m});var a=t(99289),r=t(48286),n=t(19550),i=t.n(n),l=t(22291);t(11405);var o=t(13252),c=t(97115),d=t(49944),u=t(97757);let m=e=>{let{plan:s,withWrapper:t=!1,className:n,...m}=e,h=(0,l.usePathname)(),x=(0,o.s)(),{isPaidPlan:p}=(0,c.cb)(s);return p||!x?null:t?(0,a.jsxs)("div",{className:"flex w-full items-center justify-between rounded-md bg-muted px-3 py-2 text-foreground",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(u.A,{name:"crown",size:"small"}),"Turn Pro"]}),(0,a.jsx)(d.$,{size:"sm",className:(0,r.A)("bg-brand-twilight text-brand-twilight-foreground hover:bg-brand-twilight/80",n),asChild:!0,...m,children:(0,a.jsx)(i(),{href:"".concat(h,"?settings=billing"),children:"Upgrade"})})]}):(0,a.jsx)(d.$,{size:"sm",className:(0,r.A)("bg-brand-twilight text-brand-twilight-foreground hover:bg-brand-twilight/80",n),asChild:!0,...m,children:(0,a.jsxs)(i(),{href:"".concat(h,"?settings=billing"),children:[(0,a.jsx)(u.A,{name:"crown",size:"small"}),(0,a.jsx)("span",{className:"hidden @3xl:flex",children:"Upgrade"})]})})}},87179:(e,s,t)=>{t.d(s,{O:()=>I});var a=t(99289),r=t(11405),n=t(16015),i=t(23594),l=t(76974),o=t(9563),c=t(73728),d=t(49944),u=t(6072),m=t(82176),h=t(51252),x=t(6919),p=t(98213),g=t(37079),j=t(34936),f=t(33256),v=t(69147),y=t(273),b=t(97115),w=t(26551),N=t(79312),C=t(39226),k=t(14090),_=t(9562),S=t(97757);function I(e){let{trigger:s,projectId:t,projectName:I,open:E,setOpen:A,isRootDialog:P=!1}=e,D=(0,l.Mu)(e=>e.workspaces),T=D.length>1,{permitted:L}=(0,i.J)(N.eZ.TransferProject),{moveProjectToWorkspace:z,isMovingProject:R}=(e=>{let{onSettled:s}=e,{authUser:t}=(0,g.Z2)(),a=(0,h.jE)(),{mutate:r,isPending:n}=(0,x.n)({mutationFn:async e=>{let{projectId:s,workspaceId:a}=e;if(!t)throw Error("User must be logged in to move projects");let r=(0,f.P)();await r.put("/projects/".concat(s,"/move-to-workspace"),{workspace_id:a})},onSuccess:async(e,s)=>{a.invalidateQueries({queryKey:y.gO.detail(s.projectId)}).catch(e=>{v.logging.error("Failed to invalidate project query after transfer",{error:e})}),p.toast.success("Project moved successfully",{description:"Moved project to ".concat(s.workspaceName||"new workspace")})},onError:e=>{(0,j.Ni)(e)},onSettled:()=>{null==s||s()}});return{moveProjectToWorkspace:r,isMovingProject:n}})({onSettled:()=>{U(!1),W("")}}),O=(0,c.B5)(e=>e.projectWorkspace),[F,M]=(0,r.useState)(!1),U=A||M,B=async e=>{t&&z({projectId:t,workspaceId:e.id,workspaceName:e.name})},[$,W]=(0,r.useState)(""),G=(0,l.Mu)(e=>e.setShowCreateWorkspaceDialog),K=!L||!T,q=D.find(e=>e.id===$),V=(0,o.Iw)(e=>e.project);if(!O)return null;let{isPaidPlan:H}=(0,b.cb)(null==q?void 0:q.plan),Y=H?"private":(null==q?void 0:q.plan)==="free"?"public":null;return(0,a.jsxs)(u.lG,{open:A?E:F,onOpenChange:U,children:[!P&&(0,a.jsx)(_.Q,{showTooltip:K,tooltipContent:L?T?"":"You need to be a member of another workspace to transfer projects.":"You don't have permission to transfer this project",children:(0,a.jsx)(u.zM,{asChild:!0,disabled:K,children:s||(0,a.jsx)(d.$,{variant:"default",disabled:K,children:"Transfer"})})}),(0,a.jsxs)(u.Cf,{size:"sm",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"text-left",children:["Transfer ",I||"Project"]}),(0,a.jsxs)(u.rr,{className:"text-left",children:[(0,a.jsx)("p",{children:q?(0,a.jsxs)("span",{children:["Moving this project to ",(0,a.jsx)("span",{className:"font-medium",children:q.name})," will:"]}):(0,a.jsx)("span",{children:"Moving this project to a new workspace will:"})}),(0,a.jsxs)("ul",{className:"list-disc pl-4 text-sm",children:[(0,a.jsxs)("li",{children:["Remove access for members of ",(0,a.jsx)("span",{className:"font-medium",children:O.name})]}),(0,a.jsxs)("li",{children:["Grant access to members of"," ",q?(0,a.jsx)("span",{className:"font-medium",children:null==q?void 0:q.name}):(0,a.jsx)("span",{children:"the new workspace"})]}),(0,a.jsx)("li",{children:"Preserve access for anyone directly invited to the project"}),(0,a.jsx)("li",{children:"May require you to re-link GitHub and Supabase organizations/projects"})]}),(0,a.jsxs)(k.Fc,{className:(0,w.cn)((!Y||Y===(null==V?void 0:V.visibility))&&"hidden","text-sm","mt-4"),children:[(0,a.jsx)(S.A,{name:"info",className:"h-4 w-4"}),(0,a.jsx)(k.XL,{children:"Warning"}),(0,a.jsxs)(k.TN,{className:"text-sm",children:["This action will turn the project"," ",(0,a.jsx)("span",{className:"font-medium",children:"private"===Y?"private":"public"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"min-w-[60px] text-sm font-medium",children:"From"}),(0,a.jsxs)("div",{className:"flex w-full items-center gap-2 rounded-md border px-2 py-1.5 opacity-70",children:[(0,a.jsx)(C.z,{workspace:O,className:"h-5 w-5 rounded-[6px]"}),(0,a.jsx)("p",{className:"text-sm",children:null==O?void 0:O.name}),(0,a.jsx)(n.U,{plan:null==O?void 0:O.plan})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"min-w-[60px] text-sm font-medium",children:"To"}),(0,a.jsxs)(m.l6,{value:$,onValueChange:W,children:[(0,a.jsx)(m.bq,{className:"px-2 py-1.5",children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(m.yv,{placeholder:"Select a workspace",className:"mr-auto"})})}),(0,a.jsxs)(m.gC,{children:[D.map(e=>{var s,t,r,i,l,o;return(0,a.jsx)(m.eb,{value:e.id,disabled:e.id===O.id||(null==(s=e.membership)?void 0:s.role)!=="owner"&&(null==(t=e.membership)?void 0:t.role)!=="admin"&&(null==(r=e.membership)?void 0:r.role)!=="member",className:"focus:bg-accent/50",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.z,{workspace:e,className:"h-5 w-5 rounded-[6px]"}),(0,a.jsx)("p",{children:e.name}),e.plan&&(0,a.jsx)(n.U,{plan:e.plan}),(null==(i=e.membership)?void 0:i.role)!=="owner"&&(null==(l=e.membership)?void 0:l.role)!=="admin"&&(null==(o=e.membership)?void 0:o.role)!=="member"&&(0,a.jsx)("span",{className:"text-sm text-destructive-foreground",children:"(Not an editor)"})]})},e.id)}),(0,a.jsxs)("button",{className:"flex w-full items-center gap-2 rounded-sm px-2 py-1.5 text-sm hover:bg-accent",onClick:()=>{G(!0)},children:[(0,a.jsx)("div",{className:"flex h-5 w-5 items-center justify-center",children:(0,a.jsx)(S.A,{name:"add",size:"small"})}),"Create new"]})]})]})]})]}),(0,a.jsxs)(u.Es,{className:"gap-2",children:[(0,a.jsx)(d.$,{size:"sm",variant:"outline",onClick:()=>U(!1),children:"Cancel"}),(0,a.jsx)(d.$,{disabled:!q,variant:"affirmative",size:"sm",onClick:()=>{q&&B(q)},loading:R,children:R?"Transferring...":"Confirm transfer"})]})]})]})}},87409:(e,s,t)=>{t.d(s,{Ue:()=>x,bf:()=>p,uf:()=>h,xM:()=>g});var a=t(99289),r=t(51758),n=t(14026),i=t(35270),l=t(26551),o=t(23719),c=t(90820),d=function(e){return e.AI_FIX="AI Fix",e}(d||{});let{AI_FIX:u}=d;n.B.NO_CODE_CHANGE,n.B.CODE_DIFF,n.B.FILE_EDITED_WITHOUT_PERMISSION,n.B.EXCLUDED_FILE_EDITED,n.B.DEPENDENCY_INSTALL,n.B.IMMEDIATE_RUNTIME,n.B.RUNTIME,n.B.BUILD,n.B.HTTP_CLIENT_ERROR,n.B.HTTP_SERVER_ERROR,n.B.SUPABASE_EDGE_FUNCTION_ERROR,n.B.CORS_ERROR,n.B.DEPLOY_SUPABASE_FUNCTIONS,n.B.SUPABASE_SQL_ERROR,n.B.SEARCH_REPLACE_FAILED,n.B.SEARCH_REPLACE_MISSING_FILE,n.B.CHANGED_MISSING_FILE,n.B.RENAME_FAILED,n.B.DELETION_FAILED;let m=e=>{let s=(0,r.KE)(e),t=s.length>1?e=>"# Error number ".concat(e+1,":\n#################\n\n"):()=>"",a=s.map((e,s)=>"".concat(t(s)).concat(e.error_message,"\n").concat(e.meta_data?"\n"+JSON.stringify(e.meta_data,null,2):"")).join("\n\n").replace(/\x1B\[[0-9;]*[JKmsu]/g,"");return a.length>2e4?a.slice(0,2e4)+"... (truncated)":a},h=e=>{let{errors:s,roundedTop:t=!0}=e;return(0,a.jsx)("div",{className:t?"mt-4":"",children:(0,a.jsx)("pre",{className:(0,l.cn)("w-full rounded-xl border-[3px] border-warning bg-background p-3 text-sm text-foreground",t?"mt-2 rounded-t-md":""),children:(0,a.jsx)("code",{className:"block w-full overflow-x-auto overflow-y-auto whitespace-pre-wrap",children:m(s)})})})},x=e=>{let{projectId:s,errors:t}=e,{mutate:a,isPending:r}=(0,o.Qd)({projectId:s});return{onClick:()=>{a({body:{id:(0,c.g_)(),message:"For the code present, I get the error below.\n\nPlease think step-by-step in order to resolve it.\n```\n".concat(m(t),"\n```\n"),mode:i.l.INSTANT,contains_error:!0,error_ids:t.map(e=>e.id)},projectId:s})},isPending:r}},p={[n.B.BUILD]:"Build unsuccessful",[n.B.CODE_DIFF]:"Changes couldn't be applied",[n.B.DEPLOY_SUPABASE_FUNCTIONS]:"Couldn't deploy Supabase functions",[n.B.DEPENDENCY_INSTALL]:"Couldn't install dependency",[n.B.FILE_EDITED_WITHOUT_PERMISSION]:"Tried editing file without permission",[n.B.EXCLUDED_FILE_EDITED]:"Unwanted changes",[n.B.IMMEDIATE_RUNTIME]:"Oops, it looks like our AI had a bit of a hiccup and broke the app",[n.B.NO_CODE_CHANGE]:"Changes already applied",[n.B.RUNTIME]:"The app encountered an error",[n.B.HTTP_CLIENT_ERROR]:"The app encountered an error",[n.B.HTTP_SERVER_ERROR]:"The app encountered an error",[n.B.SUPABASE_EDGE_FUNCTION_ERROR]:"The app encountered an error",[n.B.CORS_ERROR]:"The app encountered an error",[n.B.SUPABASE_SQL_ERROR]:"An error occurred while applying the migration",[n.B.SEARCH_REPLACE_FAILED]:"Failed search-replace",[n.B.SEARCH_REPLACE_MISSING_FILE]:"Search-replace on missing file",[n.B.CHANGED_MISSING_FILE]:"Tried deleting or renaming non-existent file",[n.B.RENAME_FAILED]:"Failed to rename file",[n.B.DELETION_FAILED]:"Failed to delete file"},g={[n.B.BUILD]:!0,[n.B.CODE_DIFF]:!0,[n.B.SUPABASE_EDGE_FUNCTION_ERROR]:!0,[n.B.DEPENDENCY_INSTALL]:!0,[n.B.DEPLOY_SUPABASE_FUNCTIONS]:!0,[n.B.HTTP_CLIENT_ERROR]:!0,[n.B.HTTP_SERVER_ERROR]:!0,[n.B.CORS_ERROR]:!0,[n.B.FILE_EDITED_WITHOUT_PERMISSION]:!0,[n.B.EXCLUDED_FILE_EDITED]:!0,[n.B.IMMEDIATE_RUNTIME]:!0,[n.B.NO_CODE_CHANGE]:!0,[n.B.RUNTIME]:!0,[n.B.SUPABASE_SQL_ERROR]:!0,[n.B.SEARCH_REPLACE_FAILED]:!0,[n.B.SEARCH_REPLACE_MISSING_FILE]:!0,[n.B.CHANGED_MISSING_FILE]:!0,[n.B.RENAME_FAILED]:!0,[n.B.DELETION_FAILED]:!0}},88467:(e,s,t)=>{t.d(s,{X:()=>w,p:()=>k});var a=t(99289),r=t(65746),n=t(11405),i=t(5531),l=t(9562),o=t(97757),c=t(62593),d=t(23660);let u=e=>{let{onProjectSelect:s,triggerComponent:t,supabaseOrganizations:r,handleConnect:u,isConnectLoading:m,isWorkspaceAdmin:h,align:x="start"}=e,[p,g]=(0,n.useState)(!1);return(0,a.jsx)(c.B,{setSelectedProject:s,setOpen:g,children:(0,a.jsxs)(i.rI,{open:p,onOpenChange:g,children:[t,(0,a.jsxs)(i.SQ,{className:"w-48",align:x,children:[(0,a.jsx)(i.lp,{className:"text-xs font-medium text-muted-foreground",children:"Supabase organizations"}),r.map(e=>(0,a.jsx)(d.g,{organization:e,reconnectOrg:u,isWorkspaceAdmin:h},e.id)),(0,a.jsx)(i.mB,{}),(0,a.jsx)(l.Q,{showTooltip:!h,tooltipContent:"You are not an admin of this workspace",children:(0,a.jsxs)(i._2,{onClick:u,className:"text-sm",disabled:m||!h,children:[(0,a.jsx)(o.A,{name:"add",size:"small"}),"Add organization"]})})]})]})})};var m=t(53417),h=t(49944),x=t(82594),p=t(31196),g=t(69147),j=t(71459),f=t(17169),v=t(26551),y=t(54225),b=t(90067);let w=e=>{var s,t,n;let{supabaseOrganizations:i,setShowConnectDialog:o,isWorkspaceAdmin:c,supabaseConfig:d,workspaceId:u}=e,m=(0,x.B)(),g=(0,y.wV)(e=>e.isSendChatMessageMutationPending),{handleProjectSelect:j,isConnecting:v}=(0,b.z)(m),{handleConnect:w}=(0,p.UO)(u),C=null!=(t=i.find(e=>e.id===(null==d?void 0:d.supabase_organization_id)))?t:null,_=null!=(n=null==C||null==(s=C.projects)?void 0:s.find(e=>e.id===(null==d?void 0:d.supabase_project_id)))?n:null;return(0,a.jsx)(r.m,{label:"Project",description:"Choose the Supabase project to sync with.",justify:"end",customBadge:(0,a.jsx)(k,{status:(null==_?void 0:_.status)||"not-connected"}),children:(null==C?void 0:C.status)===f.s.status.NEEDS_REFRESH?(0,a.jsx)(l.Q,{showTooltip:!0,tooltipContent:c?"You need to refresh your Supabase organization to continue building.":"You need to refresh your Supabase organization to continue building. Contact your workspace admin to refresh.",children:(0,a.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>{w({supabaseOrgId:null==d?void 0:d.supabase_organization_id})},disabled:!c,children:"Reconnect"})}):(0,a.jsx)(N,{connectedProjectIsInUnconnectedOrganization:!!d&&!C,supabaseOrganizations:i,isConnecting:v,isSendChatMessageMutationPending:g,isWorkspaceAdmin:c,setShowConnectDialog:o,handleProjectSelect:j,connectedSupabaseProject:_})})},N=e=>{let{connectedProjectIsInUnconnectedOrganization:s,supabaseOrganizations:t,isConnecting:r,isSendChatMessageMutationPending:n,isWorkspaceAdmin:o,setShowConnectDialog:c,handleProjectSelect:d,connectedSupabaseProject:m}=e;return(0,a.jsx)(u,{align:"end",onProjectSelect:e=>{e&&d(e)},triggerComponent:(0,a.jsx)(l.Q,{showTooltip:!m&&n,tooltipContent:"Edits ongoing...",children:(0,a.jsx)(i.ty,{asChild:!0,children:(0,a.jsx)(h.$,{disabled:!!m||r||n,size:"sm",variant:"outline",loading:r,children:m?m.name:s?"Project not found":"Connect a project"})})}),supabaseOrganizations:t,handleConnect:()=>c(!0),isConnectLoading:r,isWorkspaceAdmin:o})},C={[j.K.ACTIVE_HEALTHY]:{label:"Connected",className:"bg-success-primary"},[j.K.ACTIVE_UNHEALTHY]:{label:"Issues detected",className:"bg-warning-primary"},[j.K.COMING_UP]:{label:"Starting up",className:"bg-affirmative-primary"},[j.K.GOING_DOWN]:{label:"Shutting down",className:"bg-destructive-primary"},[j.K.INACTIVE]:{label:"Inactive",className:"bg-destructive-primary"},[j.K.INIT_FAILED]:{label:"Setup failed",className:"bg-destructive-primary"},[j.K.REMOVED]:{label:"Removed",className:"bg-destructive-primary"},[j.K.RESTARTING]:{label:"Restarting",className:"bg-warning-primary"},[j.K.UNKNOWN]:{label:"Unknown",className:"bg-destructive-primary"},[j.K.UPGRADING]:{label:"Upgrading",className:"bg-warning-primary"},[j.K.PAUSING]:{label:"Pausing",className:"bg-warning-primary"},[j.K.RESTORING]:{label:"Restoring",className:"bg-warning-primary"},[j.K.RESTORE_FAILED]:{label:"Restore failed",className:"bg-destructive-primary"},[j.K.PAUSE_FAILED]:{label:"Pause failed",className:"bg-destructive-primary"},"not-connected":{label:"Not connected",className:"bg-warning-primary"}},k=e=>{let{status:s}=e,t=(e=>e in C?C[e]:(g.logging.warn("Unknown supabase project status",{status:e}),{label:e,className:""}))(s);return t?(0,a.jsxs)(m.E,{className:"flex w-auto items-center gap-1.5 bg-secondary text-sm text-foreground shadow-none hover:bg-secondary md:text-xs",children:[(0,a.jsx)("span",{className:(0,v.cn)("h-1.5 w-1.5 rounded-full",t.className)}),t.label]}):null}},89906:(e,s,t)=>{t.d(s,{O:()=>l});var a=t(34363),r=t(11405),n=t(66608),i=t(34824);let l=e=>{var s,t,l,o;let{enabled:c}=e,{userData:d}=(0,n.ur)(),u=(0,a.I)(i.O.installations({enabled:c})),m=null==d||null==(s=d.github)?void 0:s.encrypted_access_token,h=(0,r.useRef)(m);return(0,r.useEffect)(()=>{h.current!==m&&(u.refetch(),h.current=m)},[m,u]),{isLoading:u.isLoading,installations:null==(t=u.data)?void 0:t.installations,hasAccessToken:null==(l=u.data)?void 0:l.has_access_token,hasValidAccessToken:null==(o=u.data)?void 0:o.has_valid_access_token}}},90067:(e,s,t)=>{t.d(s,{z:()=>c});var a=t(11405),r=t(98213),n=t(23719),i=t(90820),l=t(34936),o=t(35270);let c=(e,s)=>{let{mutateAsync:t,isPending:c}=(0,n.Qd)({projectId:e,onSuccess:()=>{r.toast.success("Supabase connected",{description:"Follow the instructions in the chat to complete the integration."}),null==s||s()}});return{handleProjectSelect:(0,a.useCallback)(async s=>{if(s)try{await t({body:{id:(0,i.g_)(),message:"Please connect my supabase project `".concat(s.name,"`"),mode:o.l.INSTANT,contains_error:!1,integrate_supabase_project_id:s.id,integrate_supabase_org_id:s.organization_id},projectId:e},{})}catch(e){(0,l.Ni)(e)}},[t,e]),isConnecting:c}}},90672:(e,s,t)=>{t.d(s,{O:()=>l});var a=t(62276),r=t(23719),n=t(69147),i=t(40193);let l=e=>{let{projectId:s,setIsOpen:t}=e,l=(0,r.Qd)({projectId:s,onSuccess:()=>{null==t||t(!1)}});return{handleSecurityReview:()=>{if(!s)return void n.logging.error("project id is missing, can't start security review");l.mutate({body:{message:"Please perform a comprehensive security review of my project.",id:(0,a.A)(),intent:i.a.SECURITY_REVIEW,chat_only:!0}})}}}},91253:(e,s,t)=>{t.d(s,{J:()=>y});var a=t(99289),r=t(11405),n=t(96431),i=t(49944),l=t(6072),o=t(31196),c=t(2904),d=t(9562),u=t(86077),m=t(4141);let h=e=>{let{setStep:s,workspace:t,supabaseOrganizations:r,handleConnect:l,isConnecting:o,showConnectStep:c,isAdmin:h}=e,x=0===r.length;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.Fh,{title:"Linked Supabase Organizations",description:"Anyone in your Lovable workspace can view and link Supabase projects.",badge:"admin"}),(0,a.jsx)(m.Separator,{}),(0,a.jsxs)("div",{className:"grid min-h-[200px] grid-cols-1 gap-3 px-6 py-6 md:grid-cols-2",children:[(0,a.jsx)(n.tX,{workspace:t}),(0,a.jsxs)("div",{className:"flex max-h-[40vh] flex-col gap-3 overflow-y-auto",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"Supabase Organizations"}),r.map(e=>{let s="connected"===e.status;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border bg-muted",children:(0,a.jsx)(u.Xy.Supabase,{className:"h-4 w-4"})}),(0,a.jsx)("p",{className:"break-all font-medium",children:e.name}),!s&&(0,a.jsx)(i.$,{variant:"default",size:"sm",className:"ml-auto",onClick:()=>l({supabaseOrgId:e.id}),disabled:o,children:"Reconnect"})]},e.id)}),(0,a.jsx)(d.Q,{showTooltip:!h,tooltipContent:"You need to be an admin to add organizations",triggerClassName:"mt-auto w-full",children:(0,a.jsx)(i.$,{variant:"outline",className:"mt-auto w-full",onClick:()=>l(),size:"sm",disabled:!h,children:x?"Add Organization":"Add More Organizations"})})]})]}),(0,a.jsx)(m.Separator,{}),c&&(0,a.jsx)(n.p8,{children:(0,a.jsx)(d.Q,{showTooltip:0===r.length,tooltipContent:"Please add an organization to continue",triggerClassName:"ml-auto",children:(0,a.jsx)(i.$,{onClick:()=>s("connect"),className:"ml-auto",size:"sm",disabled:0===r.length,children:"Continue"})})})]})};var x=t(54225),p=t(77987),g=t(97757),j=t(82594),f=t(90067);let v=e=>{let{setStep:s,supabaseOrganizations:t,closeDialog:l}=e,o=(0,j.B)(),c=(0,x.wV)(e=>e.isSendChatMessageMutationPending),[h,v]=(0,r.useState)(null),{handleProjectSelect:y,isConnecting:b}=(0,f.z)(o,l),w=b||c;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.Fh,{title:"Connect Project",description:"Select a project of one of your connected Supabase organizations to connect it to your Lovable project."}),(0,a.jsx)(m.Separator,{}),(0,a.jsx)("div",{className:"flex max-h-[40vh] flex-col gap-3 overflow-y-auto px-6 py-6",children:t.map(e=>{let s=[...e.projects].sort((e,s)=>(0,p.L)(e)&&!(0,p.L)(s)?-1:(0,p.L)(s)&&!(0,p.L)(e)?1:0),t=0===s.length;return(0,a.jsxs)("div",{className:"flex w-full flex-col gap-3",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:e.name}),s.map(e=>{let s=(0,p.L)(e),t=h===e.id;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),!s&&(0,a.jsx)(d.Q,{showTooltip:!s,tooltipContent:"Check project status in Supabase.",instant:!0,children:(0,a.jsx)(g.A,{name:"warning_fill",className:"text-destructive-primary",size:"small"})},e.id)]}),(0,a.jsx)(i.$,{size:"sm",disabled:!s||w,onClick:()=>{v(e.id),y(e)},loading:t&&w,children:t&&w?"Connecting":"Connect"})]},e.id)}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[t&&(0,a.jsx)("p",{className:"w-full text-sm text-muted-foreground",children:"No Supabase projects found for this organization."}),(0,a.jsx)(i.$,{size:"sm",variant:t?"default":"secondary",className:"ml-auto w-fit",asChild:!0,children:(0,a.jsxs)("a",{href:"https://supabase.com/dashboard/new/".concat(e.id),target:"_blank",children:[(0,a.jsx)(u.Xy.Supabase,{className:"h-3 w-3"}),"Create Project"]})})]})]},e.id)})}),(0,a.jsx)(m.Separator,{}),(0,a.jsx)(n.p8,{children:(0,a.jsx)(i.$,{variant:"outline",onClick:()=>s("organizations"),size:"sm",children:"Back"})})]})},y=e=>{var s;let{workspace:t,showConnectStep:d,showConnectDialog:u,setShowConnectDialog:m,isAdmin:x}=e,[p,g]=(0,r.useState)("organizations"),{supabaseOrganizations:j}=(0,c.G)({workspaceId:t.id}),{handleConnect:f,isConnecting:y}=(0,o.UO)(null!=(s=null==t?void 0:t.id)?s:"");return(0,a.jsxs)(l.lG,{open:u,onOpenChange:e=>{m(e),e||g("organizations")},children:[(0,a.jsx)(l.zM,{asChild:!0,className:"hidden",children:(0,a.jsx)(i.$,{size:"sm",children:"Connect Supabase"})}),(0,a.jsx)(n.Lg,{children:"organizations"===p?(0,a.jsx)(h,{setStep:g,workspace:t,supabaseOrganizations:null!=j?j:[],handleConnect:f,isConnecting:y,showConnectStep:d,isAdmin:x}):(0,a.jsx)(v,{setStep:g,supabaseOrganizations:null!=j?j:[],closeDialog:()=>{m(!1),g("organizations")}})})]})}},94987:(e,s,t)=>{t.d(s,{Cu:()=>l,FA:()=>a,KE:()=>n,XY:()=>r});let a=e=>{switch(e){case"error":return"destructive";case"warn":return"warning";default:return"outline"}},r=e=>{switch(e){case"error":return"text-destructive-foreground";case"warn":return"text-warning-foreground";default:return"text-muted-foreground"}},n=e=>{switch(e.toLowerCase()){case"warn":return"Warning";case"error":return"Error";case"info":return"Info";default:return e.charAt(0).toUpperCase()+e.slice(1)}},i={open_table:"Database Schema",supabase:"Supabase",supabase_lov:"LLM Database Check",agent_security:"Security Agent"},l=e=>{var s;return null!=(s=i[e])?s:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}},95687:(e,s,t)=>{t.d(s,{oC:()=>o,ZE:()=>c,pT:()=>m,CN:()=>u});var a=t(98213),r=t(99490),n=t(69147);let i="https://github.com/login/oauth/authorize?client_id=".concat("Iv1.365d6a195dbca85b"),l="https://github.com/apps/".concat("lovable-dev","/installations/new"),o="githubOAuthNonce",c=r.Ik({nonce:r.Yj(),workspaceId:r.Yj().optional()}),d=(e,s)=>{let t=crypto.randomUUID();try{localStorage.setItem(o,t)}catch(e){n.logging.error("Failed to set state in GitHub OAuth popup"),a.toast.error("Failed to initiate GitHub OAuth flow",{description:"Try clearing browser local storage and try again."});return}let r=(null==s?void 0:s.workspaceId)?{nonce:t,workspaceId:s.workspaceId}:{nonce:t,workspaceId:void 0},i=new URL(e);i.searchParams.set("state",btoa(JSON.stringify(r))),e=i.toString();let l=window.open(e,"_blank","width=600,height=700,left=100,top=100");if(!l)return void n.logging.error("Failed to open GitHub OAuth popup");l.focus()},u=e=>{let{githubOwner:s,workspaceId:t}=e;d((e=>(null==e?void 0:e.id)?"".concat(l,"/permissions?target_id=").concat(e.id,"&target_type=").concat(e.type):l)(s),{workspaceId:t})},m=()=>{d(i)}},96431:(e,s,t)=>{t.d(s,{Fh:()=>o,Lg:()=>l,p8:()=>c,tX:()=>d});var a=t(99289);t(11405);var r=t(39226),n=t(6072),i=t(38948);let l=e=>{let{children:s}=e;return(0,a.jsx)(n.Cf,{className:"max-h-[80vh] gap-0 overflow-y-auto p-0",size:"lg",children:s})},o=e=>{let{title:s,description:t,badge:r}=e;return(0,a.jsxs)(n.c7,{className:"px-6 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.L3,{className:"font-medium",children:s}),r&&(0,a.jsx)(i.x,{badge:r})]}),(0,a.jsx)(n.rr,{className:"text-sm text-muted-foreground",children:t})]})},c=e=>{let{children:s}=e;return(0,a.jsx)("div",{className:"flex gap-4 px-6 py-4",children:s})},d=e=>{let{workspace:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"Workspace"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.z,{workspace:s,className:"h-7 w-7"}),(0,a.jsx)("p",{className:"font-medium",children:s.name})]})]})}},96772:(e,s,t)=>{t.d(s,{b:()=>a});let a=e=>e.replace(/(^\w+:|^)\/\//,"")},98743:(e,s,t)=>{t.d(s,{Q:()=>K});var a=t(99289),r=t(34363),n=t(51252),i=t(11405),l=t(39627),o=t(49944),c=t(97757),d=t(48591),u=t(36104),m=t(273),h=t(16457),x=t(9563),p=t(83644),g=t(1596),j=t(55940),f=t(80611),v=t(42132),y=t(84751),b=t(27868),w=t(86975),N=t(44794),C=t(9396);let k={totalVisits:{title:"Visitors",valueType:"number",timeSeriesKey:"visitors",description:"Total number of visitors to your app."},totalPageviews:{title:"Pageviews",valueType:"number",timeSeriesKey:"pageviews",description:"Total number of pages viewed by all visitors."},pageviewsPerVisit:{title:"Views Per Visit",valueType:"number",timeSeriesKey:"pageviewsPerVisit",description:"How many pages the average visitor viewed."},sessionDuration:{title:"Visit Duration",valueType:"time",timeSeriesKey:"sessionDuration",description:"How long the average visit to your app lasted."},bounceRate:{title:"Bounce Rate",valueType:"percentage",timeSeriesKey:"bounceRate",description:"Percentage of visitors who left after viewing only one page."}};var _=t(11583),S=t(2237),I=t(90895),E=t(99017);let A=()=>{let[e,s]=(0,I.Mj)("temporary-analytics-banner",!0);return e?(0,a.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,a.jsx)("span",{className:"font-medium",children:"Note: "}),"We started tracking analytics between the 4th and 7th of July. Data before this period is not available."]}),(0,a.jsxs)(E.m_,{instant:!0,children:[(0,a.jsx)(E.k$,{children:(0,a.jsx)(o.$,{variant:"ghost",size:"icon-sm",onClick:()=>s(!1),children:(0,a.jsx)(c.A,{name:"close",size:"small"})})}),(0,a.jsx)(E.ZI,{children:(0,a.jsx)("p",{children:"Don't show this message again"})})]})]}):null},P={value:{label:"Views"}},D=e=>{let{data:s,valueType:t="number",granularity:r,selectedMetric:n,isLoading:l,userTimezone:d,onRefresh:u}=e,m=(0,i.useCallback)((e,s)=>{let t=(0,p.H)(e+(e.includes(" ")?"":"T00:00:00")+"Z"),a=(0,j.L_)(t,(0,S.dB)(d));return(0,g.GP)(a,s)},[d]);return(0,a.jsxs)("div",{className:"w-full rounded-xl border bg-muted p-4",children:[(0,a.jsx)(A,{}),0!==s.length||l?l?(0,a.jsx)("div",{className:"flex h-[200px] w-full items-center justify-center md:h-[400px]",children:(0,a.jsx)(N.y,{})}):(0,a.jsx)(C.at,{config:P,className:"h-[200px] w-full max-w-full md:h-[400px]",children:(0,a.jsxs)(f.Q,{data:s,margin:{left:"time"===t?0:-15,right:10,top:20,bottom:5},children:[(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"fillGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"var(--chart-1)",stopOpacity:.2}),(0,a.jsx)("stop",{offset:"95%",stopColor:"var(--chart-1)",stopOpacity:.02})]})}),(0,a.jsx)(v.d,{horizontal:!0,vertical:!1,stroke:"hsl(var(--muted-border))"}),(0,a.jsx)(y.W,{dataKey:"date",tickLine:!1,tickMargin:10,interval:"equidistantPreserveStart",tickFormatter:e=>{switch(r){case"hourly":return m(e,"HH:mm");case"daily":return m(e,"d MMM")}}}),(0,a.jsx)(b.h,{dataKey:"value",tickLine:!1,axisLine:!1,tickMargin:10,tickCount:5,tickFormatter:e=>{switch(t){case"number":return(0,_.aM)(e);case"percentage":return"".concat(e,"%");case"time":return(0,_.fU)(e)}}}),(0,a.jsx)(w.G,{dataKey:"value",strokeWidth:2,stroke:"var(--chart-1)",dot:!1,fill:"url(#fillGradient)",animationDuration:500,animationEasing:"ease-in-out"}),(0,a.jsx)(C.II,{cursor:!1,content:(0,a.jsx)(C.Nt,{formatter:e=>(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)("span",{className:"mr-1 h-3 w-3 rounded-full bg-chart-1"})," ",(0,a.jsx)("span",{className:"font-medium",children:(0,_.Fl)({value:e,valueType:t})})," ",(0,a.jsx)("span",{className:"",children:k[n].title})]}),labelFormatter:e=>{let s="";return s="hourly"===r?m(e,"d MMM, HH:mm"):m(e,"d MMM"),(0,a.jsx)("p",{className:"text-sm",children:s})}})})]})}):(0,a.jsxs)("div",{className:"flex h-[200px] w-full flex-col items-center justify-center gap-2 md:h-[400px]",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No data available"}),(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:u,children:[(0,a.jsx)(c.A,{name:"refresh",size:"small"}),"Refresh"]})]})]})};var T=t(16161);let L=/./g,z=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en";try{return new Intl.DisplayNames([s],{type:"region"}).of(e.toUpperCase())||e}catch(s){return e}},R=e=>{let{data:s,type:t,metric:r,color:n,isLoading:i}=e,l=Math.max(...s.map(e=>e.value)),o=s.sort((e,s)=>s.value-e.value),c=s.reduce((e,s)=>e+s.value,0);return(0,a.jsxs)("div",{className:"flex flex-col gap-4 rounded-xl border border-border bg-muted p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm font-medium",children:[(0,a.jsxs)(E.m_,{instant:!0,children:[(0,a.jsx)(E.k$,{children:(0,a.jsx)("p",{className:"capitalize",children:t})}),(0,a.jsx)(E.ZI,{children:(e=>{switch(e){case"country":return"The top countries your visitors are from.";case"device":return"The most used devices by your visitors.";case"source":return"The most common sources of traffic to your app.";case"page":return"The most viewed pages in your app."}})(t)})]}),(0,a.jsx)("p",{children:r})]}),!i&&o.length>0&&o.map(e=>{let s=e.value/l*100,i=(e=>{let{type:s,label:t}=e;switch(s){case"country":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"origin-left scale-[1.35] transform",children:t.toUpperCase().replace(L,e=>String.fromCodePoint(127397+e.charCodeAt(0)))}),(0,a.jsx)("span",{children:z(t)})]});case"device":if("mobile-ios"===t)return"Mobile - iOS";if("mobile-android"===t)return"Mobile - Android";return t.charAt(0).toUpperCase()+t.slice(1);default:return t}})({type:t,label:e.label}),o=(e=>{let{type:s,value:t,total:a}=e;if("device"!==s)return(0,_.aM)(t);{let e=t/a*100;return"".concat(e.toFixed(1),"%")}})({type:t,value:e.value,total:c});return"Unknown"===e.label?null:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"relative flex-1 px-2 py-1",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 rounded-md bg-accent",style:{width:"".concat(s,"%"),minWidth:"10px",backgroundColor:n}}),(0,a.jsx)("p",{className:"relative z-10 flex items-center gap-3 break-all",children:i})]}),(0,a.jsxs)(E.m_,{delayDuration:0,children:[(0,a.jsx)(E.k$,{children:(0,a.jsx)("p",{children:o})}),(0,a.jsx)(E.ZI,{children:(0,a.jsxs)("p",{children:[e.value," ",r]})})]})]},e.label)}),!i&&0===o.length&&(0,a.jsx)("p",{className:"text-base text-muted-foreground md:text-sm",children:"No data found for this time period."}),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)(T.E,{className:"h-6 flex-1"}),(0,a.jsx)(T.E,{className:"h-6 w-8"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)(T.E,{className:"h-6 w-1/2"}),(0,a.jsx)(T.E,{className:"h-6 w-8"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)(T.E,{className:"h-6 w-1/4"}),(0,a.jsx)(T.E,{className:"h-6 w-8"})]})]})]})};var O=t(26551);let F=e=>{let{title:s,value:t,valueType:r="number",changePercentage:n,onClick:i,isSelected:l,isLoading:o,description:d}=e,u=n&&n>0,m=n&&0===n;return(0,a.jsxs)(E.m_,{delayDuration:0,children:[(0,a.jsx)(E.k$,{asChild:!0,children:(0,a.jsxs)("div",{className:(0,O.cn)("group flex cursor-pointer flex-col gap-2 rounded-xl border bg-muted p-4",l&&"border-accent-primary/50"),onClick:i,children:[(0,a.jsx)("p",{className:(0,O.cn)("text-sm font-medium group-hover:text-accent-primary",l&&"text-accent-primary"),children:s}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("p",{className:"h-5 font-medium",children:o?(0,a.jsx)(T.E,{className:"h-full w-8"}):(0,_.Fl)({value:t,valueType:r})}),n&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:(0,O.cn)("flex items-center gap-1",u?"text-success-primary":m?"text-warning-primary":"text-destructive-primary"),children:[(0,a.jsx)(c.A,{name:u?"trending_up":m?"trending_flat":"trending_down",size:"small"}),(0,a.jsxs)("p",{className:"text-sm",children:[n,"%"]})]})})]})]})}),(0,a.jsxs)(E.ZI,{className:"max-w-[35ch]",children:[(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:(0,_.Fl)({value:t,valueType:r,roundNumber:!1})})," ",(0,a.jsx)("span",{className:"",children:s.toLowerCase()})]}),d&&(0,a.jsx)("p",{className:"text-xs opacity-80",children:d})]})]})};var M=t(19164);let U=e=>{let{project:s}=e,{data:t,dataUpdatedAt:n,isLoading:i}=(0,r.I)({...u.c.analyticsTrend({projectId:s.id}),enabled:!s.is_analytics_disabled&&s.is_published}),l=(null==t?void 0:t.currentVisitors)&&t.currentVisitors>0,o=l?t.currentVisitors:0;return t||i?i?(0,a.jsx)(T.E,{className:"h-full w-8"}):(0,a.jsxs)(E.m_,{instant:!0,children:[(0,a.jsx)(E.k$,{asChild:!0,children:(0,a.jsxs)("div",{className:"hidden cursor-pointer items-center gap-1 text-foreground md:flex",children:[(0,a.jsx)("div",{className:(0,O.cn)("mr-1 size-2 shrink-0 rounded-full",l?"animate-pulse bg-success-primary":"bg-muted-foreground")}),(0,a.jsx)("p",{className:"text-sm",children:o}),(0,a.jsxs)("p",{className:"whitespace-nowrap text-sm",children:["current ",1===o?"visitor":"visitors"]})]})}),(0,a.jsx)(E.ZI,{children:(0,a.jsx)(B,{timestamp:n})})]}):null},B=e=>{let{timestamp:s}=e,[t,r]=(0,i.useState)(new Date);return(0,i.useEffect)(()=>{let e=setInterval(()=>{r(new Date)},1e3);return()=>clearInterval(e)},[]),(0,a.jsxs)("p",{children:["Last updated ",(0,M.O)(t,new Date(s))," seconds ago"]})};var $=t(5531),W=t(67017);let G=e=>{let{selectedTimePeriod:s,setSelectedTimePeriod:t,userTimezone:r}=e,n=(0,W.A)("md"),l=(0,i.useMemo)(()=>Object.entries(S.N8).map(e=>{let[s,t]=e,a=t.getTimePeriod(r);return{key:s,label:t.label,timePeriod:a}}),[r]),d=S.N8[s.preset].label;return(0,a.jsxs)($.rI,{children:[(0,a.jsx)($.ty,{asChild:!0,children:(0,a.jsxs)(o.$,{variant:"outline",className:"justify-between text-foreground md:min-w-32 md:px-3",size:n?"sm":"default",children:[d,(0,a.jsx)(c.A,{name:"chevron_right",size:"small",className:"rotate-90"})]})}),(0,a.jsx)($.SQ,{align:"end",className:"min-w-32",children:l.map(e=>(0,a.jsx)($._2,{onClick:()=>t(e.timePeriod),children:e.label},e.key))})]})},K=e=>{var s,t,l,d,p;let{project:g}=e,[j,f]=(0,i.useState)("totalVisits"),[v,y]=(0,i.useState)(S.cn),{data:b,isLoading:w}=(0,r.I)({...u.c.analytics({projectId:g.id,timePeriod:v}),enabled:!g.is_analytics_disabled&&g.is_published}),N=!!g.url,{updateProject:C}=(0,x.Om)(),_=async()=>{C({is_analytics_disabled:!1});try{await (0,h.o)({projectId:g.id})}catch(e){}},I=(0,n.jE)(),E=async()=>{await I.invalidateQueries({queryKey:m.gO.analytics(g.id,v)})};return!N||g.is_analytics_disabled?(0,a.jsx)(q,{description:"Measure how your published project is performing.",children:(0,a.jsxs)("div",{className:"flex w-full flex-1 flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,a.jsx)(c.A,{name:"bid_landscape",size:"large"}),N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-base md:text-sm",children:"Tracking analytics is disabled for this project."}),(0,a.jsx)(o.$,{variant:"outline",size:"sm",className:"mt-4",onClick:_,children:"Enable Analytics"})]}):(0,a.jsx)("p",{className:"text-center text-base md:text-sm",children:"To view analytics, you first need to publish your project."})]})}):(0,a.jsxs)(q,{description:(0,a.jsxs)("p",{children:["Measure how your"," ",(0,a.jsx)("a",{href:null!=(s=g.url)?s:"".concat(g.name,".lovable.app"),target:"_blank",rel:"noopener noreferrer",className:"font-medium hover:underline",children:"published project"})," ","is performing."]}),descriptionAction:(0,a.jsxs)("div",{className:"flex items-center gap-5 md:-mt-1.5",children:[(0,a.jsx)(U,{project:g}),(0,a.jsx)(G,{selectedTimePeriod:v,setSelectedTimePeriod:y})]}),children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-6 md:grid-cols-3 lg:grid-cols-5",children:Object.entries(k).map(e=>{var s,t;let[r,n]=e,{title:i,valueType:l,timeSeriesKey:o,description:c}=n,d=null!=(t=null==b||null==(s=b.timeSeries[o])?void 0:s.total)?t:0;return(0,a.jsx)(F,{title:i,value:d,onClick:()=>{f(r)},isSelected:j===r,isLoading:w,valueType:l,description:c},r)})}),(0,a.jsx)(D,{data:(()=>{if(!b)return[];switch(j){case"totalVisits":default:return b.timeSeries.visitors.data;case"totalPageviews":return b.timeSeries.pageviews.data;case"pageviewsPerVisit":return b.timeSeries.pageviewsPerVisit.data;case"sessionDuration":return b.timeSeries.sessionDuration.data;case"bounceRate":return b.timeSeries.bounceRate.data}})(),valueType:k[j].valueType,granularity:v.granularity,selectedMetric:j,isLoading:w,onRefresh:E}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[(0,a.jsx)(R,{data:null!=(t=null==b?void 0:b.lists.source.data)?t:[],type:"source",metric:"Visitors",isLoading:w}),(0,a.jsx)(R,{data:null!=(l=null==b?void 0:b.lists.page.data)?l:[],type:"page",metric:"Visitors",color:"hsl(var(--brand-twilight))",isLoading:w}),(0,a.jsx)(R,{data:null!=(d=null==b?void 0:b.lists.country.data)?d:[],type:"country",metric:"Visitors",color:"hsl(var(--brand-twilight))",isLoading:w}),(0,a.jsx)(R,{data:null!=(p=null==b?void 0:b.lists.device.data)?p:[],type:"device",metric:"Visitors",isLoading:w})]})]})},q=e=>{let{children:s,description:t,descriptionAction:r}=e;return(0,d.Li)()?(0,a.jsxs)("div",{className:"flex min-h-full flex-col gap-6 overflow-y-auto p-4",children:[r&&(0,a.jsx)("div",{className:"flex justify-end",children:r}),s]}):(0,a.jsx)(l.Pt,{title:"Analytics",value:"analytics",description:t,descriptionAction:r,children:s})}}}]);